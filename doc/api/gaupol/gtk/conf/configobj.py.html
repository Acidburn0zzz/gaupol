<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>gaupol.gtk.conf.configobj</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <link rel="stylesheet" type="text/css" href="code.css" />
</head>
<body>
<pre>
<a name="L1" class="line-number">   1 </a><span class="python-comment"># configobj.py</span>
<a name="L2" class="line-number">   2 </a><span class="python-comment"># A config file reader/writer that supports nested sections in config files.</span>
<a name="L3" class="line-number">   3 </a><span class="python-comment"># Copyright (C) 2005-2006 Michael Foord, Nicola Larosa</span>
<a name="L4" class="line-number">   4 </a><span class="python-comment"># E-mail: fuzzyman AT voidspace DOT org DOT uk</span>
<a name="L5" class="line-number">   5 </a><span class="python-comment">#         nico AT tekNico DOT net</span>
<a name="L6" class="line-number">   6 </a>
<a name="L7" class="line-number">   7 </a><span class="python-comment"># ConfigObj 4</span>
<a name="L8" class="line-number">   8 </a><span class="python-comment"># http://www.voidspace.org.uk/python/configobj.html</span>
<a name="L9" class="line-number">   9 </a>
<a name="L10" class="line-number">  10 </a><span class="python-comment"># Released subject to the BSD License</span>
<a name="L11" class="line-number">  11 </a><span class="python-comment"># Please see http://www.voidspace.org.uk/python/license.shtml</span>
<a name="L12" class="line-number">  12 </a>
<a name="L13" class="line-number">  13 </a><span class="python-comment"># Scripts maintained at http://www.voidspace.org.uk/python/index.shtml</span>
<a name="L14" class="line-number">  14 </a><span class="python-comment"># For information about bugfixes, updates and support, please join the</span>
<a name="L15" class="line-number">  15 </a><span class="python-comment"># ConfigObj mailing list:</span>
<a name="L16" class="line-number">  16 </a><span class="python-comment"># http://lists.sourceforge.net/lists/listinfo/configobj-develop</span>
<a name="L17" class="line-number">  17 </a><span class="python-comment"># Comments, suggestions and bug reports welcome.</span>
<a name="L18" class="line-number">  18 </a>
<a name="L19" class="line-number">  19 </a><span class="python-keyword">from</span> <span class="python-name">__future__</span> <span class="python-keyword">import</span> <span class="python-name">generators</span>
<a name="L20" class="line-number">  20 </a>
<a name="L21" class="line-number">  21 </a><span class="python-keyword">import</span> <span class="python-name">sys</span>
<a name="L22" class="line-number">  22 </a><span class="python-name">INTP_VER</span> <span class="python-operator">=</span> <span class="python-name">sys</span><span class="python-operator">.</span><span class="python-name">version_info</span><span class="python-operator">[</span><span class="python-operator">:</span><span class="python-number">2</span><span class="python-operator">]</span>
<a name="L23" class="line-number">  23 </a><span class="python-keyword">if</span> <span class="python-name">INTP_VER</span> <span class="python-operator">&lt;</span> <span class="python-operator">(</span><span class="python-number">2</span><span class="python-operator">,</span> <span class="python-number">2</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L24" class="line-number">  24 </a>    <span class="python-keyword">raise</span> <span class="python-name">RuntimeError</span><span class="python-operator">(</span><span class="python-string">"Python v.2.2 or later needed"</span><span class="python-operator">)</span>
<a name="L25" class="line-number">  25 </a>
<a name="L26" class="line-number">  26 </a><span class="python-keyword">import</span> <span class="python-name">os</span><span class="python-operator">,</span> <span class="python-name">re</span>
<a name="L27" class="line-number">  27 </a><span class="python-name">compiler</span> <span class="python-operator">=</span> <span class="python-name">None</span>
<a name="L28" class="line-number">  28 </a><span class="python-keyword">try</span><span class="python-operator">:</span>
<a name="L29" class="line-number">  29 </a>    <span class="python-keyword">import</span> <span class="python-name">compiler</span>
<a name="L30" class="line-number">  30 </a><span class="python-keyword">except</span> <span class="python-name">ImportError</span><span class="python-operator">:</span>
<a name="L31" class="line-number">  31 </a>    <span class="python-comment"># for IronPython</span>
<a name="L32" class="line-number">  32 </a>    <span class="python-keyword">pass</span>
<a name="L33" class="line-number">  33 </a><span class="python-keyword">from</span> <span class="python-name">types</span> <span class="python-keyword">import</span> <span class="python-name">StringTypes</span>
<a name="L34" class="line-number">  34 </a><span class="python-keyword">from</span> <span class="python-name">warnings</span> <span class="python-keyword">import</span> <span class="python-name">warn</span>
<a name="L35" class="line-number">  35 </a><span class="python-keyword">try</span><span class="python-operator">:</span>
<a name="L36" class="line-number">  36 </a>    <span class="python-keyword">from</span> <span class="python-name">codecs</span> <span class="python-keyword">import</span> <span class="python-name">BOM_UTF8</span><span class="python-operator">,</span> <span class="python-name">BOM_UTF16</span><span class="python-operator">,</span> <span class="python-name">BOM_UTF16_BE</span><span class="python-operator">,</span> <span class="python-name">BOM_UTF16_LE</span>
<a name="L37" class="line-number">  37 </a><span class="python-keyword">except</span> <span class="python-name">ImportError</span><span class="python-operator">:</span>
<a name="L38" class="line-number">  38 </a>    <span class="python-comment"># Python 2.2 does not have these</span>
<a name="L39" class="line-number">  39 </a>    <span class="python-comment"># UTF-8</span>
<a name="L40" class="line-number">  40 </a>    <span class="python-name">BOM_UTF8</span> <span class="python-operator">=</span> <span class="python-string">'\xef\xbb\xbf'</span>
<a name="L41" class="line-number">  41 </a>    <span class="python-comment"># UTF-16, little endian</span>
<a name="L42" class="line-number">  42 </a>    <span class="python-name">BOM_UTF16_LE</span> <span class="python-operator">=</span> <span class="python-string">'\xff\xfe'</span>
<a name="L43" class="line-number">  43 </a>    <span class="python-comment"># UTF-16, big endian</span>
<a name="L44" class="line-number">  44 </a>    <span class="python-name">BOM_UTF16_BE</span> <span class="python-operator">=</span> <span class="python-string">'\xfe\xff'</span>
<a name="L45" class="line-number">  45 </a>    <span class="python-keyword">if</span> <span class="python-name">sys</span><span class="python-operator">.</span><span class="python-name">byteorder</span> <span class="python-operator">==</span> <span class="python-string">'little'</span><span class="python-operator">:</span>
<a name="L46" class="line-number">  46 </a>        <span class="python-comment"># UTF-16, native endianness</span>
<a name="L47" class="line-number">  47 </a>        <span class="python-name">BOM_UTF16</span> <span class="python-operator">=</span> <span class="python-name">BOM_UTF16_LE</span>
<a name="L48" class="line-number">  48 </a>    <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L49" class="line-number">  49 </a>        <span class="python-comment"># UTF-16, native endianness</span>
<a name="L50" class="line-number">  50 </a>        <span class="python-name">BOM_UTF16</span> <span class="python-operator">=</span> <span class="python-name">BOM_UTF16_BE</span>
<a name="L51" class="line-number">  51 </a>
<a name="L52" class="line-number">  52 </a><span class="python-comment"># A dictionary mapping BOM to</span>
<a name="L53" class="line-number">  53 </a><span class="python-comment"># the encoding to decode with, and what to set the</span>
<a name="L54" class="line-number">  54 </a><span class="python-comment"># encoding attribute to.</span>
<a name="L55" class="line-number">  55 </a><span class="python-name">BOMS</span> <span class="python-operator">=</span> <span class="python-operator">{</span>
<a name="L56" class="line-number">  56 </a>    <span class="python-name">BOM_UTF8</span><span class="python-operator">:</span> <span class="python-operator">(</span><span class="python-string">'utf_8'</span><span class="python-operator">,</span> <span class="python-name">None</span><span class="python-operator">)</span><span class="python-operator">,</span>
<a name="L57" class="line-number">  57 </a>    <span class="python-name">BOM_UTF16_BE</span><span class="python-operator">:</span> <span class="python-operator">(</span><span class="python-string">'utf16_be'</span><span class="python-operator">,</span> <span class="python-string">'utf_16'</span><span class="python-operator">)</span><span class="python-operator">,</span>
<a name="L58" class="line-number">  58 </a>    <span class="python-name">BOM_UTF16_LE</span><span class="python-operator">:</span> <span class="python-operator">(</span><span class="python-string">'utf16_le'</span><span class="python-operator">,</span> <span class="python-string">'utf_16'</span><span class="python-operator">)</span><span class="python-operator">,</span>
<a name="L59" class="line-number">  59 </a>    <span class="python-name">BOM_UTF16</span><span class="python-operator">:</span> <span class="python-operator">(</span><span class="python-string">'utf_16'</span><span class="python-operator">,</span> <span class="python-string">'utf_16'</span><span class="python-operator">)</span><span class="python-operator">,</span>
<a name="L60" class="line-number">  60 </a>    <span class="python-operator">}</span>
<a name="L61" class="line-number">  61 </a><span class="python-comment"># All legal variants of the BOM codecs.</span>
<a name="L62" class="line-number">  62 </a><span class="python-comment"># TODO: the list of aliases is not meant to be exhaustive, is there a</span>
<a name="L63" class="line-number">  63 </a><span class="python-comment">#   better way ?</span>
<a name="L64" class="line-number">  64 </a><span class="python-name">BOM_LIST</span> <span class="python-operator">=</span> <span class="python-operator">{</span>
<a name="L65" class="line-number">  65 </a>    <span class="python-string">'utf_16'</span><span class="python-operator">:</span> <span class="python-string">'utf_16'</span><span class="python-operator">,</span>
<a name="L66" class="line-number">  66 </a>    <span class="python-string">'u16'</span><span class="python-operator">:</span> <span class="python-string">'utf_16'</span><span class="python-operator">,</span>
<a name="L67" class="line-number">  67 </a>    <span class="python-string">'utf16'</span><span class="python-operator">:</span> <span class="python-string">'utf_16'</span><span class="python-operator">,</span>
<a name="L68" class="line-number">  68 </a>    <span class="python-string">'utf-16'</span><span class="python-operator">:</span> <span class="python-string">'utf_16'</span><span class="python-operator">,</span>
<a name="L69" class="line-number">  69 </a>    <span class="python-string">'utf16_be'</span><span class="python-operator">:</span> <span class="python-string">'utf16_be'</span><span class="python-operator">,</span>
<a name="L70" class="line-number">  70 </a>    <span class="python-string">'utf_16_be'</span><span class="python-operator">:</span> <span class="python-string">'utf16_be'</span><span class="python-operator">,</span>
<a name="L71" class="line-number">  71 </a>    <span class="python-string">'utf-16be'</span><span class="python-operator">:</span> <span class="python-string">'utf16_be'</span><span class="python-operator">,</span>
<a name="L72" class="line-number">  72 </a>    <span class="python-string">'utf16_le'</span><span class="python-operator">:</span> <span class="python-string">'utf16_le'</span><span class="python-operator">,</span>
<a name="L73" class="line-number">  73 </a>    <span class="python-string">'utf_16_le'</span><span class="python-operator">:</span> <span class="python-string">'utf16_le'</span><span class="python-operator">,</span>
<a name="L74" class="line-number">  74 </a>    <span class="python-string">'utf-16le'</span><span class="python-operator">:</span> <span class="python-string">'utf16_le'</span><span class="python-operator">,</span>
<a name="L75" class="line-number">  75 </a>    <span class="python-string">'utf_8'</span><span class="python-operator">:</span> <span class="python-string">'utf_8'</span><span class="python-operator">,</span>
<a name="L76" class="line-number">  76 </a>    <span class="python-string">'u8'</span><span class="python-operator">:</span> <span class="python-string">'utf_8'</span><span class="python-operator">,</span>
<a name="L77" class="line-number">  77 </a>    <span class="python-string">'utf'</span><span class="python-operator">:</span> <span class="python-string">'utf_8'</span><span class="python-operator">,</span>
<a name="L78" class="line-number">  78 </a>    <span class="python-string">'utf8'</span><span class="python-operator">:</span> <span class="python-string">'utf_8'</span><span class="python-operator">,</span>
<a name="L79" class="line-number">  79 </a>    <span class="python-string">'utf-8'</span><span class="python-operator">:</span> <span class="python-string">'utf_8'</span><span class="python-operator">,</span>
<a name="L80" class="line-number">  80 </a>    <span class="python-operator">}</span>
<a name="L81" class="line-number">  81 </a>
<a name="L82" class="line-number">  82 </a><span class="python-comment"># Map of encodings to the BOM to write.</span>
<a name="L83" class="line-number">  83 </a><span class="python-name">BOM_SET</span> <span class="python-operator">=</span> <span class="python-operator">{</span>
<a name="L84" class="line-number">  84 </a>    <span class="python-string">'utf_8'</span><span class="python-operator">:</span> <span class="python-name">BOM_UTF8</span><span class="python-operator">,</span>
<a name="L85" class="line-number">  85 </a>    <span class="python-string">'utf_16'</span><span class="python-operator">:</span> <span class="python-name">BOM_UTF16</span><span class="python-operator">,</span>
<a name="L86" class="line-number">  86 </a>    <span class="python-string">'utf16_be'</span><span class="python-operator">:</span> <span class="python-name">BOM_UTF16_BE</span><span class="python-operator">,</span>
<a name="L87" class="line-number">  87 </a>    <span class="python-string">'utf16_le'</span><span class="python-operator">:</span> <span class="python-name">BOM_UTF16_LE</span><span class="python-operator">,</span>
<a name="L88" class="line-number">  88 </a>    <span class="python-name">None</span><span class="python-operator">:</span> <span class="python-name">BOM_UTF8</span>
<a name="L89" class="line-number">  89 </a>    <span class="python-operator">}</span>
<a name="L90" class="line-number">  90 </a>
<a name="L91" class="line-number">  91 </a><span class="python-keyword">try</span><span class="python-operator">:</span>
<a name="L92" class="line-number">  92 </a>    <span class="python-keyword">from</span> <span class="python-operator">.</span><span class="python-name">validate</span> <span class="python-keyword">import</span> <span class="python-name">VdtMissingValue</span>
<a name="L93" class="line-number">  93 </a><span class="python-keyword">except</span> <span class="python-name">ImportError</span><span class="python-operator">:</span>
<a name="L94" class="line-number">  94 </a>    <span class="python-name">VdtMissingValue</span> <span class="python-operator">=</span> <span class="python-name">None</span>
<a name="L95" class="line-number">  95 </a>
<a name="L96" class="line-number">  96 </a><span class="python-keyword">try</span><span class="python-operator">:</span>
<a name="L97" class="line-number">  97 </a>    <span class="python-name">enumerate</span>
<a name="L98" class="line-number">  98 </a><span class="python-keyword">except</span> <span class="python-name">NameError</span><span class="python-operator">:</span>
<a name="L99" class="line-number">  99 </a>    <span class="python-keyword">def</span> <span class="python-name">enumerate</span><span class="python-operator">(</span><span class="python-name">obj</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L100" class="line-number"> 100 </a>        <span class="python-string">"""enumerate for Python 2.2."""</span>
<a name="L101" class="line-number"> 101 </a>        <span class="python-name">i</span> <span class="python-operator">=</span> <span class="python-operator">-</span><span class="python-number">1</span>
<a name="L102" class="line-number"> 102 </a>        <span class="python-keyword">for</span> <span class="python-name">item</span> <span class="python-keyword">in</span> <span class="python-name">obj</span><span class="python-operator">:</span>
<a name="L103" class="line-number"> 103 </a>            <span class="python-name">i</span> <span class="python-operator">+=</span> <span class="python-number">1</span>
<a name="L104" class="line-number"> 104 </a>            <span class="python-keyword">yield</span> <span class="python-name">i</span><span class="python-operator">,</span> <span class="python-name">item</span>
<a name="L105" class="line-number"> 105 </a>
<a name="L106" class="line-number"> 106 </a><span class="python-keyword">try</span><span class="python-operator">:</span>
<a name="L107" class="line-number"> 107 </a>    <span class="python-name">True</span><span class="python-operator">,</span> <span class="python-name">False</span>
<a name="L108" class="line-number"> 108 </a><span class="python-keyword">except</span> <span class="python-name">NameError</span><span class="python-operator">:</span>
<a name="L109" class="line-number"> 109 </a>    <span class="python-name">True</span><span class="python-operator">,</span> <span class="python-name">False</span> <span class="python-operator">=</span> <span class="python-number">1</span><span class="python-operator">,</span> <span class="python-number">0</span>
<a name="L110" class="line-number"> 110 </a>
<a name="L111" class="line-number"> 111 </a>
<a name="L112" class="line-number"> 112 </a><span class="python-name">__version__</span> <span class="python-operator">=</span> <span class="python-string">'4.4.0'</span>
<a name="L113" class="line-number"> 113 </a>
<a name="L114" class="line-number"> 114 </a><span class="python-name">__revision__</span> <span class="python-operator">=</span> <span class="python-string">'$Id: configobj.py 156 2006-01-31 14:57:08Z fuzzyman $'</span>
<a name="L115" class="line-number"> 115 </a>
<a name="L116" class="line-number"> 116 </a><span class="python-name">__docformat__</span> <span class="python-operator">=</span> <span class="python-string">"restructuredtext en"</span>
<a name="L117" class="line-number"> 117 </a>
<a name="L118" class="line-number"> 118 </a><span class="python-name">__all__</span> <span class="python-operator">=</span> <span class="python-operator">(</span>
<a name="L119" class="line-number"> 119 </a>    <span class="python-string">'__version__'</span><span class="python-operator">,</span>
<a name="L120" class="line-number"> 120 </a>    <span class="python-string">'DEFAULT_INDENT_TYPE'</span><span class="python-operator">,</span>
<a name="L121" class="line-number"> 121 </a>    <span class="python-string">'DEFAULT_INTERPOLATION'</span><span class="python-operator">,</span>
<a name="L122" class="line-number"> 122 </a>    <span class="python-string">'ConfigObjError'</span><span class="python-operator">,</span>
<a name="L123" class="line-number"> 123 </a>    <span class="python-string">'NestingError'</span><span class="python-operator">,</span>
<a name="L124" class="line-number"> 124 </a>    <span class="python-string">'ParseError'</span><span class="python-operator">,</span>
<a name="L125" class="line-number"> 125 </a>    <span class="python-string">'DuplicateError'</span><span class="python-operator">,</span>
<a name="L126" class="line-number"> 126 </a>    <span class="python-string">'ConfigspecError'</span><span class="python-operator">,</span>
<a name="L127" class="line-number"> 127 </a>    <span class="python-string">'ConfigObj'</span><span class="python-operator">,</span>
<a name="L128" class="line-number"> 128 </a>    <span class="python-string">'SimpleVal'</span><span class="python-operator">,</span>
<a name="L129" class="line-number"> 129 </a>    <span class="python-string">'InterpolationError'</span><span class="python-operator">,</span>
<a name="L130" class="line-number"> 130 </a>    <span class="python-string">'InterpolationLoopError'</span><span class="python-operator">,</span>
<a name="L131" class="line-number"> 131 </a>    <span class="python-string">'MissingInterpolationOption'</span><span class="python-operator">,</span>
<a name="L132" class="line-number"> 132 </a>    <span class="python-string">'RepeatSectionError'</span><span class="python-operator">,</span>
<a name="L133" class="line-number"> 133 </a>    <span class="python-string">'UnreprError'</span><span class="python-operator">,</span>
<a name="L134" class="line-number"> 134 </a>    <span class="python-string">'UnknownType'</span><span class="python-operator">,</span>
<a name="L135" class="line-number"> 135 </a>    <span class="python-string">'__docformat__'</span><span class="python-operator">,</span>
<a name="L136" class="line-number"> 136 </a>    <span class="python-string">'flatten_errors'</span><span class="python-operator">,</span>
<a name="L137" class="line-number"> 137 </a><span class="python-operator">)</span>
<a name="L138" class="line-number"> 138 </a>
<a name="L139" class="line-number"> 139 </a><span class="python-name">DEFAULT_INTERPOLATION</span> <span class="python-operator">=</span> <span class="python-string">'configparser'</span>
<a name="L140" class="line-number"> 140 </a><span class="python-name">DEFAULT_INDENT_TYPE</span> <span class="python-operator">=</span> <span class="python-string">'    '</span>
<a name="L141" class="line-number"> 141 </a><span class="python-name">MAX_INTERPOL_DEPTH</span> <span class="python-operator">=</span> <span class="python-number">10</span>
<a name="L142" class="line-number"> 142 </a>
<a name="L143" class="line-number"> 143 </a><span class="python-name">OPTION_DEFAULTS</span> <span class="python-operator">=</span> <span class="python-operator">{</span>
<a name="L144" class="line-number"> 144 </a>    <span class="python-string">'interpolation'</span><span class="python-operator">:</span> <span class="python-name">True</span><span class="python-operator">,</span>
<a name="L145" class="line-number"> 145 </a>    <span class="python-string">'raise_errors'</span><span class="python-operator">:</span> <span class="python-name">False</span><span class="python-operator">,</span>
<a name="L146" class="line-number"> 146 </a>    <span class="python-string">'list_values'</span><span class="python-operator">:</span> <span class="python-name">True</span><span class="python-operator">,</span>
<a name="L147" class="line-number"> 147 </a>    <span class="python-string">'create_empty'</span><span class="python-operator">:</span> <span class="python-name">False</span><span class="python-operator">,</span>
<a name="L148" class="line-number"> 148 </a>    <span class="python-string">'file_error'</span><span class="python-operator">:</span> <span class="python-name">False</span><span class="python-operator">,</span>
<a name="L149" class="line-number"> 149 </a>    <span class="python-string">'configspec'</span><span class="python-operator">:</span> <span class="python-name">None</span><span class="python-operator">,</span>
<a name="L150" class="line-number"> 150 </a>    <span class="python-string">'stringify'</span><span class="python-operator">:</span> <span class="python-name">True</span><span class="python-operator">,</span>
<a name="L151" class="line-number"> 151 </a>    <span class="python-comment"># option may be set to one of ('', ' ', '\t')</span>
<a name="L152" class="line-number"> 152 </a>    <span class="python-string">'indent_type'</span><span class="python-operator">:</span> <span class="python-name">None</span><span class="python-operator">,</span>
<a name="L153" class="line-number"> 153 </a>    <span class="python-string">'encoding'</span><span class="python-operator">:</span> <span class="python-name">None</span><span class="python-operator">,</span>
<a name="L154" class="line-number"> 154 </a>    <span class="python-string">'default_encoding'</span><span class="python-operator">:</span> <span class="python-name">None</span><span class="python-operator">,</span>
<a name="L155" class="line-number"> 155 </a>    <span class="python-string">'unrepr'</span><span class="python-operator">:</span> <span class="python-name">False</span><span class="python-operator">,</span>
<a name="L156" class="line-number"> 156 </a>    <span class="python-string">'write_empty_values'</span><span class="python-operator">:</span> <span class="python-name">False</span><span class="python-operator">,</span>
<a name="L157" class="line-number"> 157 </a><span class="python-operator">}</span>
<a name="L158" class="line-number"> 158 </a>
<a name="L159" class="line-number"> 159 </a>
<a name="L160" class="line-number"> 160 </a><span class="python-keyword">def</span> <span class="python-name">getObj</span><span class="python-operator">(</span><span class="python-name">s</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L161" class="line-number"> 161 </a>    <span class="python-name">s</span> <span class="python-operator">=</span> <span class="python-string">"a="</span> <span class="python-operator">+</span> <span class="python-name">s</span>
<a name="L162" class="line-number"> 162 </a>    <span class="python-keyword">if</span> <span class="python-name">compiler</span> <span class="python-keyword">is</span> <span class="python-name">None</span><span class="python-operator">:</span>
<a name="L163" class="line-number"> 163 </a>        <span class="python-keyword">raise</span> <span class="python-name">ImportError</span><span class="python-operator">(</span><span class="python-string">'compiler module not available'</span><span class="python-operator">)</span>
<a name="L164" class="line-number"> 164 </a>    <span class="python-name">p</span> <span class="python-operator">=</span> <span class="python-name">compiler</span><span class="python-operator">.</span><span class="python-name">parse</span><span class="python-operator">(</span><span class="python-name">s</span><span class="python-operator">)</span>
<a name="L165" class="line-number"> 165 </a>    <span class="python-keyword">return</span> <span class="python-name">p</span><span class="python-operator">.</span><span class="python-name">getChildren</span><span class="python-operator">(</span><span class="python-operator">)</span><span class="python-operator">[</span><span class="python-number">1</span><span class="python-operator">]</span><span class="python-operator">.</span><span class="python-name">getChildren</span><span class="python-operator">(</span><span class="python-operator">)</span><span class="python-operator">[</span><span class="python-number">0</span><span class="python-operator">]</span><span class="python-operator">.</span><span class="python-name">getChildren</span><span class="python-operator">(</span><span class="python-operator">)</span><span class="python-operator">[</span><span class="python-number">1</span><span class="python-operator">]</span>
<a name="L166" class="line-number"> 166 </a>
<a name="L167" class="line-number"> 167 </a><span class="python-keyword">class</span> <span class="python-name">UnknownType</span><span class="python-operator">(</span><span class="python-name">Exception</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L168" class="line-number"> 168 </a>    <span class="python-keyword">pass</span>
<a name="L169" class="line-number"> 169 </a>
<a name="L170" class="line-number"> 170 </a><span class="python-keyword">class</span> <span class="python-name">Builder</span><span class="python-operator">:</span>
<a name="L171" class="line-number"> 171 </a>
<a name="L172" class="line-number"> 172 </a>    <span class="python-keyword">def</span> <span class="python-name">build</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">o</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L173" class="line-number"> 173 </a>        <span class="python-name">m</span> <span class="python-operator">=</span> <span class="python-name">getattr</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-string">'build_'</span> <span class="python-operator">+</span> <span class="python-name">o</span><span class="python-operator">.</span><span class="python-name">__class__</span><span class="python-operator">.</span><span class="python-name">__name__</span><span class="python-operator">,</span> <span class="python-name">None</span><span class="python-operator">)</span>
<a name="L174" class="line-number"> 174 </a>        <span class="python-keyword">if</span> <span class="python-name">m</span> <span class="python-keyword">is</span> <span class="python-name">None</span><span class="python-operator">:</span>
<a name="L175" class="line-number"> 175 </a>            <span class="python-keyword">raise</span> <span class="python-name">UnknownType</span><span class="python-operator">(</span><span class="python-name">o</span><span class="python-operator">.</span><span class="python-name">__class__</span><span class="python-operator">.</span><span class="python-name">__name__</span><span class="python-operator">)</span>
<a name="L176" class="line-number"> 176 </a>        <span class="python-keyword">return</span> <span class="python-name">m</span><span class="python-operator">(</span><span class="python-name">o</span><span class="python-operator">)</span>
<a name="L177" class="line-number"> 177 </a>
<a name="L178" class="line-number"> 178 </a>    <span class="python-keyword">def</span> <span class="python-name">build_List</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">o</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L179" class="line-number"> 179 </a>        <span class="python-keyword">return</span> <span class="python-name">map</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">build</span><span class="python-operator">,</span> <span class="python-name">o</span><span class="python-operator">.</span><span class="python-name">getChildren</span><span class="python-operator">(</span><span class="python-operator">)</span><span class="python-operator">)</span>
<a name="L180" class="line-number"> 180 </a>
<a name="L181" class="line-number"> 181 </a>    <span class="python-keyword">def</span> <span class="python-name">build_Const</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">o</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L182" class="line-number"> 182 </a>        <span class="python-keyword">return</span> <span class="python-name">o</span><span class="python-operator">.</span><span class="python-name">value</span>
<a name="L183" class="line-number"> 183 </a>
<a name="L184" class="line-number"> 184 </a>    <span class="python-keyword">def</span> <span class="python-name">build_Dict</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">o</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L185" class="line-number"> 185 </a>        <span class="python-name">d</span> <span class="python-operator">=</span> <span class="python-operator">{</span><span class="python-operator">}</span>
<a name="L186" class="line-number"> 186 </a>        <span class="python-name">i</span> <span class="python-operator">=</span> <span class="python-name">iter</span><span class="python-operator">(</span><span class="python-name">map</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">build</span><span class="python-operator">,</span> <span class="python-name">o</span><span class="python-operator">.</span><span class="python-name">getChildren</span><span class="python-operator">(</span><span class="python-operator">)</span><span class="python-operator">)</span><span class="python-operator">)</span>
<a name="L187" class="line-number"> 187 </a>        <span class="python-keyword">for</span> <span class="python-name">el</span> <span class="python-keyword">in</span> <span class="python-name">i</span><span class="python-operator">:</span>
<a name="L188" class="line-number"> 188 </a>            <span class="python-name">d</span><span class="python-operator">[</span><span class="python-name">el</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-name">i</span><span class="python-operator">.</span><span class="python-name">next</span><span class="python-operator">(</span><span class="python-operator">)</span>
<a name="L189" class="line-number"> 189 </a>        <span class="python-keyword">return</span> <span class="python-name">d</span>
<a name="L190" class="line-number"> 190 </a>
<a name="L191" class="line-number"> 191 </a>    <span class="python-keyword">def</span> <span class="python-name">build_Tuple</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">o</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L192" class="line-number"> 192 </a>        <span class="python-keyword">return</span> <span class="python-name">tuple</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">build_List</span><span class="python-operator">(</span><span class="python-name">o</span><span class="python-operator">)</span><span class="python-operator">)</span>
<a name="L193" class="line-number"> 193 </a>
<a name="L194" class="line-number"> 194 </a>    <span class="python-keyword">def</span> <span class="python-name">build_Name</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">o</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L195" class="line-number"> 195 </a>        <span class="python-keyword">if</span> <span class="python-name">o</span><span class="python-operator">.</span><span class="python-name">name</span> <span class="python-operator">==</span> <span class="python-string">'None'</span><span class="python-operator">:</span>
<a name="L196" class="line-number"> 196 </a>            <span class="python-keyword">return</span> <span class="python-name">None</span>
<a name="L197" class="line-number"> 197 </a>        <span class="python-keyword">if</span> <span class="python-name">o</span><span class="python-operator">.</span><span class="python-name">name</span> <span class="python-operator">==</span> <span class="python-string">'True'</span><span class="python-operator">:</span>
<a name="L198" class="line-number"> 198 </a>            <span class="python-keyword">return</span> <span class="python-name">True</span>
<a name="L199" class="line-number"> 199 </a>        <span class="python-keyword">if</span> <span class="python-name">o</span><span class="python-operator">.</span><span class="python-name">name</span> <span class="python-operator">==</span> <span class="python-string">'False'</span><span class="python-operator">:</span>
<a name="L200" class="line-number"> 200 </a>            <span class="python-keyword">return</span> <span class="python-name">False</span>
<a name="L201" class="line-number"> 201 </a>
<a name="L202" class="line-number"> 202 </a>        <span class="python-comment"># An undefinted Name</span>
<a name="L203" class="line-number"> 203 </a>        <span class="python-keyword">raise</span> <span class="python-name">UnknownType</span><span class="python-operator">(</span><span class="python-string">'Undefined Name'</span><span class="python-operator">)</span>
<a name="L204" class="line-number"> 204 </a>
<a name="L205" class="line-number"> 205 </a>    <span class="python-keyword">def</span> <span class="python-name">build_Add</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">o</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L206" class="line-number"> 206 </a>        <span class="python-name">real</span><span class="python-operator">,</span> <span class="python-name">imag</span> <span class="python-operator">=</span> <span class="python-name">map</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">build_Const</span><span class="python-operator">,</span> <span class="python-name">o</span><span class="python-operator">.</span><span class="python-name">getChildren</span><span class="python-operator">(</span><span class="python-operator">)</span><span class="python-operator">)</span>
<a name="L207" class="line-number"> 207 </a>        <span class="python-keyword">try</span><span class="python-operator">:</span>
<a name="L208" class="line-number"> 208 </a>            <span class="python-name">real</span> <span class="python-operator">=</span> <span class="python-name">float</span><span class="python-operator">(</span><span class="python-name">real</span><span class="python-operator">)</span>
<a name="L209" class="line-number"> 209 </a>        <span class="python-keyword">except</span> <span class="python-name">TypeError</span><span class="python-operator">:</span>
<a name="L210" class="line-number"> 210 </a>            <span class="python-keyword">raise</span> <span class="python-name">UnknownType</span><span class="python-operator">(</span><span class="python-string">'Add'</span><span class="python-operator">)</span>
<a name="L211" class="line-number"> 211 </a>        <span class="python-keyword">if</span> <span class="python-keyword">not</span> <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">imag</span><span class="python-operator">,</span> <span class="python-name">complex</span><span class="python-operator">)</span> <span class="python-keyword">or</span> <span class="python-name">imag</span><span class="python-operator">.</span><span class="python-name">real</span> <span class="python-operator">!=</span> <span class="python-number">0.0</span><span class="python-operator">:</span>
<a name="L212" class="line-number"> 212 </a>            <span class="python-keyword">raise</span> <span class="python-name">UnknownType</span><span class="python-operator">(</span><span class="python-string">'Add'</span><span class="python-operator">)</span>
<a name="L213" class="line-number"> 213 </a>        <span class="python-keyword">return</span> <span class="python-name">real</span><span class="python-operator">+</span><span class="python-name">imag</span>
<a name="L214" class="line-number"> 214 </a>
<a name="L215" class="line-number"> 215 </a>    <span class="python-keyword">def</span> <span class="python-name">build_Getattr</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">o</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L216" class="line-number"> 216 </a>        <span class="python-name">parent</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">build</span><span class="python-operator">(</span><span class="python-name">o</span><span class="python-operator">.</span><span class="python-name">expr</span><span class="python-operator">)</span>
<a name="L217" class="line-number"> 217 </a>        <span class="python-keyword">return</span> <span class="python-name">getattr</span><span class="python-operator">(</span><span class="python-name">parent</span><span class="python-operator">,</span> <span class="python-name">o</span><span class="python-operator">.</span><span class="python-name">attrname</span><span class="python-operator">)</span>
<a name="L218" class="line-number"> 218 </a>
<a name="L219" class="line-number"> 219 </a>    <span class="python-keyword">def</span> <span class="python-name">build_UnarySub</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">o</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L220" class="line-number"> 220 </a>        <span class="python-keyword">return</span> <span class="python-operator">-</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">build_Const</span><span class="python-operator">(</span><span class="python-name">o</span><span class="python-operator">.</span><span class="python-name">getChildren</span><span class="python-operator">(</span><span class="python-operator">)</span><span class="python-operator">[</span><span class="python-number">0</span><span class="python-operator">]</span><span class="python-operator">)</span>
<a name="L221" class="line-number"> 221 </a>
<a name="L222" class="line-number"> 222 </a>    <span class="python-keyword">def</span> <span class="python-name">build_UnaryAdd</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">o</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L223" class="line-number"> 223 </a>        <span class="python-keyword">return</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">build_Const</span><span class="python-operator">(</span><span class="python-name">o</span><span class="python-operator">.</span><span class="python-name">getChildren</span><span class="python-operator">(</span><span class="python-operator">)</span><span class="python-operator">[</span><span class="python-number">0</span><span class="python-operator">]</span><span class="python-operator">)</span>
<a name="L224" class="line-number"> 224 </a>
<a name="L225" class="line-number"> 225 </a><span class="python-keyword">def</span> <span class="python-name">unrepr</span><span class="python-operator">(</span><span class="python-name">s</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L226" class="line-number"> 226 </a>    <span class="python-keyword">if</span> <span class="python-keyword">not</span> <span class="python-name">s</span><span class="python-operator">:</span>
<a name="L227" class="line-number"> 227 </a>        <span class="python-keyword">return</span> <span class="python-name">s</span>
<a name="L228" class="line-number"> 228 </a>    <span class="python-keyword">return</span> <span class="python-name">Builder</span><span class="python-operator">(</span><span class="python-operator">)</span><span class="python-operator">.</span><span class="python-name">build</span><span class="python-operator">(</span><span class="python-name">getObj</span><span class="python-operator">(</span><span class="python-name">s</span><span class="python-operator">)</span><span class="python-operator">)</span>
<a name="L229" class="line-number"> 229 </a>
<a name="L230" class="line-number"> 230 </a><span class="python-keyword">def</span> <span class="python-name">_splitlines</span><span class="python-operator">(</span><span class="python-name">instring</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L231" class="line-number"> 231 </a>    <span class="python-string">"""Split a string on lines, without losing line endings or truncating."""</span>
<a name="L232" class="line-number"> 232 </a>
<a name="L233" class="line-number"> 233 </a>
<a name="L234" class="line-number"> 234 </a><span class="python-keyword">class</span> <span class="python-name">ConfigObjError</span><span class="python-operator">(</span><span class="python-name">SyntaxError</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L235" class="line-number"> 235 </a>    <span class="python-string">"""
<a name="L236" class="line-number"> 236 </a>    This is the base class for all errors that ConfigObj raises.
<a name="L237" class="line-number"> 237 </a>    It is a subclass of SyntaxError.
<a name="L238" class="line-number"> 238 </a>    """</span>
<a name="L239" class="line-number"> 239 </a>    <span class="python-keyword">def</span> <span class="python-name">__init__</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">message</span><span class="python-operator">=</span><span class="python-string">''</span><span class="python-operator">,</span> <span class="python-name">line_number</span><span class="python-operator">=</span><span class="python-name">None</span><span class="python-operator">,</span> <span class="python-name">line</span><span class="python-operator">=</span><span class="python-string">''</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L240" class="line-number"> 240 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">line</span> <span class="python-operator">=</span> <span class="python-name">line</span>
<a name="L241" class="line-number"> 241 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">line_number</span> <span class="python-operator">=</span> <span class="python-name">line_number</span>
<a name="L242" class="line-number"> 242 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">message</span> <span class="python-operator">=</span> <span class="python-name">message</span>
<a name="L243" class="line-number"> 243 </a>        <span class="python-name">SyntaxError</span><span class="python-operator">.</span><span class="python-name">__init__</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">message</span><span class="python-operator">)</span>
<a name="L244" class="line-number"> 244 </a>
<a name="L245" class="line-number"> 245 </a><span class="python-keyword">class</span> <span class="python-name">NestingError</span><span class="python-operator">(</span><span class="python-name">ConfigObjError</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L246" class="line-number"> 246 </a>    <span class="python-string">"""
<a name="L247" class="line-number"> 247 </a>    This error indicates a level of nesting that doesn't match.
<a name="L248" class="line-number"> 248 </a>    """</span>
<a name="L249" class="line-number"> 249 </a>
<a name="L250" class="line-number"> 250 </a><span class="python-keyword">class</span> <span class="python-name">ParseError</span><span class="python-operator">(</span><span class="python-name">ConfigObjError</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L251" class="line-number"> 251 </a>    <span class="python-string">"""
<a name="L252" class="line-number"> 252 </a>    This error indicates that a line is badly written.
<a name="L253" class="line-number"> 253 </a>    It is neither a valid ``key = value`` line,
<a name="L254" class="line-number"> 254 </a>    nor a valid section marker line.
<a name="L255" class="line-number"> 255 </a>    """</span>
<a name="L256" class="line-number"> 256 </a>
<a name="L257" class="line-number"> 257 </a><span class="python-keyword">class</span> <span class="python-name">DuplicateError</span><span class="python-operator">(</span><span class="python-name">ConfigObjError</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L258" class="line-number"> 258 </a>    <span class="python-string">"""
<a name="L259" class="line-number"> 259 </a>    The keyword or section specified already exists.
<a name="L260" class="line-number"> 260 </a>    """</span>
<a name="L261" class="line-number"> 261 </a>
<a name="L262" class="line-number"> 262 </a><span class="python-keyword">class</span> <span class="python-name">ConfigspecError</span><span class="python-operator">(</span><span class="python-name">ConfigObjError</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L263" class="line-number"> 263 </a>    <span class="python-string">"""
<a name="L264" class="line-number"> 264 </a>    An error occured whilst parsing a configspec.
<a name="L265" class="line-number"> 265 </a>    """</span>
<a name="L266" class="line-number"> 266 </a>
<a name="L267" class="line-number"> 267 </a><span class="python-keyword">class</span> <span class="python-name">InterpolationError</span><span class="python-operator">(</span><span class="python-name">ConfigObjError</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L268" class="line-number"> 268 </a>    <span class="python-string">"""Base class for the two interpolation errors."""</span>
<a name="L269" class="line-number"> 269 </a>
<a name="L270" class="line-number"> 270 </a><span class="python-keyword">class</span> <span class="python-name">InterpolationLoopError</span><span class="python-operator">(</span><span class="python-name">InterpolationError</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L271" class="line-number"> 271 </a>    <span class="python-string">"""Maximum interpolation depth exceeded in string interpolation."""</span>
<a name="L272" class="line-number"> 272 </a>
<a name="L273" class="line-number"> 273 </a>    <span class="python-keyword">def</span> <span class="python-name">__init__</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">option</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L274" class="line-number"> 274 </a>        <span class="python-name">InterpolationError</span><span class="python-operator">.</span><span class="python-name">__init__</span><span class="python-operator">(</span>
<a name="L275" class="line-number"> 275 </a>            <span class="python-name">self</span><span class="python-operator">,</span>
<a name="L276" class="line-number"> 276 </a>            <span class="python-string">'interpolation loop detected in value "%s".'</span> <span class="python-operator">%</span> <span class="python-name">option</span><span class="python-operator">)</span>
<a name="L277" class="line-number"> 277 </a>
<a name="L278" class="line-number"> 278 </a><span class="python-keyword">class</span> <span class="python-name">RepeatSectionError</span><span class="python-operator">(</span><span class="python-name">ConfigObjError</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L279" class="line-number"> 279 </a>    <span class="python-string">"""
<a name="L280" class="line-number"> 280 </a>    This error indicates additional sections in a section with a
<a name="L281" class="line-number"> 281 </a>    ``__many__`` (repeated) section.
<a name="L282" class="line-number"> 282 </a>    """</span>
<a name="L283" class="line-number"> 283 </a>
<a name="L284" class="line-number"> 284 </a><span class="python-keyword">class</span> <span class="python-name">MissingInterpolationOption</span><span class="python-operator">(</span><span class="python-name">InterpolationError</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L285" class="line-number"> 285 </a>    <span class="python-string">"""A value specified for interpolation was missing."""</span>
<a name="L286" class="line-number"> 286 </a>
<a name="L287" class="line-number"> 287 </a>    <span class="python-keyword">def</span> <span class="python-name">__init__</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">option</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L288" class="line-number"> 288 </a>        <span class="python-name">InterpolationError</span><span class="python-operator">.</span><span class="python-name">__init__</span><span class="python-operator">(</span>
<a name="L289" class="line-number"> 289 </a>            <span class="python-name">self</span><span class="python-operator">,</span>
<a name="L290" class="line-number"> 290 </a>            <span class="python-string">'missing option "%s" in interpolation.'</span> <span class="python-operator">%</span> <span class="python-name">option</span><span class="python-operator">)</span>
<a name="L291" class="line-number"> 291 </a>
<a name="L292" class="line-number"> 292 </a><span class="python-keyword">class</span> <span class="python-name">UnreprError</span><span class="python-operator">(</span><span class="python-name">ConfigObjError</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L293" class="line-number"> 293 </a>    <span class="python-string">"""An error parsing in unrepr mode."""</span>
<a name="L294" class="line-number"> 294 </a>
<a name="L295" class="line-number"> 295 </a>
<a name="L296" class="line-number"> 296 </a><span class="python-keyword">class</span> <span class="python-name">InterpolationEngine</span><span class="python-operator">(</span><span class="python-name">object</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L297" class="line-number"> 297 </a>    <span class="python-string">"""
<a name="L298" class="line-number"> 298 </a>    A helper class to help perform string interpolation.
<a name="L299" class="line-number"> 299 </a>
<a name="L300" class="line-number"> 300 </a>    This class is an abstract base class; its descendants perform
<a name="L301" class="line-number"> 301 </a>    the actual work.
<a name="L302" class="line-number"> 302 </a>    """</span>
<a name="L303" class="line-number"> 303 </a>
<a name="L304" class="line-number"> 304 </a>    <span class="python-comment"># compiled regexp to use in self.interpolate()</span>
<a name="L305" class="line-number"> 305 </a>    <span class="python-name">_KEYCRE</span> <span class="python-operator">=</span> <span class="python-name">re</span><span class="python-operator">.</span><span class="python-name">compile</span><span class="python-operator">(</span><span class="python-string">r"%\(([^)]*)\)s"</span><span class="python-operator">)</span>
<a name="L306" class="line-number"> 306 </a>
<a name="L307" class="line-number"> 307 </a>    <span class="python-keyword">def</span> <span class="python-name">__init__</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">section</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L308" class="line-number"> 308 </a>        <span class="python-comment"># the Section instance that "owns" this engine</span>
<a name="L309" class="line-number"> 309 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">section</span> <span class="python-operator">=</span> <span class="python-name">section</span>
<a name="L310" class="line-number"> 310 </a>
<a name="L311" class="line-number"> 311 </a>    <span class="python-keyword">def</span> <span class="python-name">interpolate</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">key</span><span class="python-operator">,</span> <span class="python-name">value</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L312" class="line-number"> 312 </a>        <span class="python-keyword">def</span> <span class="python-name">recursive_interpolate</span><span class="python-operator">(</span><span class="python-name">key</span><span class="python-operator">,</span> <span class="python-name">value</span><span class="python-operator">,</span> <span class="python-name">section</span><span class="python-operator">,</span> <span class="python-name">backtrail</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L313" class="line-number"> 313 </a>            <span class="python-string">"""The function that does the actual work.
<a name="L314" class="line-number"> 314 </a>
<a name="L315" class="line-number"> 315 </a>            ``value``: the string we're trying to interpolate.
<a name="L316" class="line-number"> 316 </a>            ``section``: the section in which that string was found
<a name="L317" class="line-number"> 317 </a>            ``backtrail``: a dict to keep track of where we've been,
<a name="L318" class="line-number"> 318 </a>            to detect and prevent infinite recursion loops
<a name="L319" class="line-number"> 319 </a>
<a name="L320" class="line-number"> 320 </a>            This is similar to a depth-first-search algorithm.
<a name="L321" class="line-number"> 321 </a>            """</span>
<a name="L322" class="line-number"> 322 </a>            <span class="python-comment"># Have we been here already?</span>
<a name="L323" class="line-number"> 323 </a>            <span class="python-keyword">if</span> <span class="python-name">backtrail</span><span class="python-operator">.</span><span class="python-name">has_key</span><span class="python-operator">(</span><span class="python-operator">(</span><span class="python-name">key</span><span class="python-operator">,</span> <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">name</span><span class="python-operator">)</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L324" class="line-number"> 324 </a>                <span class="python-comment"># Yes - infinite loop detected</span>
<a name="L325" class="line-number"> 325 </a>                <span class="python-keyword">raise</span> <span class="python-name">InterpolationLoopError</span><span class="python-operator">(</span><span class="python-name">key</span><span class="python-operator">)</span>
<a name="L326" class="line-number"> 326 </a>            <span class="python-comment"># Place a marker on our backtrail so we won't come back here again</span>
<a name="L327" class="line-number"> 327 </a>            <span class="python-name">backtrail</span><span class="python-operator">[</span><span class="python-operator">(</span><span class="python-name">key</span><span class="python-operator">,</span> <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">name</span><span class="python-operator">)</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-number">1</span>
<a name="L328" class="line-number"> 328 </a>
<a name="L329" class="line-number"> 329 </a>            <span class="python-comment"># Now start the actual work</span>
<a name="L330" class="line-number"> 330 </a>            <span class="python-name">match</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_KEYCRE</span><span class="python-operator">.</span><span class="python-name">search</span><span class="python-operator">(</span><span class="python-name">value</span><span class="python-operator">)</span>
<a name="L331" class="line-number"> 331 </a>            <span class="python-keyword">while</span> <span class="python-name">match</span><span class="python-operator">:</span>
<a name="L332" class="line-number"> 332 </a>                <span class="python-comment"># The actual parsing of the match is implementation-dependent,</span>
<a name="L333" class="line-number"> 333 </a>                <span class="python-comment"># so delegate to our helper function</span>
<a name="L334" class="line-number"> 334 </a>                <span class="python-name">k</span><span class="python-operator">,</span> <span class="python-name">v</span><span class="python-operator">,</span> <span class="python-name">s</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_parse_match</span><span class="python-operator">(</span><span class="python-name">match</span><span class="python-operator">)</span>
<a name="L335" class="line-number"> 335 </a>                <span class="python-keyword">if</span> <span class="python-name">k</span> <span class="python-keyword">is</span> <span class="python-name">None</span><span class="python-operator">:</span>
<a name="L336" class="line-number"> 336 </a>                    <span class="python-comment"># That's the signal that no further interpolation is needed</span>
<a name="L337" class="line-number"> 337 </a>                    <span class="python-name">replacement</span> <span class="python-operator">=</span> <span class="python-name">v</span>
<a name="L338" class="line-number"> 338 </a>                <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L339" class="line-number"> 339 </a>                    <span class="python-comment"># Further interpolation may be needed to obtain final value</span>
<a name="L340" class="line-number"> 340 </a>                    <span class="python-name">replacement</span> <span class="python-operator">=</span> <span class="python-name">recursive_interpolate</span><span class="python-operator">(</span><span class="python-name">k</span><span class="python-operator">,</span> <span class="python-name">v</span><span class="python-operator">,</span> <span class="python-name">s</span><span class="python-operator">,</span> <span class="python-name">backtrail</span><span class="python-operator">)</span>
<a name="L341" class="line-number"> 341 </a>                <span class="python-comment"># Replace the matched string with its final value</span>
<a name="L342" class="line-number"> 342 </a>                <span class="python-name">start</span><span class="python-operator">,</span> <span class="python-name">end</span> <span class="python-operator">=</span> <span class="python-name">match</span><span class="python-operator">.</span><span class="python-name">span</span><span class="python-operator">(</span><span class="python-operator">)</span>
<a name="L343" class="line-number"> 343 </a>                <span class="python-name">value</span> <span class="python-operator">=</span> <span class="python-string">''</span><span class="python-operator">.</span><span class="python-name">join</span><span class="python-operator">(</span><span class="python-operator">(</span><span class="python-name">value</span><span class="python-operator">[</span><span class="python-operator">:</span><span class="python-name">start</span><span class="python-operator">]</span><span class="python-operator">,</span> <span class="python-name">replacement</span><span class="python-operator">,</span> <span class="python-name">value</span><span class="python-operator">[</span><span class="python-name">end</span><span class="python-operator">:</span><span class="python-operator">]</span><span class="python-operator">)</span><span class="python-operator">)</span>
<a name="L344" class="line-number"> 344 </a>                <span class="python-name">new_search_start</span> <span class="python-operator">=</span> <span class="python-name">start</span> <span class="python-operator">+</span> <span class="python-name">len</span><span class="python-operator">(</span><span class="python-name">replacement</span><span class="python-operator">)</span>
<a name="L345" class="line-number"> 345 </a>                <span class="python-comment"># Pick up the next interpolation key, if any, for next time</span>
<a name="L346" class="line-number"> 346 </a>                <span class="python-comment"># through the while loop</span>
<a name="L347" class="line-number"> 347 </a>                <span class="python-name">match</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_KEYCRE</span><span class="python-operator">.</span><span class="python-name">search</span><span class="python-operator">(</span><span class="python-name">value</span><span class="python-operator">,</span> <span class="python-name">new_search_start</span><span class="python-operator">)</span>
<a name="L348" class="line-number"> 348 </a>
<a name="L349" class="line-number"> 349 </a>            <span class="python-comment"># Now safe to come back here again; remove marker from backtrail</span>
<a name="L350" class="line-number"> 350 </a>            <span class="python-keyword">del</span> <span class="python-name">backtrail</span><span class="python-operator">[</span><span class="python-operator">(</span><span class="python-name">key</span><span class="python-operator">,</span> <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">name</span><span class="python-operator">)</span><span class="python-operator">]</span>
<a name="L351" class="line-number"> 351 </a>
<a name="L352" class="line-number"> 352 </a>            <span class="python-keyword">return</span> <span class="python-name">value</span>
<a name="L353" class="line-number"> 353 </a>
<a name="L354" class="line-number"> 354 </a>        <span class="python-comment"># Back in interpolate(), all we have to do is kick off the recursive</span>
<a name="L355" class="line-number"> 355 </a>        <span class="python-comment"># function with appropriate starting values</span>
<a name="L356" class="line-number"> 356 </a>        <span class="python-name">value</span> <span class="python-operator">=</span> <span class="python-name">recursive_interpolate</span><span class="python-operator">(</span><span class="python-name">key</span><span class="python-operator">,</span> <span class="python-name">value</span><span class="python-operator">,</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">section</span><span class="python-operator">,</span> <span class="python-operator">{</span><span class="python-operator">}</span><span class="python-operator">)</span>
<a name="L357" class="line-number"> 357 </a>        <span class="python-keyword">return</span> <span class="python-name">value</span>
<a name="L358" class="line-number"> 358 </a>
<a name="L359" class="line-number"> 359 </a>    <span class="python-keyword">def</span> <span class="python-name">_fetch</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">key</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L360" class="line-number"> 360 </a>        <span class="python-string">"""Helper function to fetch values from owning section.
<a name="L361" class="line-number"> 361 </a>
<a name="L362" class="line-number"> 362 </a>        Returns a 2-tuple: the value, and the section where it was found.
<a name="L363" class="line-number"> 363 </a>        """</span>
<a name="L364" class="line-number"> 364 </a>        <span class="python-comment"># switch off interpolation before we try and fetch anything !</span>
<a name="L365" class="line-number"> 365 </a>        <span class="python-name">save_interp</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">main</span><span class="python-operator">.</span><span class="python-name">interpolation</span>
<a name="L366" class="line-number"> 366 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">main</span><span class="python-operator">.</span><span class="python-name">interpolation</span> <span class="python-operator">=</span> <span class="python-name">False</span>
<a name="L367" class="line-number"> 367 </a>
<a name="L368" class="line-number"> 368 </a>        <span class="python-comment"># Start at section that "owns" this InterpolationEngine</span>
<a name="L369" class="line-number"> 369 </a>        <span class="python-name">current_section</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">section</span>
<a name="L370" class="line-number"> 370 </a>        <span class="python-keyword">while</span> <span class="python-name">True</span><span class="python-operator">:</span>
<a name="L371" class="line-number"> 371 </a>            <span class="python-comment"># try the current section first</span>
<a name="L372" class="line-number"> 372 </a>            <span class="python-name">val</span> <span class="python-operator">=</span> <span class="python-name">current_section</span><span class="python-operator">.</span><span class="python-name">get</span><span class="python-operator">(</span><span class="python-name">key</span><span class="python-operator">)</span>
<a name="L373" class="line-number"> 373 </a>            <span class="python-keyword">if</span> <span class="python-name">val</span> <span class="python-keyword">is</span> <span class="python-keyword">not</span> <span class="python-name">None</span><span class="python-operator">:</span>
<a name="L374" class="line-number"> 374 </a>                <span class="python-keyword">break</span>
<a name="L375" class="line-number"> 375 </a>            <span class="python-comment"># try "DEFAULT" next</span>
<a name="L376" class="line-number"> 376 </a>            <span class="python-name">val</span> <span class="python-operator">=</span> <span class="python-name">current_section</span><span class="python-operator">.</span><span class="python-name">get</span><span class="python-operator">(</span><span class="python-string">'DEFAULT'</span><span class="python-operator">,</span> <span class="python-operator">{</span><span class="python-operator">}</span><span class="python-operator">)</span><span class="python-operator">.</span><span class="python-name">get</span><span class="python-operator">(</span><span class="python-name">key</span><span class="python-operator">)</span>
<a name="L377" class="line-number"> 377 </a>            <span class="python-keyword">if</span> <span class="python-name">val</span> <span class="python-keyword">is</span> <span class="python-keyword">not</span> <span class="python-name">None</span><span class="python-operator">:</span>
<a name="L378" class="line-number"> 378 </a>                <span class="python-keyword">break</span>
<a name="L379" class="line-number"> 379 </a>            <span class="python-comment"># move up to parent and try again</span>
<a name="L380" class="line-number"> 380 </a>            <span class="python-comment"># top-level's parent is itself</span>
<a name="L381" class="line-number"> 381 </a>            <span class="python-keyword">if</span> <span class="python-name">current_section</span><span class="python-operator">.</span><span class="python-name">parent</span> <span class="python-keyword">is</span> <span class="python-name">current_section</span><span class="python-operator">:</span>
<a name="L382" class="line-number"> 382 </a>                <span class="python-comment"># reached top level, time to give up</span>
<a name="L383" class="line-number"> 383 </a>                <span class="python-keyword">break</span>
<a name="L384" class="line-number"> 384 </a>            <span class="python-name">current_section</span> <span class="python-operator">=</span> <span class="python-name">current_section</span><span class="python-operator">.</span><span class="python-name">parent</span>
<a name="L385" class="line-number"> 385 </a>
<a name="L386" class="line-number"> 386 </a>        <span class="python-comment"># restore interpolation to previous value before returning</span>
<a name="L387" class="line-number"> 387 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">main</span><span class="python-operator">.</span><span class="python-name">interpolation</span> <span class="python-operator">=</span> <span class="python-name">save_interp</span>
<a name="L388" class="line-number"> 388 </a>        <span class="python-keyword">if</span> <span class="python-name">val</span> <span class="python-keyword">is</span> <span class="python-name">None</span><span class="python-operator">:</span>
<a name="L389" class="line-number"> 389 </a>            <span class="python-keyword">raise</span> <span class="python-name">MissingInterpolationOption</span><span class="python-operator">(</span><span class="python-name">key</span><span class="python-operator">)</span>
<a name="L390" class="line-number"> 390 </a>        <span class="python-keyword">return</span> <span class="python-name">val</span><span class="python-operator">,</span> <span class="python-name">current_section</span>
<a name="L391" class="line-number"> 391 </a>
<a name="L392" class="line-number"> 392 </a>    <span class="python-keyword">def</span> <span class="python-name">_parse_match</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">match</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L393" class="line-number"> 393 </a>        <span class="python-string">"""Implementation-dependent helper function.
<a name="L394" class="line-number"> 394 </a>
<a name="L395" class="line-number"> 395 </a>        Will be passed a match object corresponding to the interpolation
<a name="L396" class="line-number"> 396 </a>        key we just found (e.g., "%(foo)s" or "$foo"). Should look up that
<a name="L397" class="line-number"> 397 </a>        key in the appropriate config file section (using the ``_fetch()``
<a name="L398" class="line-number"> 398 </a>        helper function) and return a 3-tuple: (key, value, section)
<a name="L399" class="line-number"> 399 </a>
<a name="L400" class="line-number"> 400 </a>        ``key`` is the name of the key we're looking for
<a name="L401" class="line-number"> 401 </a>        ``value`` is the value found for that key
<a name="L402" class="line-number"> 402 </a>        ``section`` is a reference to the section where it was found
<a name="L403" class="line-number"> 403 </a>
<a name="L404" class="line-number"> 404 </a>        ``key`` and ``section`` should be None if no further
<a name="L405" class="line-number"> 405 </a>        interpolation should be performed on the resulting value
<a name="L406" class="line-number"> 406 </a>        (e.g., if we interpolated "$$" and returned "$").
<a name="L407" class="line-number"> 407 </a>        """</span>
<a name="L408" class="line-number"> 408 </a>        <span class="python-keyword">raise</span> <span class="python-name">NotImplementedError</span>
<a name="L409" class="line-number"> 409 </a>
<a name="L410" class="line-number"> 410 </a>
<a name="L411" class="line-number"> 411 </a><span class="python-keyword">class</span> <span class="python-name">ConfigParserInterpolation</span><span class="python-operator">(</span><span class="python-name">InterpolationEngine</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L412" class="line-number"> 412 </a>    <span class="python-string">"""Behaves like ConfigParser."""</span>
<a name="L413" class="line-number"> 413 </a>    <span class="python-name">_KEYCRE</span> <span class="python-operator">=</span> <span class="python-name">re</span><span class="python-operator">.</span><span class="python-name">compile</span><span class="python-operator">(</span><span class="python-string">r"%\(([^)]*)\)s"</span><span class="python-operator">)</span>
<a name="L414" class="line-number"> 414 </a>
<a name="L415" class="line-number"> 415 </a>    <span class="python-keyword">def</span> <span class="python-name">_parse_match</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">match</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L416" class="line-number"> 416 </a>        <span class="python-name">key</span> <span class="python-operator">=</span> <span class="python-name">match</span><span class="python-operator">.</span><span class="python-name">group</span><span class="python-operator">(</span><span class="python-number">1</span><span class="python-operator">)</span>
<a name="L417" class="line-number"> 417 </a>        <span class="python-name">value</span><span class="python-operator">,</span> <span class="python-name">section</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_fetch</span><span class="python-operator">(</span><span class="python-name">key</span><span class="python-operator">)</span>
<a name="L418" class="line-number"> 418 </a>        <span class="python-keyword">return</span> <span class="python-name">key</span><span class="python-operator">,</span> <span class="python-name">value</span><span class="python-operator">,</span> <span class="python-name">section</span>
<a name="L419" class="line-number"> 419 </a>
<a name="L420" class="line-number"> 420 </a>
<a name="L421" class="line-number"> 421 </a><span class="python-keyword">class</span> <span class="python-name">TemplateInterpolation</span><span class="python-operator">(</span><span class="python-name">InterpolationEngine</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L422" class="line-number"> 422 </a>    <span class="python-string">"""Behaves like string.Template."""</span>
<a name="L423" class="line-number"> 423 </a>    <span class="python-name">_delimiter</span> <span class="python-operator">=</span> <span class="python-string">'$'</span>
<a name="L424" class="line-number"> 424 </a>    <span class="python-name">_KEYCRE</span> <span class="python-operator">=</span> <span class="python-name">re</span><span class="python-operator">.</span><span class="python-name">compile</span><span class="python-operator">(</span><span class="python-string">r"""
<a name="L425" class="line-number"> 425 </a>        \$(?:
<a name="L426" class="line-number"> 426 </a>          (?P&lt;escaped&gt;\$)              |   # Two $ signs
<a name="L427" class="line-number"> 427 </a>          (?P&lt;named&gt;[_a-z][_a-z0-9]*)  |   # $name format
<a name="L428" class="line-number"> 428 </a>          {(?P&lt;braced&gt;[^}]*)}              # ${name} format
<a name="L429" class="line-number"> 429 </a>        )
<a name="L430" class="line-number"> 430 </a>        """</span><span class="python-operator">,</span> <span class="python-name">re</span><span class="python-operator">.</span><span class="python-name">IGNORECASE</span> <span class="python-operator">|</span> <span class="python-name">re</span><span class="python-operator">.</span><span class="python-name">VERBOSE</span><span class="python-operator">)</span>
<a name="L431" class="line-number"> 431 </a>
<a name="L432" class="line-number"> 432 </a>    <span class="python-keyword">def</span> <span class="python-name">_parse_match</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">match</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L433" class="line-number"> 433 </a>        <span class="python-comment"># Valid name (in or out of braces): fetch value from section</span>
<a name="L434" class="line-number"> 434 </a>        <span class="python-name">key</span> <span class="python-operator">=</span> <span class="python-name">match</span><span class="python-operator">.</span><span class="python-name">group</span><span class="python-operator">(</span><span class="python-string">'named'</span><span class="python-operator">)</span> <span class="python-keyword">or</span> <span class="python-name">match</span><span class="python-operator">.</span><span class="python-name">group</span><span class="python-operator">(</span><span class="python-string">'braced'</span><span class="python-operator">)</span>
<a name="L435" class="line-number"> 435 </a>        <span class="python-keyword">if</span> <span class="python-name">key</span> <span class="python-keyword">is</span> <span class="python-keyword">not</span> <span class="python-name">None</span><span class="python-operator">:</span>
<a name="L436" class="line-number"> 436 </a>            <span class="python-name">value</span><span class="python-operator">,</span> <span class="python-name">section</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_fetch</span><span class="python-operator">(</span><span class="python-name">key</span><span class="python-operator">)</span>
<a name="L437" class="line-number"> 437 </a>            <span class="python-keyword">return</span> <span class="python-name">key</span><span class="python-operator">,</span> <span class="python-name">value</span><span class="python-operator">,</span> <span class="python-name">section</span>
<a name="L438" class="line-number"> 438 </a>        <span class="python-comment"># Escaped delimiter (e.g., $$): return single delimiter</span>
<a name="L439" class="line-number"> 439 </a>        <span class="python-keyword">if</span> <span class="python-name">match</span><span class="python-operator">.</span><span class="python-name">group</span><span class="python-operator">(</span><span class="python-string">'escaped'</span><span class="python-operator">)</span> <span class="python-keyword">is</span> <span class="python-keyword">not</span> <span class="python-name">None</span><span class="python-operator">:</span>
<a name="L440" class="line-number"> 440 </a>            <span class="python-comment"># Return None for key and section to indicate it's time to stop</span>
<a name="L441" class="line-number"> 441 </a>            <span class="python-keyword">return</span> <span class="python-name">None</span><span class="python-operator">,</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_delimiter</span><span class="python-operator">,</span> <span class="python-name">None</span>
<a name="L442" class="line-number"> 442 </a>        <span class="python-comment"># Anything else: ignore completely, just return it unchanged</span>
<a name="L443" class="line-number"> 443 </a>        <span class="python-keyword">return</span> <span class="python-name">None</span><span class="python-operator">,</span> <span class="python-name">match</span><span class="python-operator">.</span><span class="python-name">group</span><span class="python-operator">(</span><span class="python-operator">)</span><span class="python-operator">,</span> <span class="python-name">None</span>
<a name="L444" class="line-number"> 444 </a>
<a name="L445" class="line-number"> 445 </a><span class="python-name">interpolation_engines</span> <span class="python-operator">=</span> <span class="python-operator">{</span>
<a name="L446" class="line-number"> 446 </a>    <span class="python-string">'configparser'</span><span class="python-operator">:</span> <span class="python-name">ConfigParserInterpolation</span><span class="python-operator">,</span>
<a name="L447" class="line-number"> 447 </a>    <span class="python-string">'template'</span><span class="python-operator">:</span> <span class="python-name">TemplateInterpolation</span><span class="python-operator">,</span>
<a name="L448" class="line-number"> 448 </a><span class="python-operator">}</span>
<a name="L449" class="line-number"> 449 </a>
<a name="L450" class="line-number"> 450 </a><span class="python-keyword">class</span> <span class="python-name">Section</span><span class="python-operator">(</span><span class="python-name">dict</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L451" class="line-number"> 451 </a>    <span class="python-string">"""
<a name="L452" class="line-number"> 452 </a>    A dictionary-like object that represents a section in a config file.
<a name="L453" class="line-number"> 453 </a>    
<a name="L454" class="line-number"> 454 </a>    It does string interpolation if the 'interpolation' attribute
<a name="L455" class="line-number"> 455 </a>    of the 'main' object is set to True.
<a name="L456" class="line-number"> 456 </a>    
<a name="L457" class="line-number"> 457 </a>    Interpolation is tried first from this object, then from the 'DEFAULT'
<a name="L458" class="line-number"> 458 </a>    section of this object, next from the parent and its 'DEFAULT' section,
<a name="L459" class="line-number"> 459 </a>    and so on until the main object is reached.
<a name="L460" class="line-number"> 460 </a>    
<a name="L461" class="line-number"> 461 </a>    A Section will behave like an ordered dictionary - following the
<a name="L462" class="line-number"> 462 </a>    order of the ``scalars`` and ``sections`` attributes.
<a name="L463" class="line-number"> 463 </a>    You can use this to change the order of members.
<a name="L464" class="line-number"> 464 </a>    
<a name="L465" class="line-number"> 465 </a>    Iteration follows the order: scalars, then sections.
<a name="L466" class="line-number"> 466 </a>    """</span>
<a name="L467" class="line-number"> 467 </a>
<a name="L468" class="line-number"> 468 </a>    <span class="python-keyword">def</span> <span class="python-name">__init__</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">parent</span><span class="python-operator">,</span> <span class="python-name">depth</span><span class="python-operator">,</span> <span class="python-name">main</span><span class="python-operator">,</span> <span class="python-name">indict</span><span class="python-operator">=</span><span class="python-name">None</span><span class="python-operator">,</span> <span class="python-name">name</span><span class="python-operator">=</span><span class="python-name">None</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L469" class="line-number"> 469 </a>        <span class="python-string">"""
<a name="L470" class="line-number"> 470 </a>        * parent is the section above
<a name="L471" class="line-number"> 471 </a>        * depth is the depth level of this section
<a name="L472" class="line-number"> 472 </a>        * main is the main ConfigObj
<a name="L473" class="line-number"> 473 </a>        * indict is a dictionary to initialise the section with
<a name="L474" class="line-number"> 474 </a>        """</span>
<a name="L475" class="line-number"> 475 </a>        <span class="python-keyword">if</span> <span class="python-name">indict</span> <span class="python-keyword">is</span> <span class="python-name">None</span><span class="python-operator">:</span>
<a name="L476" class="line-number"> 476 </a>            <span class="python-name">indict</span> <span class="python-operator">=</span> <span class="python-operator">{</span><span class="python-operator">}</span>
<a name="L477" class="line-number"> 477 </a>        <span class="python-name">dict</span><span class="python-operator">.</span><span class="python-name">__init__</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">)</span>
<a name="L478" class="line-number"> 478 </a>        <span class="python-comment"># used for nesting level *and* interpolation</span>
<a name="L479" class="line-number"> 479 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">parent</span> <span class="python-operator">=</span> <span class="python-name">parent</span>
<a name="L480" class="line-number"> 480 </a>        <span class="python-comment"># used for the interpolation attribute</span>
<a name="L481" class="line-number"> 481 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">main</span> <span class="python-operator">=</span> <span class="python-name">main</span>
<a name="L482" class="line-number"> 482 </a>        <span class="python-comment"># level of nesting depth of this Section</span>
<a name="L483" class="line-number"> 483 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">depth</span> <span class="python-operator">=</span> <span class="python-name">depth</span>
<a name="L484" class="line-number"> 484 </a>        <span class="python-comment"># the sequence of scalar values in this Section</span>
<a name="L485" class="line-number"> 485 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">scalars</span> <span class="python-operator">=</span> <span class="python-operator">[</span><span class="python-operator">]</span>
<a name="L486" class="line-number"> 486 </a>        <span class="python-comment"># the sequence of sections in this Section</span>
<a name="L487" class="line-number"> 487 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">sections</span> <span class="python-operator">=</span> <span class="python-operator">[</span><span class="python-operator">]</span>
<a name="L488" class="line-number"> 488 </a>        <span class="python-comment"># purely for information</span>
<a name="L489" class="line-number"> 489 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">name</span> <span class="python-operator">=</span> <span class="python-name">name</span>
<a name="L490" class="line-number"> 490 </a>        <span class="python-comment"># for comments :-)</span>
<a name="L491" class="line-number"> 491 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">comments</span> <span class="python-operator">=</span> <span class="python-operator">{</span><span class="python-operator">}</span>
<a name="L492" class="line-number"> 492 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">inline_comments</span> <span class="python-operator">=</span> <span class="python-operator">{</span><span class="python-operator">}</span>
<a name="L493" class="line-number"> 493 </a>        <span class="python-comment"># for the configspec</span>
<a name="L494" class="line-number"> 494 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">configspec</span> <span class="python-operator">=</span> <span class="python-operator">{</span><span class="python-operator">}</span>
<a name="L495" class="line-number"> 495 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_order</span> <span class="python-operator">=</span> <span class="python-operator">[</span><span class="python-operator">]</span>
<a name="L496" class="line-number"> 496 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_configspec_comments</span> <span class="python-operator">=</span> <span class="python-operator">{</span><span class="python-operator">}</span>
<a name="L497" class="line-number"> 497 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_configspec_inline_comments</span> <span class="python-operator">=</span> <span class="python-operator">{</span><span class="python-operator">}</span>
<a name="L498" class="line-number"> 498 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_cs_section_comments</span> <span class="python-operator">=</span> <span class="python-operator">{</span><span class="python-operator">}</span>
<a name="L499" class="line-number"> 499 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_cs_section_inline_comments</span> <span class="python-operator">=</span> <span class="python-operator">{</span><span class="python-operator">}</span>
<a name="L500" class="line-number"> 500 </a>        <span class="python-comment"># for defaults</span>
<a name="L501" class="line-number"> 501 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">defaults</span> <span class="python-operator">=</span> <span class="python-operator">[</span><span class="python-operator">]</span>
<a name="L502" class="line-number"> 502 </a>        <span class="python-comment">#</span>
<a name="L503" class="line-number"> 503 </a>        <span class="python-comment"># we do this explicitly so that __setitem__ is used properly</span>
<a name="L504" class="line-number"> 504 </a>        <span class="python-comment"># (rather than just passing to ``dict.__init__``)</span>
<a name="L505" class="line-number"> 505 </a>        <span class="python-keyword">for</span> <span class="python-name">entry</span> <span class="python-keyword">in</span> <span class="python-name">indict</span><span class="python-operator">:</span>
<a name="L506" class="line-number"> 506 </a>            <span class="python-name">self</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-name">indict</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span>
<a name="L507" class="line-number"> 507 </a>
<a name="L508" class="line-number"> 508 </a>    <span class="python-keyword">def</span> <span class="python-name">_interpolate</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">key</span><span class="python-operator">,</span> <span class="python-name">value</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L509" class="line-number"> 509 </a>        <span class="python-keyword">try</span><span class="python-operator">:</span>
<a name="L510" class="line-number"> 510 </a>            <span class="python-comment"># do we already have an interpolation engine?</span>
<a name="L511" class="line-number"> 511 </a>            <span class="python-name">engine</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_interpolation_engine</span>
<a name="L512" class="line-number"> 512 </a>        <span class="python-keyword">except</span> <span class="python-name">AttributeError</span><span class="python-operator">:</span>
<a name="L513" class="line-number"> 513 </a>            <span class="python-comment"># not yet: first time running _interpolate(), so pick the engine</span>
<a name="L514" class="line-number"> 514 </a>            <span class="python-name">name</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">main</span><span class="python-operator">.</span><span class="python-name">interpolation</span>
<a name="L515" class="line-number"> 515 </a>            <span class="python-keyword">if</span> <span class="python-name">name</span> <span class="python-operator">==</span> <span class="python-name">True</span><span class="python-operator">:</span>  <span class="python-comment"># note that "if name:" would be incorrect here</span>
<a name="L516" class="line-number"> 516 </a>                <span class="python-comment"># backwards-compatibility: interpolation=True means use default</span>
<a name="L517" class="line-number"> 517 </a>                <span class="python-name">name</span> <span class="python-operator">=</span> <span class="python-name">DEFAULT_INTERPOLATION</span>
<a name="L518" class="line-number"> 518 </a>            <span class="python-name">name</span> <span class="python-operator">=</span> <span class="python-name">name</span><span class="python-operator">.</span><span class="python-name">lower</span><span class="python-operator">(</span><span class="python-operator">)</span>  <span class="python-comment"># so that "Template", "template", etc. all work</span>
<a name="L519" class="line-number"> 519 </a>            <span class="python-name">class_</span> <span class="python-operator">=</span> <span class="python-name">interpolation_engines</span><span class="python-operator">.</span><span class="python-name">get</span><span class="python-operator">(</span><span class="python-name">name</span><span class="python-operator">,</span> <span class="python-name">None</span><span class="python-operator">)</span>
<a name="L520" class="line-number"> 520 </a>            <span class="python-keyword">if</span> <span class="python-name">class_</span> <span class="python-keyword">is</span> <span class="python-name">None</span><span class="python-operator">:</span>
<a name="L521" class="line-number"> 521 </a>                <span class="python-comment"># invalid value for self.main.interpolation</span>
<a name="L522" class="line-number"> 522 </a>                <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">main</span><span class="python-operator">.</span><span class="python-name">interpolation</span> <span class="python-operator">=</span> <span class="python-name">False</span>
<a name="L523" class="line-number"> 523 </a>                <span class="python-keyword">return</span> <span class="python-name">value</span>
<a name="L524" class="line-number"> 524 </a>            <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L525" class="line-number"> 525 </a>                <span class="python-comment"># save reference to engine so we don't have to do this again</span>
<a name="L526" class="line-number"> 526 </a>                <span class="python-name">engine</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_interpolation_engine</span> <span class="python-operator">=</span> <span class="python-name">class_</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">)</span>
<a name="L527" class="line-number"> 527 </a>        <span class="python-comment"># let the engine do the actual work</span>
<a name="L528" class="line-number"> 528 </a>        <span class="python-keyword">return</span> <span class="python-name">engine</span><span class="python-operator">.</span><span class="python-name">interpolate</span><span class="python-operator">(</span><span class="python-name">key</span><span class="python-operator">,</span> <span class="python-name">value</span><span class="python-operator">)</span>
<a name="L529" class="line-number"> 529 </a>
<a name="L530" class="line-number"> 530 </a>    <span class="python-keyword">def</span> <span class="python-name">__getitem__</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">key</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L531" class="line-number"> 531 </a>        <span class="python-string">"""Fetch the item and do string interpolation."""</span>
<a name="L532" class="line-number"> 532 </a>        <span class="python-name">val</span> <span class="python-operator">=</span> <span class="python-name">dict</span><span class="python-operator">.</span><span class="python-name">__getitem__</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">key</span><span class="python-operator">)</span>
<a name="L533" class="line-number"> 533 </a>        <span class="python-keyword">if</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">main</span><span class="python-operator">.</span><span class="python-name">interpolation</span> <span class="python-keyword">and</span> <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">val</span><span class="python-operator">,</span> <span class="python-name">StringTypes</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L534" class="line-number"> 534 </a>            <span class="python-keyword">return</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_interpolate</span><span class="python-operator">(</span><span class="python-name">key</span><span class="python-operator">,</span> <span class="python-name">val</span><span class="python-operator">)</span>
<a name="L535" class="line-number"> 535 </a>        <span class="python-keyword">return</span> <span class="python-name">val</span>
<a name="L536" class="line-number"> 536 </a>
<a name="L537" class="line-number"> 537 </a>    <span class="python-keyword">def</span> <span class="python-name">__setitem__</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">key</span><span class="python-operator">,</span> <span class="python-name">value</span><span class="python-operator">,</span> <span class="python-name">unrepr</span><span class="python-operator">=</span><span class="python-name">False</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L538" class="line-number"> 538 </a>        <span class="python-string">"""
<a name="L539" class="line-number"> 539 </a>        Correctly set a value.
<a name="L540" class="line-number"> 540 </a>        
<a name="L541" class="line-number"> 541 </a>        Making dictionary values Section instances.
<a name="L542" class="line-number"> 542 </a>        (We have to special case 'Section' instances - which are also dicts)
<a name="L543" class="line-number"> 543 </a>        
<a name="L544" class="line-number"> 544 </a>        Keys must be strings.
<a name="L545" class="line-number"> 545 </a>        Values need only be strings (or lists of strings) if
<a name="L546" class="line-number"> 546 </a>        ``main.stringify`` is set.
<a name="L547" class="line-number"> 547 </a>        
<a name="L548" class="line-number"> 548 </a>        `unrepr`` must be set when setting a value to a dictionary, without
<a name="L549" class="line-number"> 549 </a>        creating a new sub-section.
<a name="L550" class="line-number"> 550 </a>        """</span>
<a name="L551" class="line-number"> 551 </a>        <span class="python-keyword">if</span> <span class="python-keyword">not</span> <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">key</span><span class="python-operator">,</span> <span class="python-name">StringTypes</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L552" class="line-number"> 552 </a>            <span class="python-keyword">raise</span> <span class="python-name">ValueError</span><span class="python-operator">,</span> <span class="python-string">'The key "%s" is not a string.'</span> <span class="python-operator">%</span> <span class="python-name">key</span>
<a name="L553" class="line-number"> 553 </a>        <span class="python-comment"># add the comment</span>
<a name="L554" class="line-number"> 554 </a>        <span class="python-keyword">if</span> <span class="python-keyword">not</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">comments</span><span class="python-operator">.</span><span class="python-name">has_key</span><span class="python-operator">(</span><span class="python-name">key</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L555" class="line-number"> 555 </a>            <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">comments</span><span class="python-operator">[</span><span class="python-name">key</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-operator">[</span><span class="python-operator">]</span>
<a name="L556" class="line-number"> 556 </a>            <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">inline_comments</span><span class="python-operator">[</span><span class="python-name">key</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-string">''</span>
<a name="L557" class="line-number"> 557 </a>        <span class="python-comment"># remove the entry from defaults</span>
<a name="L558" class="line-number"> 558 </a>        <span class="python-keyword">if</span> <span class="python-name">key</span> <span class="python-keyword">in</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">defaults</span><span class="python-operator">:</span>
<a name="L559" class="line-number"> 559 </a>            <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">defaults</span><span class="python-operator">.</span><span class="python-name">remove</span><span class="python-operator">(</span><span class="python-name">key</span><span class="python-operator">)</span>
<a name="L560" class="line-number"> 560 </a>        <span class="python-comment">#</span>
<a name="L561" class="line-number"> 561 </a>        <span class="python-keyword">if</span> <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">value</span><span class="python-operator">,</span> <span class="python-name">Section</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L562" class="line-number"> 562 </a>            <span class="python-keyword">if</span> <span class="python-keyword">not</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">has_key</span><span class="python-operator">(</span><span class="python-name">key</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L563" class="line-number"> 563 </a>                <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">sections</span><span class="python-operator">.</span><span class="python-name">append</span><span class="python-operator">(</span><span class="python-name">key</span><span class="python-operator">)</span>
<a name="L564" class="line-number"> 564 </a>            <span class="python-name">dict</span><span class="python-operator">.</span><span class="python-name">__setitem__</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">key</span><span class="python-operator">,</span> <span class="python-name">value</span><span class="python-operator">)</span>
<a name="L565" class="line-number"> 565 </a>        <span class="python-keyword">elif</span> <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">value</span><span class="python-operator">,</span> <span class="python-name">dict</span><span class="python-operator">)</span> <span class="python-keyword">and</span> <span class="python-keyword">not</span> <span class="python-name">unrepr</span><span class="python-operator">:</span>
<a name="L566" class="line-number"> 566 </a>            <span class="python-comment"># First create the new depth level,</span>
<a name="L567" class="line-number"> 567 </a>            <span class="python-comment"># then create the section</span>
<a name="L568" class="line-number"> 568 </a>            <span class="python-keyword">if</span> <span class="python-keyword">not</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">has_key</span><span class="python-operator">(</span><span class="python-name">key</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L569" class="line-number"> 569 </a>                <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">sections</span><span class="python-operator">.</span><span class="python-name">append</span><span class="python-operator">(</span><span class="python-name">key</span><span class="python-operator">)</span>
<a name="L570" class="line-number"> 570 </a>            <span class="python-name">new_depth</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">depth</span> <span class="python-operator">+</span> <span class="python-number">1</span>
<a name="L571" class="line-number"> 571 </a>            <span class="python-name">dict</span><span class="python-operator">.</span><span class="python-name">__setitem__</span><span class="python-operator">(</span>
<a name="L572" class="line-number"> 572 </a>                <span class="python-name">self</span><span class="python-operator">,</span>
<a name="L573" class="line-number"> 573 </a>                <span class="python-name">key</span><span class="python-operator">,</span>
<a name="L574" class="line-number"> 574 </a>                <span class="python-name">Section</span><span class="python-operator">(</span>
<a name="L575" class="line-number"> 575 </a>                    <span class="python-name">self</span><span class="python-operator">,</span>
<a name="L576" class="line-number"> 576 </a>                    <span class="python-name">new_depth</span><span class="python-operator">,</span>
<a name="L577" class="line-number"> 577 </a>                    <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">main</span><span class="python-operator">,</span>
<a name="L578" class="line-number"> 578 </a>                    <span class="python-name">indict</span><span class="python-operator">=</span><span class="python-name">value</span><span class="python-operator">,</span>
<a name="L579" class="line-number"> 579 </a>                    <span class="python-name">name</span><span class="python-operator">=</span><span class="python-name">key</span><span class="python-operator">)</span><span class="python-operator">)</span>
<a name="L580" class="line-number"> 580 </a>        <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L581" class="line-number"> 581 </a>            <span class="python-keyword">if</span> <span class="python-keyword">not</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">has_key</span><span class="python-operator">(</span><span class="python-name">key</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L582" class="line-number"> 582 </a>                <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">scalars</span><span class="python-operator">.</span><span class="python-name">append</span><span class="python-operator">(</span><span class="python-name">key</span><span class="python-operator">)</span>
<a name="L583" class="line-number"> 583 </a>            <span class="python-keyword">if</span> <span class="python-keyword">not</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">main</span><span class="python-operator">.</span><span class="python-name">stringify</span><span class="python-operator">:</span>
<a name="L584" class="line-number"> 584 </a>                <span class="python-keyword">if</span> <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">value</span><span class="python-operator">,</span> <span class="python-name">StringTypes</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L585" class="line-number"> 585 </a>                    <span class="python-keyword">pass</span>
<a name="L586" class="line-number"> 586 </a>                <span class="python-keyword">elif</span> <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">value</span><span class="python-operator">,</span> <span class="python-operator">(</span><span class="python-name">list</span><span class="python-operator">,</span> <span class="python-name">tuple</span><span class="python-operator">)</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L587" class="line-number"> 587 </a>                    <span class="python-keyword">for</span> <span class="python-name">entry</span> <span class="python-keyword">in</span> <span class="python-name">value</span><span class="python-operator">:</span>
<a name="L588" class="line-number"> 588 </a>                        <span class="python-keyword">if</span> <span class="python-keyword">not</span> <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">entry</span><span class="python-operator">,</span> <span class="python-name">StringTypes</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L589" class="line-number"> 589 </a>                            <span class="python-keyword">raise</span> <span class="python-name">TypeError</span><span class="python-operator">,</span> <span class="python-operator">(</span>
<a name="L590" class="line-number"> 590 </a>                                <span class="python-string">'Value is not a string "%s".'</span> <span class="python-operator">%</span> <span class="python-name">entry</span><span class="python-operator">)</span>
<a name="L591" class="line-number"> 591 </a>                <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L592" class="line-number"> 592 </a>                    <span class="python-keyword">raise</span> <span class="python-name">TypeError</span><span class="python-operator">,</span> <span class="python-string">'Value is not a string "%s".'</span> <span class="python-operator">%</span> <span class="python-name">value</span>
<a name="L593" class="line-number"> 593 </a>            <span class="python-name">dict</span><span class="python-operator">.</span><span class="python-name">__setitem__</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">key</span><span class="python-operator">,</span> <span class="python-name">value</span><span class="python-operator">)</span>
<a name="L594" class="line-number"> 594 </a>
<a name="L595" class="line-number"> 595 </a>    <span class="python-keyword">def</span> <span class="python-name">__delitem__</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">key</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L596" class="line-number"> 596 </a>        <span class="python-string">"""Remove items from the sequence when deleting."""</span>
<a name="L597" class="line-number"> 597 </a>        <span class="python-name">dict</span><span class="python-operator">.</span> <span class="python-name">__delitem__</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">key</span><span class="python-operator">)</span>
<a name="L598" class="line-number"> 598 </a>        <span class="python-keyword">if</span> <span class="python-name">key</span> <span class="python-keyword">in</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">scalars</span><span class="python-operator">:</span>
<a name="L599" class="line-number"> 599 </a>            <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">scalars</span><span class="python-operator">.</span><span class="python-name">remove</span><span class="python-operator">(</span><span class="python-name">key</span><span class="python-operator">)</span>
<a name="L600" class="line-number"> 600 </a>        <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L601" class="line-number"> 601 </a>            <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">sections</span><span class="python-operator">.</span><span class="python-name">remove</span><span class="python-operator">(</span><span class="python-name">key</span><span class="python-operator">)</span>
<a name="L602" class="line-number"> 602 </a>        <span class="python-keyword">del</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">comments</span><span class="python-operator">[</span><span class="python-name">key</span><span class="python-operator">]</span>
<a name="L603" class="line-number"> 603 </a>        <span class="python-keyword">del</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">inline_comments</span><span class="python-operator">[</span><span class="python-name">key</span><span class="python-operator">]</span>
<a name="L604" class="line-number"> 604 </a>
<a name="L605" class="line-number"> 605 </a>    <span class="python-keyword">def</span> <span class="python-name">get</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">key</span><span class="python-operator">,</span> <span class="python-name">default</span><span class="python-operator">=</span><span class="python-name">None</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L606" class="line-number"> 606 </a>        <span class="python-string">"""A version of ``get`` that doesn't bypass string interpolation."""</span>
<a name="L607" class="line-number"> 607 </a>        <span class="python-keyword">try</span><span class="python-operator">:</span>
<a name="L608" class="line-number"> 608 </a>            <span class="python-keyword">return</span> <span class="python-name">self</span><span class="python-operator">[</span><span class="python-name">key</span><span class="python-operator">]</span>
<a name="L609" class="line-number"> 609 </a>        <span class="python-keyword">except</span> <span class="python-name">KeyError</span><span class="python-operator">:</span>
<a name="L610" class="line-number"> 610 </a>            <span class="python-keyword">return</span> <span class="python-name">default</span>
<a name="L611" class="line-number"> 611 </a>
<a name="L612" class="line-number"> 612 </a>    <span class="python-keyword">def</span> <span class="python-name">update</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">indict</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L613" class="line-number"> 613 </a>        <span class="python-string">"""
<a name="L614" class="line-number"> 614 </a>        A version of update that uses our ``__setitem__``.
<a name="L615" class="line-number"> 615 </a>        """</span>
<a name="L616" class="line-number"> 616 </a>        <span class="python-keyword">for</span> <span class="python-name">entry</span> <span class="python-keyword">in</span> <span class="python-name">indict</span><span class="python-operator">:</span>
<a name="L617" class="line-number"> 617 </a>            <span class="python-name">self</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-name">indict</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span>
<a name="L618" class="line-number"> 618 </a>
<a name="L619" class="line-number"> 619 </a>    <span class="python-keyword">def</span> <span class="python-name">pop</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">key</span><span class="python-operator">,</span> <span class="python-operator">*</span><span class="python-name">args</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L620" class="line-number"> 620 </a>        <span class="python-string">""" """</span>
<a name="L621" class="line-number"> 621 </a>        <span class="python-name">val</span> <span class="python-operator">=</span> <span class="python-name">dict</span><span class="python-operator">.</span><span class="python-name">pop</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">key</span><span class="python-operator">,</span> <span class="python-operator">*</span><span class="python-name">args</span><span class="python-operator">)</span>
<a name="L622" class="line-number"> 622 </a>        <span class="python-keyword">if</span> <span class="python-name">key</span> <span class="python-keyword">in</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">scalars</span><span class="python-operator">:</span>
<a name="L623" class="line-number"> 623 </a>            <span class="python-keyword">del</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">comments</span><span class="python-operator">[</span><span class="python-name">key</span><span class="python-operator">]</span>
<a name="L624" class="line-number"> 624 </a>            <span class="python-keyword">del</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">inline_comments</span><span class="python-operator">[</span><span class="python-name">key</span><span class="python-operator">]</span>
<a name="L625" class="line-number"> 625 </a>            <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">scalars</span><span class="python-operator">.</span><span class="python-name">remove</span><span class="python-operator">(</span><span class="python-name">key</span><span class="python-operator">)</span>
<a name="L626" class="line-number"> 626 </a>        <span class="python-keyword">elif</span> <span class="python-name">key</span> <span class="python-keyword">in</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">sections</span><span class="python-operator">:</span>
<a name="L627" class="line-number"> 627 </a>            <span class="python-keyword">del</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">comments</span><span class="python-operator">[</span><span class="python-name">key</span><span class="python-operator">]</span>
<a name="L628" class="line-number"> 628 </a>            <span class="python-keyword">del</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">inline_comments</span><span class="python-operator">[</span><span class="python-name">key</span><span class="python-operator">]</span>
<a name="L629" class="line-number"> 629 </a>            <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">sections</span><span class="python-operator">.</span><span class="python-name">remove</span><span class="python-operator">(</span><span class="python-name">key</span><span class="python-operator">)</span>
<a name="L630" class="line-number"> 630 </a>        <span class="python-keyword">if</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">main</span><span class="python-operator">.</span><span class="python-name">interpolation</span> <span class="python-keyword">and</span> <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">val</span><span class="python-operator">,</span> <span class="python-name">StringTypes</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L631" class="line-number"> 631 </a>            <span class="python-keyword">return</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_interpolate</span><span class="python-operator">(</span><span class="python-name">key</span><span class="python-operator">,</span> <span class="python-name">val</span><span class="python-operator">)</span>
<a name="L632" class="line-number"> 632 </a>        <span class="python-keyword">return</span> <span class="python-name">val</span>
<a name="L633" class="line-number"> 633 </a>
<a name="L634" class="line-number"> 634 </a>    <span class="python-keyword">def</span> <span class="python-name">popitem</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L635" class="line-number"> 635 </a>        <span class="python-string">"""Pops the first (key,val)"""</span>
<a name="L636" class="line-number"> 636 </a>        <span class="python-name">sequence</span> <span class="python-operator">=</span> <span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">scalars</span> <span class="python-operator">+</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">sections</span><span class="python-operator">)</span>
<a name="L637" class="line-number"> 637 </a>        <span class="python-keyword">if</span> <span class="python-keyword">not</span> <span class="python-name">sequence</span><span class="python-operator">:</span>
<a name="L638" class="line-number"> 638 </a>            <span class="python-keyword">raise</span> <span class="python-name">KeyError</span><span class="python-operator">,</span> <span class="python-string">": 'popitem(): dictionary is empty'"</span>
<a name="L639" class="line-number"> 639 </a>        <span class="python-name">key</span> <span class="python-operator">=</span> <span class="python-name">sequence</span><span class="python-operator">[</span><span class="python-number">0</span><span class="python-operator">]</span>
<a name="L640" class="line-number"> 640 </a>        <span class="python-name">val</span> <span class="python-operator">=</span>  <span class="python-name">self</span><span class="python-operator">[</span><span class="python-name">key</span><span class="python-operator">]</span>
<a name="L641" class="line-number"> 641 </a>        <span class="python-keyword">del</span> <span class="python-name">self</span><span class="python-operator">[</span><span class="python-name">key</span><span class="python-operator">]</span>
<a name="L642" class="line-number"> 642 </a>        <span class="python-keyword">return</span> <span class="python-name">key</span><span class="python-operator">,</span> <span class="python-name">val</span>
<a name="L643" class="line-number"> 643 </a>
<a name="L644" class="line-number"> 644 </a>    <span class="python-keyword">def</span> <span class="python-name">clear</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L645" class="line-number"> 645 </a>        <span class="python-string">"""
<a name="L646" class="line-number"> 646 </a>        A version of clear that also affects scalars/sections
<a name="L647" class="line-number"> 647 </a>        Also clears comments and configspec.
<a name="L648" class="line-number"> 648 </a>        
<a name="L649" class="line-number"> 649 </a>        Leaves other attributes alone :
<a name="L650" class="line-number"> 650 </a>            depth/main/parent are not affected
<a name="L651" class="line-number"> 651 </a>        """</span>
<a name="L652" class="line-number"> 652 </a>        <span class="python-name">dict</span><span class="python-operator">.</span><span class="python-name">clear</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">)</span>
<a name="L653" class="line-number"> 653 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">scalars</span> <span class="python-operator">=</span> <span class="python-operator">[</span><span class="python-operator">]</span>
<a name="L654" class="line-number"> 654 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">sections</span> <span class="python-operator">=</span> <span class="python-operator">[</span><span class="python-operator">]</span>
<a name="L655" class="line-number"> 655 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">comments</span> <span class="python-operator">=</span> <span class="python-operator">{</span><span class="python-operator">}</span>
<a name="L656" class="line-number"> 656 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">inline_comments</span> <span class="python-operator">=</span> <span class="python-operator">{</span><span class="python-operator">}</span>
<a name="L657" class="line-number"> 657 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">configspec</span> <span class="python-operator">=</span> <span class="python-operator">{</span><span class="python-operator">}</span>
<a name="L658" class="line-number"> 658 </a>
<a name="L659" class="line-number"> 659 </a>    <span class="python-keyword">def</span> <span class="python-name">setdefault</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">key</span><span class="python-operator">,</span> <span class="python-name">default</span><span class="python-operator">=</span><span class="python-name">None</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L660" class="line-number"> 660 </a>        <span class="python-string">"""A version of setdefault that sets sequence if appropriate."""</span>
<a name="L661" class="line-number"> 661 </a>        <span class="python-keyword">try</span><span class="python-operator">:</span>
<a name="L662" class="line-number"> 662 </a>            <span class="python-keyword">return</span> <span class="python-name">self</span><span class="python-operator">[</span><span class="python-name">key</span><span class="python-operator">]</span>
<a name="L663" class="line-number"> 663 </a>        <span class="python-keyword">except</span> <span class="python-name">KeyError</span><span class="python-operator">:</span>
<a name="L664" class="line-number"> 664 </a>            <span class="python-name">self</span><span class="python-operator">[</span><span class="python-name">key</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-name">default</span>
<a name="L665" class="line-number"> 665 </a>            <span class="python-keyword">return</span> <span class="python-name">self</span><span class="python-operator">[</span><span class="python-name">key</span><span class="python-operator">]</span>
<a name="L666" class="line-number"> 666 </a>
<a name="L667" class="line-number"> 667 </a>    <span class="python-keyword">def</span> <span class="python-name">items</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L668" class="line-number"> 668 </a>        <span class="python-string">""" """</span>
<a name="L669" class="line-number"> 669 </a>        <span class="python-keyword">return</span> <span class="python-name">zip</span><span class="python-operator">(</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">scalars</span> <span class="python-operator">+</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">sections</span><span class="python-operator">)</span><span class="python-operator">,</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">values</span><span class="python-operator">(</span><span class="python-operator">)</span><span class="python-operator">)</span>
<a name="L670" class="line-number"> 670 </a>
<a name="L671" class="line-number"> 671 </a>    <span class="python-keyword">def</span> <span class="python-name">keys</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L672" class="line-number"> 672 </a>        <span class="python-string">""" """</span>
<a name="L673" class="line-number"> 673 </a>        <span class="python-keyword">return</span> <span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">scalars</span> <span class="python-operator">+</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">sections</span><span class="python-operator">)</span>
<a name="L674" class="line-number"> 674 </a>
<a name="L675" class="line-number"> 675 </a>    <span class="python-keyword">def</span> <span class="python-name">values</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L676" class="line-number"> 676 </a>        <span class="python-string">""" """</span>
<a name="L677" class="line-number"> 677 </a>        <span class="python-keyword">return</span> <span class="python-operator">[</span><span class="python-name">self</span><span class="python-operator">[</span><span class="python-name">key</span><span class="python-operator">]</span> <span class="python-keyword">for</span> <span class="python-name">key</span> <span class="python-keyword">in</span> <span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">scalars</span> <span class="python-operator">+</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">sections</span><span class="python-operator">)</span><span class="python-operator">]</span>
<a name="L678" class="line-number"> 678 </a>
<a name="L679" class="line-number"> 679 </a>    <span class="python-keyword">def</span> <span class="python-name">iteritems</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L680" class="line-number"> 680 </a>        <span class="python-string">""" """</span>
<a name="L681" class="line-number"> 681 </a>        <span class="python-keyword">return</span> <span class="python-name">iter</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">items</span><span class="python-operator">(</span><span class="python-operator">)</span><span class="python-operator">)</span>
<a name="L682" class="line-number"> 682 </a>
<a name="L683" class="line-number"> 683 </a>    <span class="python-keyword">def</span> <span class="python-name">iterkeys</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L684" class="line-number"> 684 </a>        <span class="python-string">""" """</span>
<a name="L685" class="line-number"> 685 </a>        <span class="python-keyword">return</span> <span class="python-name">iter</span><span class="python-operator">(</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">scalars</span> <span class="python-operator">+</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">sections</span><span class="python-operator">)</span><span class="python-operator">)</span>
<a name="L686" class="line-number"> 686 </a>
<a name="L687" class="line-number"> 687 </a>    <span class="python-name">__iter__</span> <span class="python-operator">=</span> <span class="python-name">iterkeys</span>
<a name="L688" class="line-number"> 688 </a>
<a name="L689" class="line-number"> 689 </a>    <span class="python-keyword">def</span> <span class="python-name">itervalues</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L690" class="line-number"> 690 </a>        <span class="python-string">""" """</span>
<a name="L691" class="line-number"> 691 </a>        <span class="python-keyword">return</span> <span class="python-name">iter</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">values</span><span class="python-operator">(</span><span class="python-operator">)</span><span class="python-operator">)</span>
<a name="L692" class="line-number"> 692 </a>
<a name="L693" class="line-number"> 693 </a>    <span class="python-keyword">def</span> <span class="python-name">__repr__</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L694" class="line-number"> 694 </a>        <span class="python-keyword">return</span> <span class="python-string">'{%s}'</span> <span class="python-operator">%</span> <span class="python-string">', '</span><span class="python-operator">.</span><span class="python-name">join</span><span class="python-operator">(</span><span class="python-operator">[</span><span class="python-operator">(</span><span class="python-string">'%s: %s'</span> <span class="python-operator">%</span> <span class="python-operator">(</span><span class="python-name">repr</span><span class="python-operator">(</span><span class="python-name">key</span><span class="python-operator">)</span><span class="python-operator">,</span> <span class="python-name">repr</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">[</span><span class="python-name">key</span><span class="python-operator">]</span><span class="python-operator">)</span><span class="python-operator">)</span><span class="python-operator">)</span>
<a name="L695" class="line-number"> 695 </a>            <span class="python-keyword">for</span> <span class="python-name">key</span> <span class="python-keyword">in</span> <span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">scalars</span> <span class="python-operator">+</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">sections</span><span class="python-operator">)</span><span class="python-operator">]</span><span class="python-operator">)</span>
<a name="L696" class="line-number"> 696 </a>
<a name="L697" class="line-number"> 697 </a>    <span class="python-name">__str__</span> <span class="python-operator">=</span> <span class="python-name">__repr__</span>
<a name="L698" class="line-number"> 698 </a>
<a name="L699" class="line-number"> 699 </a>    <span class="python-comment"># Extra methods - not in a normal dictionary</span>
<a name="L700" class="line-number"> 700 </a>
<a name="L701" class="line-number"> 701 </a>    <span class="python-keyword">def</span> <span class="python-name">dict</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L702" class="line-number"> 702 </a>        <span class="python-string">"""
<a name="L703" class="line-number"> 703 </a>        Return a deepcopy of self as a dictionary.
<a name="L704" class="line-number"> 704 </a>        
<a name="L705" class="line-number"> 705 </a>        All members that are ``Section`` instances are recursively turned to
<a name="L706" class="line-number"> 706 </a>        ordinary dictionaries - by calling their ``dict`` method.
<a name="L707" class="line-number"> 707 </a>        
<a name="L708" class="line-number"> 708 </a>        &gt;&gt;&gt; n = a.dict()
<a name="L709" class="line-number"> 709 </a>        &gt;&gt;&gt; n == a
<a name="L710" class="line-number"> 710 </a>        1
<a name="L711" class="line-number"> 711 </a>        &gt;&gt;&gt; n is a
<a name="L712" class="line-number"> 712 </a>        0
<a name="L713" class="line-number"> 713 </a>        """</span>
<a name="L714" class="line-number"> 714 </a>        <span class="python-name">newdict</span> <span class="python-operator">=</span> <span class="python-operator">{</span><span class="python-operator">}</span>
<a name="L715" class="line-number"> 715 </a>        <span class="python-keyword">for</span> <span class="python-name">entry</span> <span class="python-keyword">in</span> <span class="python-name">self</span><span class="python-operator">:</span>
<a name="L716" class="line-number"> 716 </a>            <span class="python-name">this_entry</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span>
<a name="L717" class="line-number"> 717 </a>            <span class="python-keyword">if</span> <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">this_entry</span><span class="python-operator">,</span> <span class="python-name">Section</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L718" class="line-number"> 718 </a>                <span class="python-name">this_entry</span> <span class="python-operator">=</span> <span class="python-name">this_entry</span><span class="python-operator">.</span><span class="python-name">dict</span><span class="python-operator">(</span><span class="python-operator">)</span>
<a name="L719" class="line-number"> 719 </a>            <span class="python-keyword">elif</span> <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">this_entry</span><span class="python-operator">,</span> <span class="python-name">list</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L720" class="line-number"> 720 </a>                <span class="python-comment"># create a copy rather than a reference</span>
<a name="L721" class="line-number"> 721 </a>                <span class="python-name">this_entry</span> <span class="python-operator">=</span> <span class="python-name">list</span><span class="python-operator">(</span><span class="python-name">this_entry</span><span class="python-operator">)</span>
<a name="L722" class="line-number"> 722 </a>            <span class="python-keyword">elif</span> <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">this_entry</span><span class="python-operator">,</span> <span class="python-name">tuple</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L723" class="line-number"> 723 </a>                <span class="python-comment"># create a copy rather than a reference</span>
<a name="L724" class="line-number"> 724 </a>                <span class="python-name">this_entry</span> <span class="python-operator">=</span> <span class="python-name">tuple</span><span class="python-operator">(</span><span class="python-name">this_entry</span><span class="python-operator">)</span>
<a name="L725" class="line-number"> 725 </a>            <span class="python-name">newdict</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-name">this_entry</span>
<a name="L726" class="line-number"> 726 </a>        <span class="python-keyword">return</span> <span class="python-name">newdict</span>
<a name="L727" class="line-number"> 727 </a>
<a name="L728" class="line-number"> 728 </a>    <span class="python-keyword">def</span> <span class="python-name">merge</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">indict</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L729" class="line-number"> 729 </a>        <span class="python-string">"""
<a name="L730" class="line-number"> 730 </a>        A recursive update - useful for merging config files.
<a name="L731" class="line-number"> 731 </a>        
<a name="L732" class="line-number"> 732 </a>        &gt;&gt;&gt; a = '''[section1]
<a name="L733" class="line-number"> 733 </a>        ...     option1 = True
<a name="L734" class="line-number"> 734 </a>        ...     [[subsection]]
<a name="L735" class="line-number"> 735 </a>        ...     more_options = False
<a name="L736" class="line-number"> 736 </a>        ...     # end of file'''.splitlines()
<a name="L737" class="line-number"> 737 </a>        &gt;&gt;&gt; b = '''# File is user.ini
<a name="L738" class="line-number"> 738 </a>        ...     [section1]
<a name="L739" class="line-number"> 739 </a>        ...     option1 = False
<a name="L740" class="line-number"> 740 </a>        ...     # end of file'''.splitlines()
<a name="L741" class="line-number"> 741 </a>        &gt;&gt;&gt; c1 = ConfigObj(b)
<a name="L742" class="line-number"> 742 </a>        &gt;&gt;&gt; c2 = ConfigObj(a)
<a name="L743" class="line-number"> 743 </a>        &gt;&gt;&gt; c2.merge(c1)
<a name="L744" class="line-number"> 744 </a>        &gt;&gt;&gt; c2
<a name="L745" class="line-number"> 745 </a>        {'section1': {'option1': 'False', 'subsection': {'more_options': 'False'}}}
<a name="L746" class="line-number"> 746 </a>        """</span>
<a name="L747" class="line-number"> 747 </a>        <span class="python-keyword">for</span> <span class="python-name">key</span><span class="python-operator">,</span> <span class="python-name">val</span> <span class="python-keyword">in</span> <span class="python-name">indict</span><span class="python-operator">.</span><span class="python-name">items</span><span class="python-operator">(</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L748" class="line-number"> 748 </a>            <span class="python-keyword">if</span> <span class="python-operator">(</span><span class="python-name">key</span> <span class="python-keyword">in</span> <span class="python-name">self</span> <span class="python-keyword">and</span> <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">[</span><span class="python-name">key</span><span class="python-operator">]</span><span class="python-operator">,</span> <span class="python-name">dict</span><span class="python-operator">)</span> <span class="python-keyword">and</span>
<a name="L749" class="line-number"> 749 </a>                                <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">val</span><span class="python-operator">,</span> <span class="python-name">dict</span><span class="python-operator">)</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L750" class="line-number"> 750 </a>                <span class="python-name">self</span><span class="python-operator">[</span><span class="python-name">key</span><span class="python-operator">]</span><span class="python-operator">.</span><span class="python-name">merge</span><span class="python-operator">(</span><span class="python-name">val</span><span class="python-operator">)</span>
<a name="L751" class="line-number"> 751 </a>            <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L752" class="line-number"> 752 </a>                <span class="python-name">self</span><span class="python-operator">[</span><span class="python-name">key</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-name">val</span>
<a name="L753" class="line-number"> 753 </a>
<a name="L754" class="line-number"> 754 </a>    <span class="python-keyword">def</span> <span class="python-name">rename</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">oldkey</span><span class="python-operator">,</span> <span class="python-name">newkey</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L755" class="line-number"> 755 </a>        <span class="python-string">"""
<a name="L756" class="line-number"> 756 </a>        Change a keyname to another, without changing position in sequence.
<a name="L757" class="line-number"> 757 </a>        
<a name="L758" class="line-number"> 758 </a>        Implemented so that transformations can be made on keys,
<a name="L759" class="line-number"> 759 </a>        as well as on values. (used by encode and decode)
<a name="L760" class="line-number"> 760 </a>        
<a name="L761" class="line-number"> 761 </a>        Also renames comments.
<a name="L762" class="line-number"> 762 </a>        """</span>
<a name="L763" class="line-number"> 763 </a>        <span class="python-keyword">if</span> <span class="python-name">oldkey</span> <span class="python-keyword">in</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">scalars</span><span class="python-operator">:</span>
<a name="L764" class="line-number"> 764 </a>            <span class="python-name">the_list</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">scalars</span>
<a name="L765" class="line-number"> 765 </a>        <span class="python-keyword">elif</span> <span class="python-name">oldkey</span> <span class="python-keyword">in</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">sections</span><span class="python-operator">:</span>
<a name="L766" class="line-number"> 766 </a>            <span class="python-name">the_list</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">sections</span>
<a name="L767" class="line-number"> 767 </a>        <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L768" class="line-number"> 768 </a>            <span class="python-keyword">raise</span> <span class="python-name">KeyError</span><span class="python-operator">,</span> <span class="python-string">'Key "%s" not found.'</span> <span class="python-operator">%</span> <span class="python-name">oldkey</span>
<a name="L769" class="line-number"> 769 </a>        <span class="python-name">pos</span> <span class="python-operator">=</span> <span class="python-name">the_list</span><span class="python-operator">.</span><span class="python-name">index</span><span class="python-operator">(</span><span class="python-name">oldkey</span><span class="python-operator">)</span>
<a name="L770" class="line-number"> 770 </a>        <span class="python-comment">#</span>
<a name="L771" class="line-number"> 771 </a>        <span class="python-name">val</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">[</span><span class="python-name">oldkey</span><span class="python-operator">]</span>
<a name="L772" class="line-number"> 772 </a>        <span class="python-name">dict</span><span class="python-operator">.</span><span class="python-name">__delitem__</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">oldkey</span><span class="python-operator">)</span>
<a name="L773" class="line-number"> 773 </a>        <span class="python-name">dict</span><span class="python-operator">.</span><span class="python-name">__setitem__</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">newkey</span><span class="python-operator">,</span> <span class="python-name">val</span><span class="python-operator">)</span>
<a name="L774" class="line-number"> 774 </a>        <span class="python-name">the_list</span><span class="python-operator">.</span><span class="python-name">remove</span><span class="python-operator">(</span><span class="python-name">oldkey</span><span class="python-operator">)</span>
<a name="L775" class="line-number"> 775 </a>        <span class="python-name">the_list</span><span class="python-operator">.</span><span class="python-name">insert</span><span class="python-operator">(</span><span class="python-name">pos</span><span class="python-operator">,</span> <span class="python-name">newkey</span><span class="python-operator">)</span>
<a name="L776" class="line-number"> 776 </a>        <span class="python-name">comm</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">comments</span><span class="python-operator">[</span><span class="python-name">oldkey</span><span class="python-operator">]</span>
<a name="L777" class="line-number"> 777 </a>        <span class="python-name">inline_comment</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">inline_comments</span><span class="python-operator">[</span><span class="python-name">oldkey</span><span class="python-operator">]</span>
<a name="L778" class="line-number"> 778 </a>        <span class="python-keyword">del</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">comments</span><span class="python-operator">[</span><span class="python-name">oldkey</span><span class="python-operator">]</span>
<a name="L779" class="line-number"> 779 </a>        <span class="python-keyword">del</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">inline_comments</span><span class="python-operator">[</span><span class="python-name">oldkey</span><span class="python-operator">]</span>
<a name="L780" class="line-number"> 780 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">comments</span><span class="python-operator">[</span><span class="python-name">newkey</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-name">comm</span>
<a name="L781" class="line-number"> 781 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">inline_comments</span><span class="python-operator">[</span><span class="python-name">newkey</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-name">inline_comment</span>
<a name="L782" class="line-number"> 782 </a>
<a name="L783" class="line-number"> 783 </a>    <span class="python-keyword">def</span> <span class="python-name">walk</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">function</span><span class="python-operator">,</span> <span class="python-name">raise_errors</span><span class="python-operator">=</span><span class="python-name">True</span><span class="python-operator">,</span>
<a name="L784" class="line-number"> 784 </a>            <span class="python-name">call_on_sections</span><span class="python-operator">=</span><span class="python-name">False</span><span class="python-operator">,</span> <span class="python-operator">**</span><span class="python-name">keywargs</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L785" class="line-number"> 785 </a>        <span class="python-string">"""
<a name="L786" class="line-number"> 786 </a>        Walk every member and call a function on the keyword and value.
<a name="L787" class="line-number"> 787 </a>        
<a name="L788" class="line-number"> 788 </a>        Return a dictionary of the return values
<a name="L789" class="line-number"> 789 </a>        
<a name="L790" class="line-number"> 790 </a>        If the function raises an exception, raise the errror
<a name="L791" class="line-number"> 791 </a>        unless ``raise_errors=False``, in which case set the return value to
<a name="L792" class="line-number"> 792 </a>        ``False``.
<a name="L793" class="line-number"> 793 </a>        
<a name="L794" class="line-number"> 794 </a>        Any unrecognised keyword arguments you pass to walk, will be pased on
<a name="L795" class="line-number"> 795 </a>        to the function you pass in.
<a name="L796" class="line-number"> 796 </a>        
<a name="L797" class="line-number"> 797 </a>        Note: if ``call_on_sections`` is ``True`` then - on encountering a
<a name="L798" class="line-number"> 798 </a>        subsection, *first* the function is called for the *whole* subsection,
<a name="L799" class="line-number"> 799 </a>        and then recurses into it's members. This means your function must be
<a name="L800" class="line-number"> 800 </a>        able to handle strings, dictionaries and lists. This allows you
<a name="L801" class="line-number"> 801 </a>        to change the key of subsections as well as for ordinary members. The
<a name="L802" class="line-number"> 802 </a>        return value when called on the whole subsection has to be discarded.
<a name="L803" class="line-number"> 803 </a>        
<a name="L804" class="line-number"> 804 </a>        See  the encode and decode methods for examples, including functions.
<a name="L805" class="line-number"> 805 </a>        
<a name="L806" class="line-number"> 806 </a>        .. caution::
<a name="L807" class="line-number"> 807 </a>        
<a name="L808" class="line-number"> 808 </a>            You can use ``walk`` to transform the names of members of a section
<a name="L809" class="line-number"> 809 </a>            but you mustn't add or delete members.
<a name="L810" class="line-number"> 810 </a>        
<a name="L811" class="line-number"> 811 </a>        &gt;&gt;&gt; config = '''[XXXXsection]
<a name="L812" class="line-number"> 812 </a>        ... XXXXkey = XXXXvalue'''.splitlines()
<a name="L813" class="line-number"> 813 </a>        &gt;&gt;&gt; cfg = ConfigObj(config)
<a name="L814" class="line-number"> 814 </a>        &gt;&gt;&gt; cfg
<a name="L815" class="line-number"> 815 </a>        {'XXXXsection': {'XXXXkey': 'XXXXvalue'}}
<a name="L816" class="line-number"> 816 </a>        &gt;&gt;&gt; def transform(section, key):
<a name="L817" class="line-number"> 817 </a>        ...     val = section[key]
<a name="L818" class="line-number"> 818 </a>        ...     newkey = key.replace('XXXX', 'CLIENT1')
<a name="L819" class="line-number"> 819 </a>        ...     section.rename(key, newkey)
<a name="L820" class="line-number"> 820 </a>        ...     if isinstance(val, (tuple, list, dict)):
<a name="L821" class="line-number"> 821 </a>        ...         pass
<a name="L822" class="line-number"> 822 </a>        ...     else:
<a name="L823" class="line-number"> 823 </a>        ...         val = val.replace('XXXX', 'CLIENT1')
<a name="L824" class="line-number"> 824 </a>        ...         section[newkey] = val
<a name="L825" class="line-number"> 825 </a>        &gt;&gt;&gt; cfg.walk(transform, call_on_sections=True)
<a name="L826" class="line-number"> 826 </a>        {'CLIENT1section': {'CLIENT1key': None}}
<a name="L827" class="line-number"> 827 </a>        &gt;&gt;&gt; cfg
<a name="L828" class="line-number"> 828 </a>        {'CLIENT1section': {'CLIENT1key': 'CLIENT1value'}}
<a name="L829" class="line-number"> 829 </a>        """</span>
<a name="L830" class="line-number"> 830 </a>        <span class="python-name">out</span> <span class="python-operator">=</span> <span class="python-operator">{</span><span class="python-operator">}</span>
<a name="L831" class="line-number"> 831 </a>        <span class="python-comment"># scalars first</span>
<a name="L832" class="line-number"> 832 </a>        <span class="python-keyword">for</span> <span class="python-name">i</span> <span class="python-keyword">in</span> <span class="python-name">range</span><span class="python-operator">(</span><span class="python-name">len</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">scalars</span><span class="python-operator">)</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L833" class="line-number"> 833 </a>            <span class="python-name">entry</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">scalars</span><span class="python-operator">[</span><span class="python-name">i</span><span class="python-operator">]</span>
<a name="L834" class="line-number"> 834 </a>            <span class="python-keyword">try</span><span class="python-operator">:</span>
<a name="L835" class="line-number"> 835 </a>                <span class="python-name">val</span> <span class="python-operator">=</span> <span class="python-name">function</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">entry</span><span class="python-operator">,</span> <span class="python-operator">**</span><span class="python-name">keywargs</span><span class="python-operator">)</span>
<a name="L836" class="line-number"> 836 </a>                <span class="python-comment"># bound again in case name has changed</span>
<a name="L837" class="line-number"> 837 </a>                <span class="python-name">entry</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">scalars</span><span class="python-operator">[</span><span class="python-name">i</span><span class="python-operator">]</span>
<a name="L838" class="line-number"> 838 </a>                <span class="python-name">out</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-name">val</span>
<a name="L839" class="line-number"> 839 </a>            <span class="python-keyword">except</span> <span class="python-name">Exception</span><span class="python-operator">:</span>
<a name="L840" class="line-number"> 840 </a>                <span class="python-keyword">if</span> <span class="python-name">raise_errors</span><span class="python-operator">:</span>
<a name="L841" class="line-number"> 841 </a>                    <span class="python-keyword">raise</span>
<a name="L842" class="line-number"> 842 </a>                <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L843" class="line-number"> 843 </a>                    <span class="python-name">entry</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">scalars</span><span class="python-operator">[</span><span class="python-name">i</span><span class="python-operator">]</span>
<a name="L844" class="line-number"> 844 </a>                    <span class="python-name">out</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-name">False</span>
<a name="L845" class="line-number"> 845 </a>        <span class="python-comment"># then sections</span>
<a name="L846" class="line-number"> 846 </a>        <span class="python-keyword">for</span> <span class="python-name">i</span> <span class="python-keyword">in</span> <span class="python-name">range</span><span class="python-operator">(</span><span class="python-name">len</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">sections</span><span class="python-operator">)</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L847" class="line-number"> 847 </a>            <span class="python-name">entry</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">sections</span><span class="python-operator">[</span><span class="python-name">i</span><span class="python-operator">]</span>
<a name="L848" class="line-number"> 848 </a>            <span class="python-keyword">if</span> <span class="python-name">call_on_sections</span><span class="python-operator">:</span>
<a name="L849" class="line-number"> 849 </a>                <span class="python-keyword">try</span><span class="python-operator">:</span>
<a name="L850" class="line-number"> 850 </a>                    <span class="python-name">function</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">entry</span><span class="python-operator">,</span> <span class="python-operator">**</span><span class="python-name">keywargs</span><span class="python-operator">)</span>
<a name="L851" class="line-number"> 851 </a>                <span class="python-keyword">except</span> <span class="python-name">Exception</span><span class="python-operator">:</span>
<a name="L852" class="line-number"> 852 </a>                    <span class="python-keyword">if</span> <span class="python-name">raise_errors</span><span class="python-operator">:</span>
<a name="L853" class="line-number"> 853 </a>                        <span class="python-keyword">raise</span>
<a name="L854" class="line-number"> 854 </a>                    <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L855" class="line-number"> 855 </a>                        <span class="python-name">entry</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">sections</span><span class="python-operator">[</span><span class="python-name">i</span><span class="python-operator">]</span>
<a name="L856" class="line-number"> 856 </a>                        <span class="python-name">out</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-name">False</span>
<a name="L857" class="line-number"> 857 </a>                <span class="python-comment"># bound again in case name has changed</span>
<a name="L858" class="line-number"> 858 </a>                <span class="python-name">entry</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">sections</span><span class="python-operator">[</span><span class="python-name">i</span><span class="python-operator">]</span>
<a name="L859" class="line-number"> 859 </a>            <span class="python-comment"># previous result is discarded</span>
<a name="L860" class="line-number"> 860 </a>            <span class="python-name">out</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span><span class="python-operator">.</span><span class="python-name">walk</span><span class="python-operator">(</span>
<a name="L861" class="line-number"> 861 </a>                <span class="python-name">function</span><span class="python-operator">,</span>
<a name="L862" class="line-number"> 862 </a>                <span class="python-name">raise_errors</span><span class="python-operator">=</span><span class="python-name">raise_errors</span><span class="python-operator">,</span>
<a name="L863" class="line-number"> 863 </a>                <span class="python-name">call_on_sections</span><span class="python-operator">=</span><span class="python-name">call_on_sections</span><span class="python-operator">,</span>
<a name="L864" class="line-number"> 864 </a>                <span class="python-operator">**</span><span class="python-name">keywargs</span><span class="python-operator">)</span>
<a name="L865" class="line-number"> 865 </a>        <span class="python-keyword">return</span> <span class="python-name">out</span>
<a name="L866" class="line-number"> 866 </a>
<a name="L867" class="line-number"> 867 </a>    <span class="python-keyword">def</span> <span class="python-name">decode</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">encoding</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L868" class="line-number"> 868 </a>        <span class="python-string">"""
<a name="L869" class="line-number"> 869 </a>        Decode all strings and values to unicode, using the specified encoding.
<a name="L870" class="line-number"> 870 </a>        
<a name="L871" class="line-number"> 871 </a>        Works with subsections and list values.
<a name="L872" class="line-number"> 872 </a>        
<a name="L873" class="line-number"> 873 </a>        Uses the ``walk`` method.
<a name="L874" class="line-number"> 874 </a>        
<a name="L875" class="line-number"> 875 </a>        Testing ``encode`` and ``decode``.
<a name="L876" class="line-number"> 876 </a>        &gt;&gt;&gt; m = ConfigObj(a)
<a name="L877" class="line-number"> 877 </a>        &gt;&gt;&gt; m.decode('ascii')
<a name="L878" class="line-number"> 878 </a>        &gt;&gt;&gt; def testuni(val):
<a name="L879" class="line-number"> 879 </a>        ...     for entry in val:
<a name="L880" class="line-number"> 880 </a>        ...         if not isinstance(entry, unicode):
<a name="L881" class="line-number"> 881 </a>        ...             print &gt;&gt; sys.stderr, type(entry)
<a name="L882" class="line-number"> 882 </a>        ...             raise AssertionError, 'decode failed.'
<a name="L883" class="line-number"> 883 </a>        ...         if isinstance(val[entry], dict):
<a name="L884" class="line-number"> 884 </a>        ...             testuni(val[entry])
<a name="L885" class="line-number"> 885 </a>        ...         elif not isinstance(val[entry], unicode):
<a name="L886" class="line-number"> 886 </a>        ...             raise AssertionError, 'decode failed.'
<a name="L887" class="line-number"> 887 </a>        &gt;&gt;&gt; testuni(m)
<a name="L888" class="line-number"> 888 </a>        &gt;&gt;&gt; m.encode('ascii')
<a name="L889" class="line-number"> 889 </a>        &gt;&gt;&gt; a == m
<a name="L890" class="line-number"> 890 </a>        1
<a name="L891" class="line-number"> 891 </a>        """</span>
<a name="L892" class="line-number"> 892 </a>        <span class="python-name">warn</span><span class="python-operator">(</span><span class="python-string">'use of ``decode`` is deprecated.'</span><span class="python-operator">,</span> <span class="python-name">DeprecationWarning</span><span class="python-operator">)</span>
<a name="L893" class="line-number"> 893 </a>        <span class="python-keyword">def</span> <span class="python-name">decode</span><span class="python-operator">(</span><span class="python-name">section</span><span class="python-operator">,</span> <span class="python-name">key</span><span class="python-operator">,</span> <span class="python-name">encoding</span><span class="python-operator">=</span><span class="python-name">encoding</span><span class="python-operator">,</span> <span class="python-name">warn</span><span class="python-operator">=</span><span class="python-name">True</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L894" class="line-number"> 894 </a>            <span class="python-string">""" """</span>
<a name="L895" class="line-number"> 895 </a>            <span class="python-name">val</span> <span class="python-operator">=</span> <span class="python-name">section</span><span class="python-operator">[</span><span class="python-name">key</span><span class="python-operator">]</span>
<a name="L896" class="line-number"> 896 </a>            <span class="python-keyword">if</span> <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">val</span><span class="python-operator">,</span> <span class="python-operator">(</span><span class="python-name">list</span><span class="python-operator">,</span> <span class="python-name">tuple</span><span class="python-operator">)</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L897" class="line-number"> 897 </a>                <span class="python-name">newval</span> <span class="python-operator">=</span> <span class="python-operator">[</span><span class="python-operator">]</span>
<a name="L898" class="line-number"> 898 </a>                <span class="python-keyword">for</span> <span class="python-name">entry</span> <span class="python-keyword">in</span> <span class="python-name">val</span><span class="python-operator">:</span>
<a name="L899" class="line-number"> 899 </a>                    <span class="python-name">newval</span><span class="python-operator">.</span><span class="python-name">append</span><span class="python-operator">(</span><span class="python-name">entry</span><span class="python-operator">.</span><span class="python-name">decode</span><span class="python-operator">(</span><span class="python-name">encoding</span><span class="python-operator">)</span><span class="python-operator">)</span>
<a name="L900" class="line-number"> 900 </a>            <span class="python-keyword">elif</span> <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">val</span><span class="python-operator">,</span> <span class="python-name">dict</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L901" class="line-number"> 901 </a>                <span class="python-name">newval</span> <span class="python-operator">=</span> <span class="python-name">val</span>
<a name="L902" class="line-number"> 902 </a>            <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L903" class="line-number"> 903 </a>                <span class="python-name">newval</span> <span class="python-operator">=</span> <span class="python-name">val</span><span class="python-operator">.</span><span class="python-name">decode</span><span class="python-operator">(</span><span class="python-name">encoding</span><span class="python-operator">)</span>
<a name="L904" class="line-number"> 904 </a>            <span class="python-name">newkey</span> <span class="python-operator">=</span> <span class="python-name">key</span><span class="python-operator">.</span><span class="python-name">decode</span><span class="python-operator">(</span><span class="python-name">encoding</span><span class="python-operator">)</span>
<a name="L905" class="line-number"> 905 </a>            <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">rename</span><span class="python-operator">(</span><span class="python-name">key</span><span class="python-operator">,</span> <span class="python-name">newkey</span><span class="python-operator">)</span>
<a name="L906" class="line-number"> 906 </a>            <span class="python-name">section</span><span class="python-operator">[</span><span class="python-name">newkey</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-name">newval</span>
<a name="L907" class="line-number"> 907 </a>        <span class="python-comment"># using ``call_on_sections`` allows us to modify section names</span>
<a name="L908" class="line-number"> 908 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">walk</span><span class="python-operator">(</span><span class="python-name">decode</span><span class="python-operator">,</span> <span class="python-name">call_on_sections</span><span class="python-operator">=</span><span class="python-name">True</span><span class="python-operator">)</span>
<a name="L909" class="line-number"> 909 </a>
<a name="L910" class="line-number"> 910 </a>    <span class="python-keyword">def</span> <span class="python-name">encode</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">encoding</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L911" class="line-number"> 911 </a>        <span class="python-string">"""
<a name="L912" class="line-number"> 912 </a>        Encode all strings and values from unicode,
<a name="L913" class="line-number"> 913 </a>        using the specified encoding.
<a name="L914" class="line-number"> 914 </a>        
<a name="L915" class="line-number"> 915 </a>        Works with subsections and list values.
<a name="L916" class="line-number"> 916 </a>        Uses the ``walk`` method.
<a name="L917" class="line-number"> 917 </a>        """</span>
<a name="L918" class="line-number"> 918 </a>        <span class="python-name">warn</span><span class="python-operator">(</span><span class="python-string">'use of ``encode`` is deprecated.'</span><span class="python-operator">,</span> <span class="python-name">DeprecationWarning</span><span class="python-operator">)</span>
<a name="L919" class="line-number"> 919 </a>        <span class="python-keyword">def</span> <span class="python-name">encode</span><span class="python-operator">(</span><span class="python-name">section</span><span class="python-operator">,</span> <span class="python-name">key</span><span class="python-operator">,</span> <span class="python-name">encoding</span><span class="python-operator">=</span><span class="python-name">encoding</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L920" class="line-number"> 920 </a>            <span class="python-string">""" """</span>
<a name="L921" class="line-number"> 921 </a>            <span class="python-name">val</span> <span class="python-operator">=</span> <span class="python-name">section</span><span class="python-operator">[</span><span class="python-name">key</span><span class="python-operator">]</span>
<a name="L922" class="line-number"> 922 </a>            <span class="python-keyword">if</span> <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">val</span><span class="python-operator">,</span> <span class="python-operator">(</span><span class="python-name">list</span><span class="python-operator">,</span> <span class="python-name">tuple</span><span class="python-operator">)</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L923" class="line-number"> 923 </a>                <span class="python-name">newval</span> <span class="python-operator">=</span> <span class="python-operator">[</span><span class="python-operator">]</span>
<a name="L924" class="line-number"> 924 </a>                <span class="python-keyword">for</span> <span class="python-name">entry</span> <span class="python-keyword">in</span> <span class="python-name">val</span><span class="python-operator">:</span>
<a name="L925" class="line-number"> 925 </a>                    <span class="python-name">newval</span><span class="python-operator">.</span><span class="python-name">append</span><span class="python-operator">(</span><span class="python-name">entry</span><span class="python-operator">.</span><span class="python-name">encode</span><span class="python-operator">(</span><span class="python-name">encoding</span><span class="python-operator">)</span><span class="python-operator">)</span>
<a name="L926" class="line-number"> 926 </a>            <span class="python-keyword">elif</span> <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">val</span><span class="python-operator">,</span> <span class="python-name">dict</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L927" class="line-number"> 927 </a>                <span class="python-name">newval</span> <span class="python-operator">=</span> <span class="python-name">val</span>
<a name="L928" class="line-number"> 928 </a>            <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L929" class="line-number"> 929 </a>                <span class="python-name">newval</span> <span class="python-operator">=</span> <span class="python-name">val</span><span class="python-operator">.</span><span class="python-name">encode</span><span class="python-operator">(</span><span class="python-name">encoding</span><span class="python-operator">)</span>
<a name="L930" class="line-number"> 930 </a>            <span class="python-name">newkey</span> <span class="python-operator">=</span> <span class="python-name">key</span><span class="python-operator">.</span><span class="python-name">encode</span><span class="python-operator">(</span><span class="python-name">encoding</span><span class="python-operator">)</span>
<a name="L931" class="line-number"> 931 </a>            <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">rename</span><span class="python-operator">(</span><span class="python-name">key</span><span class="python-operator">,</span> <span class="python-name">newkey</span><span class="python-operator">)</span>
<a name="L932" class="line-number"> 932 </a>            <span class="python-name">section</span><span class="python-operator">[</span><span class="python-name">newkey</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-name">newval</span>
<a name="L933" class="line-number"> 933 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">walk</span><span class="python-operator">(</span><span class="python-name">encode</span><span class="python-operator">,</span> <span class="python-name">call_on_sections</span><span class="python-operator">=</span><span class="python-name">True</span><span class="python-operator">)</span>
<a name="L934" class="line-number"> 934 </a>
<a name="L935" class="line-number"> 935 </a>    <span class="python-keyword">def</span> <span class="python-name">istrue</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">key</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L936" class="line-number"> 936 </a>        <span class="python-string">"""A deprecated version of ``as_bool``."""</span>
<a name="L937" class="line-number"> 937 </a>        <span class="python-name">warn</span><span class="python-operator">(</span><span class="python-string">'use of ``istrue`` is deprecated. Use ``as_bool`` method '</span>
<a name="L938" class="line-number"> 938 </a>                <span class="python-string">'instead.'</span><span class="python-operator">,</span> <span class="python-name">DeprecationWarning</span><span class="python-operator">)</span>
<a name="L939" class="line-number"> 939 </a>        <span class="python-keyword">return</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">as_bool</span><span class="python-operator">(</span><span class="python-name">key</span><span class="python-operator">)</span>
<a name="L940" class="line-number"> 940 </a>
<a name="L941" class="line-number"> 941 </a>    <span class="python-keyword">def</span> <span class="python-name">as_bool</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">key</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L942" class="line-number"> 942 </a>        <span class="python-string">"""
<a name="L943" class="line-number"> 943 </a>        Accepts a key as input. The corresponding value must be a string or
<a name="L944" class="line-number"> 944 </a>        the objects (``True`` or 1) or (``False`` or 0). We allow 0 and 1 to
<a name="L945" class="line-number"> 945 </a>        retain compatibility with Python 2.2.
<a name="L946" class="line-number"> 946 </a>        
<a name="L947" class="line-number"> 947 </a>        If the string is one of  ``True``, ``On``, ``Yes``, or ``1`` it returns 
<a name="L948" class="line-number"> 948 </a>        ``True``.
<a name="L949" class="line-number"> 949 </a>        
<a name="L950" class="line-number"> 950 </a>        If the string is one of  ``False``, ``Off``, ``No``, or ``0`` it returns 
<a name="L951" class="line-number"> 951 </a>        ``False``.
<a name="L952" class="line-number"> 952 </a>        
<a name="L953" class="line-number"> 953 </a>        ``as_bool`` is not case sensitive.
<a name="L954" class="line-number"> 954 </a>        
<a name="L955" class="line-number"> 955 </a>        Any other input will raise a ``ValueError``.
<a name="L956" class="line-number"> 956 </a>        
<a name="L957" class="line-number"> 957 </a>        &gt;&gt;&gt; a = ConfigObj()
<a name="L958" class="line-number"> 958 </a>        &gt;&gt;&gt; a['a'] = 'fish'
<a name="L959" class="line-number"> 959 </a>        &gt;&gt;&gt; a.as_bool('a')
<a name="L960" class="line-number"> 960 </a>        Traceback (most recent call last):
<a name="L961" class="line-number"> 961 </a>        ValueError: Value "fish" is neither True nor False
<a name="L962" class="line-number"> 962 </a>        &gt;&gt;&gt; a['b'] = 'True'
<a name="L963" class="line-number"> 963 </a>        &gt;&gt;&gt; a.as_bool('b')
<a name="L964" class="line-number"> 964 </a>        1
<a name="L965" class="line-number"> 965 </a>        &gt;&gt;&gt; a['b'] = 'off'
<a name="L966" class="line-number"> 966 </a>        &gt;&gt;&gt; a.as_bool('b')
<a name="L967" class="line-number"> 967 </a>        0
<a name="L968" class="line-number"> 968 </a>        """</span>
<a name="L969" class="line-number"> 969 </a>        <span class="python-name">val</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">[</span><span class="python-name">key</span><span class="python-operator">]</span>
<a name="L970" class="line-number"> 970 </a>        <span class="python-keyword">if</span> <span class="python-name">val</span> <span class="python-operator">==</span> <span class="python-name">True</span><span class="python-operator">:</span>
<a name="L971" class="line-number"> 971 </a>            <span class="python-keyword">return</span> <span class="python-name">True</span>
<a name="L972" class="line-number"> 972 </a>        <span class="python-keyword">elif</span> <span class="python-name">val</span> <span class="python-operator">==</span> <span class="python-name">False</span><span class="python-operator">:</span>
<a name="L973" class="line-number"> 973 </a>            <span class="python-keyword">return</span> <span class="python-name">False</span>
<a name="L974" class="line-number"> 974 </a>        <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L975" class="line-number"> 975 </a>            <span class="python-keyword">try</span><span class="python-operator">:</span>
<a name="L976" class="line-number"> 976 </a>                <span class="python-keyword">if</span> <span class="python-keyword">not</span> <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">val</span><span class="python-operator">,</span> <span class="python-name">StringTypes</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L977" class="line-number"> 977 </a>                    <span class="python-keyword">raise</span> <span class="python-name">KeyError</span>
<a name="L978" class="line-number"> 978 </a>                <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L979" class="line-number"> 979 </a>                    <span class="python-keyword">return</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">main</span><span class="python-operator">.</span><span class="python-name">_bools</span><span class="python-operator">[</span><span class="python-name">val</span><span class="python-operator">.</span><span class="python-name">lower</span><span class="python-operator">(</span><span class="python-operator">)</span><span class="python-operator">]</span>
<a name="L980" class="line-number"> 980 </a>            <span class="python-keyword">except</span> <span class="python-name">KeyError</span><span class="python-operator">:</span>
<a name="L981" class="line-number"> 981 </a>                <span class="python-keyword">raise</span> <span class="python-name">ValueError</span><span class="python-operator">(</span><span class="python-string">'Value "%s" is neither True nor False'</span> <span class="python-operator">%</span> <span class="python-name">val</span><span class="python-operator">)</span>
<a name="L982" class="line-number"> 982 </a>
<a name="L983" class="line-number"> 983 </a>    <span class="python-keyword">def</span> <span class="python-name">as_int</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">key</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L984" class="line-number"> 984 </a>        <span class="python-string">"""
<a name="L985" class="line-number"> 985 </a>        A convenience method which coerces the specified value to an integer.
<a name="L986" class="line-number"> 986 </a>        
<a name="L987" class="line-number"> 987 </a>        If the value is an invalid literal for ``int``, a ``ValueError`` will
<a name="L988" class="line-number"> 988 </a>        be raised.
<a name="L989" class="line-number"> 989 </a>        
<a name="L990" class="line-number"> 990 </a>        &gt;&gt;&gt; a = ConfigObj()
<a name="L991" class="line-number"> 991 </a>        &gt;&gt;&gt; a['a'] = 'fish'
<a name="L992" class="line-number"> 992 </a>        &gt;&gt;&gt; a.as_int('a')
<a name="L993" class="line-number"> 993 </a>        Traceback (most recent call last):
<a name="L994" class="line-number"> 994 </a>        ValueError: invalid literal for int(): fish
<a name="L995" class="line-number"> 995 </a>        &gt;&gt;&gt; a['b'] = '1'
<a name="L996" class="line-number"> 996 </a>        &gt;&gt;&gt; a.as_int('b')
<a name="L997" class="line-number"> 997 </a>        1
<a name="L998" class="line-number"> 998 </a>        &gt;&gt;&gt; a['b'] = '3.2'
<a name="L999" class="line-number"> 999 </a>        &gt;&gt;&gt; a.as_int('b')
<a name="L1000" class="line-number">1000 </a>        Traceback (most recent call last):
<a name="L1001" class="line-number">1001 </a>        ValueError: invalid literal for int(): 3.2
<a name="L1002" class="line-number">1002 </a>        """</span>
<a name="L1003" class="line-number">1003 </a>        <span class="python-keyword">return</span> <span class="python-name">int</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">[</span><span class="python-name">key</span><span class="python-operator">]</span><span class="python-operator">)</span>
<a name="L1004" class="line-number">1004 </a>
<a name="L1005" class="line-number">1005 </a>    <span class="python-keyword">def</span> <span class="python-name">as_float</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">key</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1006" class="line-number">1006 </a>        <span class="python-string">"""
<a name="L1007" class="line-number">1007 </a>        A convenience method which coerces the specified value to a float.
<a name="L1008" class="line-number">1008 </a>        
<a name="L1009" class="line-number">1009 </a>        If the value is an invalid literal for ``float``, a ``ValueError`` will
<a name="L1010" class="line-number">1010 </a>        be raised.
<a name="L1011" class="line-number">1011 </a>        
<a name="L1012" class="line-number">1012 </a>        &gt;&gt;&gt; a = ConfigObj()
<a name="L1013" class="line-number">1013 </a>        &gt;&gt;&gt; a['a'] = 'fish'
<a name="L1014" class="line-number">1014 </a>        &gt;&gt;&gt; a.as_float('a')
<a name="L1015" class="line-number">1015 </a>        Traceback (most recent call last):
<a name="L1016" class="line-number">1016 </a>        ValueError: invalid literal for float(): fish
<a name="L1017" class="line-number">1017 </a>        &gt;&gt;&gt; a['b'] = '1'
<a name="L1018" class="line-number">1018 </a>        &gt;&gt;&gt; a.as_float('b')
<a name="L1019" class="line-number">1019 </a>        1.0
<a name="L1020" class="line-number">1020 </a>        &gt;&gt;&gt; a['b'] = '3.2'
<a name="L1021" class="line-number">1021 </a>        &gt;&gt;&gt; a.as_float('b')
<a name="L1022" class="line-number">1022 </a>        3.2000000000000002
<a name="L1023" class="line-number">1023 </a>        """</span>
<a name="L1024" class="line-number">1024 </a>        <span class="python-keyword">return</span> <span class="python-name">float</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">[</span><span class="python-name">key</span><span class="python-operator">]</span><span class="python-operator">)</span>
<a name="L1025" class="line-number">1025 </a>
<a name="L1026" class="line-number">1026 </a>
<a name="L1027" class="line-number">1027 </a><span class="python-keyword">class</span> <span class="python-name">ConfigObj</span><span class="python-operator">(</span><span class="python-name">Section</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1028" class="line-number">1028 </a>    <span class="python-string">"""An object to read, create, and write config files."""</span>
<a name="L1029" class="line-number">1029 </a>
<a name="L1030" class="line-number">1030 </a>    <span class="python-name">_keyword</span> <span class="python-operator">=</span> <span class="python-name">re</span><span class="python-operator">.</span><span class="python-name">compile</span><span class="python-operator">(</span><span class="python-string">r'''^ # line start
<a name="L1031" class="line-number">1031 </a>        (\s*)                   # indentation
<a name="L1032" class="line-number">1032 </a>        (                       # keyword
<a name="L1033" class="line-number">1033 </a>            (?:".*?")|          # double quotes
<a name="L1034" class="line-number">1034 </a>            (?:'.*?')|          # single quotes
<a name="L1035" class="line-number">1035 </a>            (?:[^'"=].*?)       # no quotes
<a name="L1036" class="line-number">1036 </a>        )
<a name="L1037" class="line-number">1037 </a>        \s*=\s*                 # divider
<a name="L1038" class="line-number">1038 </a>        (.*)                    # value (including list values and comments)
<a name="L1039" class="line-number">1039 </a>        $   # line end
<a name="L1040" class="line-number">1040 </a>        '''</span><span class="python-operator">,</span>
<a name="L1041" class="line-number">1041 </a>        <span class="python-name">re</span><span class="python-operator">.</span><span class="python-name">VERBOSE</span><span class="python-operator">)</span>
<a name="L1042" class="line-number">1042 </a>
<a name="L1043" class="line-number">1043 </a>    <span class="python-name">_sectionmarker</span> <span class="python-operator">=</span> <span class="python-name">re</span><span class="python-operator">.</span><span class="python-name">compile</span><span class="python-operator">(</span><span class="python-string">r'''^
<a name="L1044" class="line-number">1044 </a>        (\s*)                     # 1: indentation
<a name="L1045" class="line-number">1045 </a>        ((?:\[\s*)+)              # 2: section marker open
<a name="L1046" class="line-number">1046 </a>        (                         # 3: section name open
<a name="L1047" class="line-number">1047 </a>            (?:"\s*\S.*?\s*")|    # at least one non-space with double quotes
<a name="L1048" class="line-number">1048 </a>            (?:'\s*\S.*?\s*')|    # at least one non-space with single quotes
<a name="L1049" class="line-number">1049 </a>            (?:[^'"\s].*?)        # at least one non-space unquoted
<a name="L1050" class="line-number">1050 </a>        )                         # section name close
<a name="L1051" class="line-number">1051 </a>        ((?:\s*\])+)              # 4: section marker close
<a name="L1052" class="line-number">1052 </a>        \s*(\#.*)?                # 5: optional comment
<a name="L1053" class="line-number">1053 </a>        $'''</span><span class="python-operator">,</span>
<a name="L1054" class="line-number">1054 </a>        <span class="python-name">re</span><span class="python-operator">.</span><span class="python-name">VERBOSE</span><span class="python-operator">)</span>
<a name="L1055" class="line-number">1055 </a>
<a name="L1056" class="line-number">1056 </a>    <span class="python-comment"># this regexp pulls list values out as a single string</span>
<a name="L1057" class="line-number">1057 </a>    <span class="python-comment"># or single values and comments</span>
<a name="L1058" class="line-number">1058 </a>    <span class="python-comment"># FIXME: this regex adds a '' to the end of comma terminated lists</span>
<a name="L1059" class="line-number">1059 </a>    <span class="python-comment">#   workaround in ``_handle_value``</span>
<a name="L1060" class="line-number">1060 </a>    <span class="python-name">_valueexp</span> <span class="python-operator">=</span> <span class="python-name">re</span><span class="python-operator">.</span><span class="python-name">compile</span><span class="python-operator">(</span><span class="python-string">r'''^
<a name="L1061" class="line-number">1061 </a>        (?:
<a name="L1062" class="line-number">1062 </a>            (?:
<a name="L1063" class="line-number">1063 </a>                (
<a name="L1064" class="line-number">1064 </a>                    (?:
<a name="L1065" class="line-number">1065 </a>                        (?:
<a name="L1066" class="line-number">1066 </a>                            (?:".*?")|              # double quotes
<a name="L1067" class="line-number">1067 </a>                            (?:'.*?')|              # single quotes
<a name="L1068" class="line-number">1068 </a>                            (?:[^'",\#][^,\#]*?)    # unquoted
<a name="L1069" class="line-number">1069 </a>                        )
<a name="L1070" class="line-number">1070 </a>                        \s*,\s*                     # comma
<a name="L1071" class="line-number">1071 </a>                    )*      # match all list items ending in a comma (if any)
<a name="L1072" class="line-number">1072 </a>                )
<a name="L1073" class="line-number">1073 </a>                (
<a name="L1074" class="line-number">1074 </a>                    (?:".*?")|                      # double quotes
<a name="L1075" class="line-number">1075 </a>                    (?:'.*?')|                      # single quotes
<a name="L1076" class="line-number">1076 </a>                    (?:[^'",\#\s][^,]*?)|           # unquoted
<a name="L1077" class="line-number">1077 </a>                    (?:(?&lt;!,))                      # Empty value
<a name="L1078" class="line-number">1078 </a>                )?          # last item in a list - or string value
<a name="L1079" class="line-number">1079 </a>            )|
<a name="L1080" class="line-number">1080 </a>            (,)             # alternatively a single comma - empty list
<a name="L1081" class="line-number">1081 </a>        )
<a name="L1082" class="line-number">1082 </a>        \s*(\#.*)?          # optional comment
<a name="L1083" class="line-number">1083 </a>        $'''</span><span class="python-operator">,</span>
<a name="L1084" class="line-number">1084 </a>        <span class="python-name">re</span><span class="python-operator">.</span><span class="python-name">VERBOSE</span><span class="python-operator">)</span>
<a name="L1085" class="line-number">1085 </a>
<a name="L1086" class="line-number">1086 </a>    <span class="python-comment"># use findall to get the members of a list value</span>
<a name="L1087" class="line-number">1087 </a>    <span class="python-name">_listvalueexp</span> <span class="python-operator">=</span> <span class="python-name">re</span><span class="python-operator">.</span><span class="python-name">compile</span><span class="python-operator">(</span><span class="python-string">r'''
<a name="L1088" class="line-number">1088 </a>        (
<a name="L1089" class="line-number">1089 </a>            (?:".*?")|          # double quotes
<a name="L1090" class="line-number">1090 </a>            (?:'.*?')|          # single quotes
<a name="L1091" class="line-number">1091 </a>            (?:[^'",\#].*?)       # unquoted
<a name="L1092" class="line-number">1092 </a>        )
<a name="L1093" class="line-number">1093 </a>        \s*,\s*                 # comma
<a name="L1094" class="line-number">1094 </a>        '''</span><span class="python-operator">,</span>
<a name="L1095" class="line-number">1095 </a>        <span class="python-name">re</span><span class="python-operator">.</span><span class="python-name">VERBOSE</span><span class="python-operator">)</span>
<a name="L1096" class="line-number">1096 </a>
<a name="L1097" class="line-number">1097 </a>    <span class="python-comment"># this regexp is used for the value</span>
<a name="L1098" class="line-number">1098 </a>    <span class="python-comment"># when lists are switched off</span>
<a name="L1099" class="line-number">1099 </a>    <span class="python-name">_nolistvalue</span> <span class="python-operator">=</span> <span class="python-name">re</span><span class="python-operator">.</span><span class="python-name">compile</span><span class="python-operator">(</span><span class="python-string">r'''^
<a name="L1100" class="line-number">1100 </a>        (
<a name="L1101" class="line-number">1101 </a>            (?:".*?")|          # double quotes
<a name="L1102" class="line-number">1102 </a>            (?:'.*?')|          # single quotes
<a name="L1103" class="line-number">1103 </a>            (?:[^'"\#].*?)|     # unquoted
<a name="L1104" class="line-number">1104 </a>            (?:)                # Empty value
<a name="L1105" class="line-number">1105 </a>        )
<a name="L1106" class="line-number">1106 </a>        \s*(\#.*)?              # optional comment
<a name="L1107" class="line-number">1107 </a>        $'''</span><span class="python-operator">,</span>
<a name="L1108" class="line-number">1108 </a>        <span class="python-name">re</span><span class="python-operator">.</span><span class="python-name">VERBOSE</span><span class="python-operator">)</span>
<a name="L1109" class="line-number">1109 </a>
<a name="L1110" class="line-number">1110 </a>    <span class="python-comment"># regexes for finding triple quoted values on one line</span>
<a name="L1111" class="line-number">1111 </a>    <span class="python-name">_single_line_single</span> <span class="python-operator">=</span> <span class="python-name">re</span><span class="python-operator">.</span><span class="python-name">compile</span><span class="python-operator">(</span><span class="python-string">r"^'''(.*?)'''\s*(#.*)?$"</span><span class="python-operator">)</span>
<a name="L1112" class="line-number">1112 </a>    <span class="python-name">_single_line_double</span> <span class="python-operator">=</span> <span class="python-name">re</span><span class="python-operator">.</span><span class="python-name">compile</span><span class="python-operator">(</span><span class="python-string">r'^"""(.*?)"""\s*(#.*)?$'</span><span class="python-operator">)</span>
<a name="L1113" class="line-number">1113 </a>    <span class="python-name">_multi_line_single</span> <span class="python-operator">=</span> <span class="python-name">re</span><span class="python-operator">.</span><span class="python-name">compile</span><span class="python-operator">(</span><span class="python-string">r"^(.*?)'''\s*(#.*)?$"</span><span class="python-operator">)</span>
<a name="L1114" class="line-number">1114 </a>    <span class="python-name">_multi_line_double</span> <span class="python-operator">=</span> <span class="python-name">re</span><span class="python-operator">.</span><span class="python-name">compile</span><span class="python-operator">(</span><span class="python-string">r'^(.*?)"""\s*(#.*)?$'</span><span class="python-operator">)</span>
<a name="L1115" class="line-number">1115 </a>
<a name="L1116" class="line-number">1116 </a>    <span class="python-name">_triple_quote</span> <span class="python-operator">=</span> <span class="python-operator">{</span>
<a name="L1117" class="line-number">1117 </a>        <span class="python-string">"'''"</span><span class="python-operator">:</span> <span class="python-operator">(</span><span class="python-name">_single_line_single</span><span class="python-operator">,</span> <span class="python-name">_multi_line_single</span><span class="python-operator">)</span><span class="python-operator">,</span>
<a name="L1118" class="line-number">1118 </a>        <span class="python-string">'"""'</span><span class="python-operator">:</span> <span class="python-operator">(</span><span class="python-name">_single_line_double</span><span class="python-operator">,</span> <span class="python-name">_multi_line_double</span><span class="python-operator">)</span><span class="python-operator">,</span>
<a name="L1119" class="line-number">1119 </a>    <span class="python-operator">}</span>
<a name="L1120" class="line-number">1120 </a>
<a name="L1121" class="line-number">1121 </a>    <span class="python-comment"># Used by the ``istrue`` Section method</span>
<a name="L1122" class="line-number">1122 </a>    <span class="python-name">_bools</span> <span class="python-operator">=</span> <span class="python-operator">{</span>
<a name="L1123" class="line-number">1123 </a>        <span class="python-string">'yes'</span><span class="python-operator">:</span> <span class="python-name">True</span><span class="python-operator">,</span> <span class="python-string">'no'</span><span class="python-operator">:</span> <span class="python-name">False</span><span class="python-operator">,</span>
<a name="L1124" class="line-number">1124 </a>        <span class="python-string">'on'</span><span class="python-operator">:</span> <span class="python-name">True</span><span class="python-operator">,</span> <span class="python-string">'off'</span><span class="python-operator">:</span> <span class="python-name">False</span><span class="python-operator">,</span>
<a name="L1125" class="line-number">1125 </a>        <span class="python-string">'1'</span><span class="python-operator">:</span> <span class="python-name">True</span><span class="python-operator">,</span> <span class="python-string">'0'</span><span class="python-operator">:</span> <span class="python-name">False</span><span class="python-operator">,</span>
<a name="L1126" class="line-number">1126 </a>        <span class="python-string">'true'</span><span class="python-operator">:</span> <span class="python-name">True</span><span class="python-operator">,</span> <span class="python-string">'false'</span><span class="python-operator">:</span> <span class="python-name">False</span><span class="python-operator">,</span>
<a name="L1127" class="line-number">1127 </a>        <span class="python-operator">}</span>
<a name="L1128" class="line-number">1128 </a>
<a name="L1129" class="line-number">1129 </a>    <span class="python-keyword">def</span> <span class="python-name">__init__</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">infile</span><span class="python-operator">=</span><span class="python-name">None</span><span class="python-operator">,</span> <span class="python-name">options</span><span class="python-operator">=</span><span class="python-name">None</span><span class="python-operator">,</span> <span class="python-operator">**</span><span class="python-name">kwargs</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1130" class="line-number">1130 </a>        <span class="python-string">"""
<a name="L1131" class="line-number">1131 </a>        Parse or create a config file object.
<a name="L1132" class="line-number">1132 </a>        
<a name="L1133" class="line-number">1133 </a>        ``ConfigObj(infile=None, options=None, **kwargs)``
<a name="L1134" class="line-number">1134 </a>        """</span>
<a name="L1135" class="line-number">1135 </a>        <span class="python-keyword">if</span> <span class="python-name">infile</span> <span class="python-keyword">is</span> <span class="python-name">None</span><span class="python-operator">:</span>
<a name="L1136" class="line-number">1136 </a>            <span class="python-name">infile</span> <span class="python-operator">=</span> <span class="python-operator">[</span><span class="python-operator">]</span>
<a name="L1137" class="line-number">1137 </a>        <span class="python-keyword">if</span> <span class="python-name">options</span> <span class="python-keyword">is</span> <span class="python-name">None</span><span class="python-operator">:</span>
<a name="L1138" class="line-number">1138 </a>            <span class="python-name">options</span> <span class="python-operator">=</span> <span class="python-operator">{</span><span class="python-operator">}</span>
<a name="L1139" class="line-number">1139 </a>        <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L1140" class="line-number">1140 </a>            <span class="python-name">options</span> <span class="python-operator">=</span> <span class="python-name">dict</span><span class="python-operator">(</span><span class="python-name">options</span><span class="python-operator">)</span>
<a name="L1141" class="line-number">1141 </a>        <span class="python-comment"># keyword arguments take precedence over an options dictionary</span>
<a name="L1142" class="line-number">1142 </a>        <span class="python-name">options</span><span class="python-operator">.</span><span class="python-name">update</span><span class="python-operator">(</span><span class="python-name">kwargs</span><span class="python-operator">)</span>
<a name="L1143" class="line-number">1143 </a>        <span class="python-comment"># init the superclass</span>
<a name="L1144" class="line-number">1144 </a>        <span class="python-name">Section</span><span class="python-operator">.</span><span class="python-name">__init__</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">self</span><span class="python-operator">,</span> <span class="python-number">0</span><span class="python-operator">,</span> <span class="python-name">self</span><span class="python-operator">)</span>
<a name="L1145" class="line-number">1145 </a>        <span class="python-comment">#</span>
<a name="L1146" class="line-number">1146 </a>        <span class="python-name">defaults</span> <span class="python-operator">=</span> <span class="python-name">OPTION_DEFAULTS</span><span class="python-operator">.</span><span class="python-name">copy</span><span class="python-operator">(</span><span class="python-operator">)</span>
<a name="L1147" class="line-number">1147 </a>        <span class="python-keyword">for</span> <span class="python-name">entry</span> <span class="python-keyword">in</span> <span class="python-name">options</span><span class="python-operator">.</span><span class="python-name">keys</span><span class="python-operator">(</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1148" class="line-number">1148 </a>            <span class="python-keyword">if</span> <span class="python-name">entry</span> <span class="python-keyword">not</span> <span class="python-keyword">in</span> <span class="python-name">defaults</span><span class="python-operator">.</span><span class="python-name">keys</span><span class="python-operator">(</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1149" class="line-number">1149 </a>                <span class="python-keyword">raise</span> <span class="python-name">TypeError</span><span class="python-operator">,</span> <span class="python-string">'Unrecognised option "%s".'</span> <span class="python-operator">%</span> <span class="python-name">entry</span>
<a name="L1150" class="line-number">1150 </a>        <span class="python-comment"># TODO: check the values too.</span>
<a name="L1151" class="line-number">1151 </a>        <span class="python-comment">#</span>
<a name="L1152" class="line-number">1152 </a>        <span class="python-comment"># Add any explicit options to the defaults</span>
<a name="L1153" class="line-number">1153 </a>        <span class="python-name">defaults</span><span class="python-operator">.</span><span class="python-name">update</span><span class="python-operator">(</span><span class="python-name">options</span><span class="python-operator">)</span>
<a name="L1154" class="line-number">1154 </a>        <span class="python-comment">#</span>
<a name="L1155" class="line-number">1155 </a>        <span class="python-comment"># initialise a few variables</span>
<a name="L1156" class="line-number">1156 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">filename</span> <span class="python-operator">=</span> <span class="python-name">None</span>
<a name="L1157" class="line-number">1157 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_errors</span> <span class="python-operator">=</span> <span class="python-operator">[</span><span class="python-operator">]</span>
<a name="L1158" class="line-number">1158 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">raise_errors</span> <span class="python-operator">=</span> <span class="python-name">defaults</span><span class="python-operator">[</span><span class="python-string">'raise_errors'</span><span class="python-operator">]</span>
<a name="L1159" class="line-number">1159 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">interpolation</span> <span class="python-operator">=</span> <span class="python-name">defaults</span><span class="python-operator">[</span><span class="python-string">'interpolation'</span><span class="python-operator">]</span>
<a name="L1160" class="line-number">1160 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">list_values</span> <span class="python-operator">=</span> <span class="python-name">defaults</span><span class="python-operator">[</span><span class="python-string">'list_values'</span><span class="python-operator">]</span>
<a name="L1161" class="line-number">1161 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">create_empty</span> <span class="python-operator">=</span> <span class="python-name">defaults</span><span class="python-operator">[</span><span class="python-string">'create_empty'</span><span class="python-operator">]</span>
<a name="L1162" class="line-number">1162 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">file_error</span> <span class="python-operator">=</span> <span class="python-name">defaults</span><span class="python-operator">[</span><span class="python-string">'file_error'</span><span class="python-operator">]</span>
<a name="L1163" class="line-number">1163 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">stringify</span> <span class="python-operator">=</span> <span class="python-name">defaults</span><span class="python-operator">[</span><span class="python-string">'stringify'</span><span class="python-operator">]</span>
<a name="L1164" class="line-number">1164 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">indent_type</span> <span class="python-operator">=</span> <span class="python-name">defaults</span><span class="python-operator">[</span><span class="python-string">'indent_type'</span><span class="python-operator">]</span>
<a name="L1165" class="line-number">1165 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">encoding</span> <span class="python-operator">=</span> <span class="python-name">defaults</span><span class="python-operator">[</span><span class="python-string">'encoding'</span><span class="python-operator">]</span>
<a name="L1166" class="line-number">1166 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">default_encoding</span> <span class="python-operator">=</span> <span class="python-name">defaults</span><span class="python-operator">[</span><span class="python-string">'default_encoding'</span><span class="python-operator">]</span>
<a name="L1167" class="line-number">1167 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">BOM</span> <span class="python-operator">=</span> <span class="python-name">False</span>
<a name="L1168" class="line-number">1168 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">newlines</span> <span class="python-operator">=</span> <span class="python-name">None</span>
<a name="L1169" class="line-number">1169 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">write_empty_values</span> <span class="python-operator">=</span> <span class="python-name">defaults</span><span class="python-operator">[</span><span class="python-string">'write_empty_values'</span><span class="python-operator">]</span>
<a name="L1170" class="line-number">1170 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">unrepr</span> <span class="python-operator">=</span> <span class="python-name">defaults</span><span class="python-operator">[</span><span class="python-string">'unrepr'</span><span class="python-operator">]</span>
<a name="L1171" class="line-number">1171 </a>        <span class="python-comment">#</span>
<a name="L1172" class="line-number">1172 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">initial_comment</span> <span class="python-operator">=</span> <span class="python-operator">[</span><span class="python-operator">]</span>
<a name="L1173" class="line-number">1173 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">final_comment</span> <span class="python-operator">=</span> <span class="python-operator">[</span><span class="python-operator">]</span>
<a name="L1174" class="line-number">1174 </a>        <span class="python-comment">#</span>
<a name="L1175" class="line-number">1175 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_terminated</span> <span class="python-operator">=</span> <span class="python-name">False</span>
<a name="L1176" class="line-number">1176 </a>        <span class="python-comment">#</span>
<a name="L1177" class="line-number">1177 </a>        <span class="python-keyword">if</span> <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">infile</span><span class="python-operator">,</span> <span class="python-name">StringTypes</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1178" class="line-number">1178 </a>            <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">filename</span> <span class="python-operator">=</span> <span class="python-name">infile</span>
<a name="L1179" class="line-number">1179 </a>            <span class="python-keyword">if</span> <span class="python-name">os</span><span class="python-operator">.</span><span class="python-name">path</span><span class="python-operator">.</span><span class="python-name">isfile</span><span class="python-operator">(</span><span class="python-name">infile</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1180" class="line-number">1180 </a>                <span class="python-name">infile</span> <span class="python-operator">=</span> <span class="python-name">open</span><span class="python-operator">(</span><span class="python-name">infile</span><span class="python-operator">)</span><span class="python-operator">.</span><span class="python-name">read</span><span class="python-operator">(</span><span class="python-operator">)</span> <span class="python-keyword">or</span> <span class="python-operator">[</span><span class="python-operator">]</span>
<a name="L1181" class="line-number">1181 </a>            <span class="python-keyword">elif</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">file_error</span><span class="python-operator">:</span>
<a name="L1182" class="line-number">1182 </a>                <span class="python-comment"># raise an error if the file doesn't exist</span>
<a name="L1183" class="line-number">1183 </a>                <span class="python-keyword">raise</span> <span class="python-name">IOError</span><span class="python-operator">,</span> <span class="python-string">'Config file not found: "%s".'</span> <span class="python-operator">%</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">filename</span>
<a name="L1184" class="line-number">1184 </a>            <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L1185" class="line-number">1185 </a>                <span class="python-comment"># file doesn't already exist</span>
<a name="L1186" class="line-number">1186 </a>                <span class="python-keyword">if</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">create_empty</span><span class="python-operator">:</span>
<a name="L1187" class="line-number">1187 </a>                    <span class="python-comment"># this is a good test that the filename specified</span>
<a name="L1188" class="line-number">1188 </a>                    <span class="python-comment"># isn't impossible - like on a non existent device</span>
<a name="L1189" class="line-number">1189 </a>                    <span class="python-name">h</span> <span class="python-operator">=</span> <span class="python-name">open</span><span class="python-operator">(</span><span class="python-name">infile</span><span class="python-operator">,</span> <span class="python-string">'w'</span><span class="python-operator">)</span>
<a name="L1190" class="line-number">1190 </a>                    <span class="python-name">h</span><span class="python-operator">.</span><span class="python-name">write</span><span class="python-operator">(</span><span class="python-string">''</span><span class="python-operator">)</span>
<a name="L1191" class="line-number">1191 </a>                    <span class="python-name">h</span><span class="python-operator">.</span><span class="python-name">close</span><span class="python-operator">(</span><span class="python-operator">)</span>
<a name="L1192" class="line-number">1192 </a>                <span class="python-name">infile</span> <span class="python-operator">=</span> <span class="python-operator">[</span><span class="python-operator">]</span>
<a name="L1193" class="line-number">1193 </a>        <span class="python-keyword">elif</span> <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">infile</span><span class="python-operator">,</span> <span class="python-operator">(</span><span class="python-name">list</span><span class="python-operator">,</span> <span class="python-name">tuple</span><span class="python-operator">)</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1194" class="line-number">1194 </a>            <span class="python-name">infile</span> <span class="python-operator">=</span> <span class="python-name">list</span><span class="python-operator">(</span><span class="python-name">infile</span><span class="python-operator">)</span>
<a name="L1195" class="line-number">1195 </a>        <span class="python-keyword">elif</span> <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">infile</span><span class="python-operator">,</span> <span class="python-name">dict</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1196" class="line-number">1196 </a>            <span class="python-comment"># initialise self</span>
<a name="L1197" class="line-number">1197 </a>            <span class="python-comment"># the Section class handles creating subsections</span>
<a name="L1198" class="line-number">1198 </a>            <span class="python-keyword">if</span> <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">infile</span><span class="python-operator">,</span> <span class="python-name">ConfigObj</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1199" class="line-number">1199 </a>                <span class="python-comment"># get a copy of our ConfigObj</span>
<a name="L1200" class="line-number">1200 </a>                <span class="python-name">infile</span> <span class="python-operator">=</span> <span class="python-name">infile</span><span class="python-operator">.</span><span class="python-name">dict</span><span class="python-operator">(</span><span class="python-operator">)</span>
<a name="L1201" class="line-number">1201 </a>            <span class="python-keyword">for</span> <span class="python-name">entry</span> <span class="python-keyword">in</span> <span class="python-name">infile</span><span class="python-operator">:</span>
<a name="L1202" class="line-number">1202 </a>                <span class="python-name">self</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-name">infile</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span>
<a name="L1203" class="line-number">1203 </a>            <span class="python-keyword">del</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_errors</span>
<a name="L1204" class="line-number">1204 </a>            <span class="python-keyword">if</span> <span class="python-name">defaults</span><span class="python-operator">[</span><span class="python-string">'configspec'</span><span class="python-operator">]</span> <span class="python-keyword">is</span> <span class="python-keyword">not</span> <span class="python-name">None</span><span class="python-operator">:</span>
<a name="L1205" class="line-number">1205 </a>                <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_handle_configspec</span><span class="python-operator">(</span><span class="python-name">defaults</span><span class="python-operator">[</span><span class="python-string">'configspec'</span><span class="python-operator">]</span><span class="python-operator">)</span>
<a name="L1206" class="line-number">1206 </a>            <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L1207" class="line-number">1207 </a>                <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">configspec</span> <span class="python-operator">=</span> <span class="python-name">None</span>
<a name="L1208" class="line-number">1208 </a>            <span class="python-keyword">return</span>
<a name="L1209" class="line-number">1209 </a>        <span class="python-keyword">elif</span> <span class="python-name">hasattr</span><span class="python-operator">(</span><span class="python-name">infile</span><span class="python-operator">,</span> <span class="python-string">'read'</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1210" class="line-number">1210 </a>            <span class="python-comment"># This supports file like objects</span>
<a name="L1211" class="line-number">1211 </a>            <span class="python-name">infile</span> <span class="python-operator">=</span> <span class="python-name">infile</span><span class="python-operator">.</span><span class="python-name">read</span><span class="python-operator">(</span><span class="python-operator">)</span> <span class="python-keyword">or</span> <span class="python-operator">[</span><span class="python-operator">]</span>
<a name="L1212" class="line-number">1212 </a>            <span class="python-comment"># needs splitting into lines - but needs doing *after* decoding</span>
<a name="L1213" class="line-number">1213 </a>            <span class="python-comment"># in case it's not an 8 bit encoding</span>
<a name="L1214" class="line-number">1214 </a>        <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L1215" class="line-number">1215 </a>            <span class="python-keyword">raise</span> <span class="python-name">TypeError</span><span class="python-operator">,</span> <span class="python-operator">(</span><span class="python-string">'infile must be a filename,'</span>
<a name="L1216" class="line-number">1216 </a>                <span class="python-string">' file like object, or list of lines.'</span><span class="python-operator">)</span>
<a name="L1217" class="line-number">1217 </a>        <span class="python-comment">#</span>
<a name="L1218" class="line-number">1218 </a>        <span class="python-keyword">if</span> <span class="python-name">infile</span><span class="python-operator">:</span>
<a name="L1219" class="line-number">1219 </a>            <span class="python-comment"># don't do it for the empty ConfigObj</span>
<a name="L1220" class="line-number">1220 </a>            <span class="python-name">infile</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_handle_bom</span><span class="python-operator">(</span><span class="python-name">infile</span><span class="python-operator">)</span>
<a name="L1221" class="line-number">1221 </a>            <span class="python-comment"># infile is now *always* a list</span>
<a name="L1222" class="line-number">1222 </a>            <span class="python-comment">#</span>
<a name="L1223" class="line-number">1223 </a>            <span class="python-comment"># Set the newlines attribute (first line ending it finds)</span>
<a name="L1224" class="line-number">1224 </a>            <span class="python-comment"># and strip trailing '\n' or '\r' from lines</span>
<a name="L1225" class="line-number">1225 </a>            <span class="python-keyword">for</span> <span class="python-name">line</span> <span class="python-keyword">in</span> <span class="python-name">infile</span><span class="python-operator">:</span>
<a name="L1226" class="line-number">1226 </a>                <span class="python-keyword">if</span> <span class="python-operator">(</span><span class="python-keyword">not</span> <span class="python-name">line</span><span class="python-operator">)</span> <span class="python-keyword">or</span> <span class="python-operator">(</span><span class="python-name">line</span><span class="python-operator">[</span><span class="python-operator">-</span><span class="python-number">1</span><span class="python-operator">]</span> <span class="python-keyword">not</span> <span class="python-keyword">in</span> <span class="python-operator">(</span><span class="python-string">'\r'</span><span class="python-operator">,</span> <span class="python-string">'\n'</span><span class="python-operator">,</span> <span class="python-string">'\r\n'</span><span class="python-operator">)</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1227" class="line-number">1227 </a>                    <span class="python-keyword">continue</span>
<a name="L1228" class="line-number">1228 </a>                <span class="python-keyword">for</span> <span class="python-name">end</span> <span class="python-keyword">in</span> <span class="python-operator">(</span><span class="python-string">'\r\n'</span><span class="python-operator">,</span> <span class="python-string">'\n'</span><span class="python-operator">,</span> <span class="python-string">'\r'</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1229" class="line-number">1229 </a>                    <span class="python-keyword">if</span> <span class="python-name">line</span><span class="python-operator">.</span><span class="python-name">endswith</span><span class="python-operator">(</span><span class="python-name">end</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1230" class="line-number">1230 </a>                        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">newlines</span> <span class="python-operator">=</span> <span class="python-name">end</span>
<a name="L1231" class="line-number">1231 </a>                        <span class="python-keyword">break</span>
<a name="L1232" class="line-number">1232 </a>                <span class="python-keyword">break</span>
<a name="L1233" class="line-number">1233 </a>            <span class="python-keyword">if</span> <span class="python-name">infile</span><span class="python-operator">[</span><span class="python-operator">-</span><span class="python-number">1</span><span class="python-operator">]</span> <span class="python-keyword">and</span> <span class="python-name">infile</span><span class="python-operator">[</span><span class="python-operator">-</span><span class="python-number">1</span><span class="python-operator">]</span> <span class="python-keyword">in</span> <span class="python-operator">(</span><span class="python-string">'\r'</span><span class="python-operator">,</span> <span class="python-string">'\n'</span><span class="python-operator">,</span> <span class="python-string">'\r\n'</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1234" class="line-number">1234 </a>                <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_terminated</span> <span class="python-operator">=</span> <span class="python-name">True</span>
<a name="L1235" class="line-number">1235 </a>            <span class="python-name">infile</span> <span class="python-operator">=</span> <span class="python-operator">[</span><span class="python-name">line</span><span class="python-operator">.</span><span class="python-name">rstrip</span><span class="python-operator">(</span><span class="python-string">'\r\n'</span><span class="python-operator">)</span> <span class="python-keyword">for</span> <span class="python-name">line</span> <span class="python-keyword">in</span> <span class="python-name">infile</span><span class="python-operator">]</span>
<a name="L1236" class="line-number">1236 </a>        <span class="python-comment">#</span>
<a name="L1237" class="line-number">1237 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_parse</span><span class="python-operator">(</span><span class="python-name">infile</span><span class="python-operator">)</span>
<a name="L1238" class="line-number">1238 </a>        <span class="python-comment"># if we had any errors, now is the time to raise them</span>
<a name="L1239" class="line-number">1239 </a>        <span class="python-keyword">if</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_errors</span><span class="python-operator">:</span>
<a name="L1240" class="line-number">1240 </a>            <span class="python-name">info</span> <span class="python-operator">=</span> <span class="python-string">"at line %s."</span> <span class="python-operator">%</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_errors</span><span class="python-operator">[</span><span class="python-number">0</span><span class="python-operator">]</span><span class="python-operator">.</span><span class="python-name">line_number</span>
<a name="L1241" class="line-number">1241 </a>            <span class="python-keyword">if</span> <span class="python-name">len</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_errors</span><span class="python-operator">)</span> <span class="python-operator">&gt;</span> <span class="python-number">1</span><span class="python-operator">:</span>
<a name="L1242" class="line-number">1242 </a>                <span class="python-name">msg</span> <span class="python-operator">=</span> <span class="python-operator">(</span><span class="python-string">"Parsing failed with several errors.\nFirst error %s"</span> <span class="python-operator">%</span>
<a name="L1243" class="line-number">1243 </a>                    <span class="python-name">info</span><span class="python-operator">)</span>
<a name="L1244" class="line-number">1244 </a>                <span class="python-name">error</span> <span class="python-operator">=</span> <span class="python-name">ConfigObjError</span><span class="python-operator">(</span><span class="python-name">msg</span><span class="python-operator">)</span>
<a name="L1245" class="line-number">1245 </a>            <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L1246" class="line-number">1246 </a>                <span class="python-name">error</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_errors</span><span class="python-operator">[</span><span class="python-number">0</span><span class="python-operator">]</span>
<a name="L1247" class="line-number">1247 </a>            <span class="python-comment"># set the errors attribute; it's a list of tuples:</span>
<a name="L1248" class="line-number">1248 </a>            <span class="python-comment"># (error_type, message, line_number)</span>
<a name="L1249" class="line-number">1249 </a>            <span class="python-name">error</span><span class="python-operator">.</span><span class="python-name">errors</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_errors</span>
<a name="L1250" class="line-number">1250 </a>            <span class="python-comment"># set the config attribute</span>
<a name="L1251" class="line-number">1251 </a>            <span class="python-name">error</span><span class="python-operator">.</span><span class="python-name">config</span> <span class="python-operator">=</span> <span class="python-name">self</span>
<a name="L1252" class="line-number">1252 </a>            <span class="python-keyword">raise</span> <span class="python-name">error</span>
<a name="L1253" class="line-number">1253 </a>        <span class="python-comment"># delete private attributes</span>
<a name="L1254" class="line-number">1254 </a>        <span class="python-keyword">del</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_errors</span>
<a name="L1255" class="line-number">1255 </a>        <span class="python-comment">#</span>
<a name="L1256" class="line-number">1256 </a>        <span class="python-keyword">if</span> <span class="python-name">defaults</span><span class="python-operator">[</span><span class="python-string">'configspec'</span><span class="python-operator">]</span> <span class="python-keyword">is</span> <span class="python-name">None</span><span class="python-operator">:</span>
<a name="L1257" class="line-number">1257 </a>            <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">configspec</span> <span class="python-operator">=</span> <span class="python-name">None</span>
<a name="L1258" class="line-number">1258 </a>        <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L1259" class="line-number">1259 </a>            <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_handle_configspec</span><span class="python-operator">(</span><span class="python-name">defaults</span><span class="python-operator">[</span><span class="python-string">'configspec'</span><span class="python-operator">]</span><span class="python-operator">)</span>
<a name="L1260" class="line-number">1260 </a>
<a name="L1261" class="line-number">1261 </a>    <span class="python-keyword">def</span> <span class="python-name">__repr__</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1262" class="line-number">1262 </a>        <span class="python-keyword">return</span> <span class="python-string">'ConfigObj({%s})'</span> <span class="python-operator">%</span> <span class="python-string">', '</span><span class="python-operator">.</span><span class="python-name">join</span><span class="python-operator">(</span>
<a name="L1263" class="line-number">1263 </a>            <span class="python-operator">[</span><span class="python-operator">(</span><span class="python-string">'%s: %s'</span> <span class="python-operator">%</span> <span class="python-operator">(</span><span class="python-name">repr</span><span class="python-operator">(</span><span class="python-name">key</span><span class="python-operator">)</span><span class="python-operator">,</span> <span class="python-name">repr</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">[</span><span class="python-name">key</span><span class="python-operator">]</span><span class="python-operator">)</span><span class="python-operator">)</span><span class="python-operator">)</span> <span class="python-keyword">for</span> <span class="python-name">key</span> <span class="python-keyword">in</span>
<a name="L1264" class="line-number">1264 </a>            <span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">scalars</span> <span class="python-operator">+</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">sections</span><span class="python-operator">)</span><span class="python-operator">]</span><span class="python-operator">)</span>
<a name="L1265" class="line-number">1265 </a>
<a name="L1266" class="line-number">1266 </a>    <span class="python-keyword">def</span> <span class="python-name">_handle_bom</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">infile</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1267" class="line-number">1267 </a>        <span class="python-string">"""
<a name="L1268" class="line-number">1268 </a>        Handle any BOM, and decode if necessary.
<a name="L1269" class="line-number">1269 </a>        
<a name="L1270" class="line-number">1270 </a>        If an encoding is specified, that *must* be used - but the BOM should
<a name="L1271" class="line-number">1271 </a>        still be removed (and the BOM attribute set).
<a name="L1272" class="line-number">1272 </a>        
<a name="L1273" class="line-number">1273 </a>        (If the encoding is wrongly specified, then a BOM for an alternative
<a name="L1274" class="line-number">1274 </a>        encoding won't be discovered or removed.)
<a name="L1275" class="line-number">1275 </a>        
<a name="L1276" class="line-number">1276 </a>        If an encoding is not specified, UTF8 or UTF16 BOM will be detected and
<a name="L1277" class="line-number">1277 </a>        removed. The BOM attribute will be set. UTF16 will be decoded to
<a name="L1278" class="line-number">1278 </a>        unicode.
<a name="L1279" class="line-number">1279 </a>        
<a name="L1280" class="line-number">1280 </a>        NOTE: This method must not be called with an empty ``infile``.
<a name="L1281" class="line-number">1281 </a>        
<a name="L1282" class="line-number">1282 </a>        Specifying the *wrong* encoding is likely to cause a
<a name="L1283" class="line-number">1283 </a>        ``UnicodeDecodeError``.
<a name="L1284" class="line-number">1284 </a>        
<a name="L1285" class="line-number">1285 </a>        ``infile`` must always be returned as a list of lines, but may be
<a name="L1286" class="line-number">1286 </a>        passed in as a single string.
<a name="L1287" class="line-number">1287 </a>        """</span>
<a name="L1288" class="line-number">1288 </a>        <span class="python-keyword">if</span> <span class="python-operator">(</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">encoding</span> <span class="python-keyword">is</span> <span class="python-keyword">not</span> <span class="python-name">None</span><span class="python-operator">)</span> <span class="python-keyword">and</span>
<a name="L1289" class="line-number">1289 </a>            <span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">encoding</span><span class="python-operator">.</span><span class="python-name">lower</span><span class="python-operator">(</span><span class="python-operator">)</span> <span class="python-keyword">not</span> <span class="python-keyword">in</span> <span class="python-name">BOM_LIST</span><span class="python-operator">)</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1290" class="line-number">1290 </a>            <span class="python-comment"># No need to check for a BOM</span>
<a name="L1291" class="line-number">1291 </a>            <span class="python-comment"># the encoding specified doesn't have one</span>
<a name="L1292" class="line-number">1292 </a>            <span class="python-comment"># just decode</span>
<a name="L1293" class="line-number">1293 </a>            <span class="python-keyword">return</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_decode</span><span class="python-operator">(</span><span class="python-name">infile</span><span class="python-operator">,</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">encoding</span><span class="python-operator">)</span>
<a name="L1294" class="line-number">1294 </a>        <span class="python-comment">#</span>
<a name="L1295" class="line-number">1295 </a>        <span class="python-keyword">if</span> <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">infile</span><span class="python-operator">,</span> <span class="python-operator">(</span><span class="python-name">list</span><span class="python-operator">,</span> <span class="python-name">tuple</span><span class="python-operator">)</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1296" class="line-number">1296 </a>            <span class="python-name">line</span> <span class="python-operator">=</span> <span class="python-name">infile</span><span class="python-operator">[</span><span class="python-number">0</span><span class="python-operator">]</span>
<a name="L1297" class="line-number">1297 </a>        <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L1298" class="line-number">1298 </a>            <span class="python-name">line</span> <span class="python-operator">=</span> <span class="python-name">infile</span>
<a name="L1299" class="line-number">1299 </a>        <span class="python-keyword">if</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">encoding</span> <span class="python-keyword">is</span> <span class="python-keyword">not</span> <span class="python-name">None</span><span class="python-operator">:</span>
<a name="L1300" class="line-number">1300 </a>            <span class="python-comment"># encoding explicitly supplied</span>
<a name="L1301" class="line-number">1301 </a>            <span class="python-comment"># And it could have an associated BOM</span>
<a name="L1302" class="line-number">1302 </a>            <span class="python-comment"># TODO: if encoding is just UTF16 - we ought to check for both</span>
<a name="L1303" class="line-number">1303 </a>            <span class="python-comment"># TODO: big endian and little endian versions.</span>
<a name="L1304" class="line-number">1304 </a>            <span class="python-name">enc</span> <span class="python-operator">=</span> <span class="python-name">BOM_LIST</span><span class="python-operator">[</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">encoding</span><span class="python-operator">.</span><span class="python-name">lower</span><span class="python-operator">(</span><span class="python-operator">)</span><span class="python-operator">]</span>
<a name="L1305" class="line-number">1305 </a>            <span class="python-keyword">if</span> <span class="python-name">enc</span> <span class="python-operator">==</span> <span class="python-string">'utf_16'</span><span class="python-operator">:</span>
<a name="L1306" class="line-number">1306 </a>                <span class="python-comment"># For UTF16 we try big endian and little endian</span>
<a name="L1307" class="line-number">1307 </a>                <span class="python-keyword">for</span> <span class="python-name">BOM</span><span class="python-operator">,</span> <span class="python-operator">(</span><span class="python-name">encoding</span><span class="python-operator">,</span> <span class="python-name">final_encoding</span><span class="python-operator">)</span> <span class="python-keyword">in</span> <span class="python-name">BOMS</span><span class="python-operator">.</span><span class="python-name">items</span><span class="python-operator">(</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1308" class="line-number">1308 </a>                    <span class="python-keyword">if</span> <span class="python-keyword">not</span> <span class="python-name">final_encoding</span><span class="python-operator">:</span>
<a name="L1309" class="line-number">1309 </a>                        <span class="python-comment"># skip UTF8</span>
<a name="L1310" class="line-number">1310 </a>                        <span class="python-keyword">continue</span>
<a name="L1311" class="line-number">1311 </a>                    <span class="python-keyword">if</span> <span class="python-name">infile</span><span class="python-operator">.</span><span class="python-name">startswith</span><span class="python-operator">(</span><span class="python-name">BOM</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1312" class="line-number">1312 </a>                        <span class="python-comment">### BOM discovered</span>
<a name="L1313" class="line-number">1313 </a>                        <span class="python-comment">##self.BOM = True</span>
<a name="L1314" class="line-number">1314 </a>                        <span class="python-comment"># Don't need to remove BOM</span>
<a name="L1315" class="line-number">1315 </a>                        <span class="python-keyword">return</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_decode</span><span class="python-operator">(</span><span class="python-name">infile</span><span class="python-operator">,</span> <span class="python-name">encoding</span><span class="python-operator">)</span>
<a name="L1316" class="line-number">1316 </a>                <span class="python-comment">#</span>
<a name="L1317" class="line-number">1317 </a>                <span class="python-comment"># If we get this far, will *probably* raise a DecodeError</span>
<a name="L1318" class="line-number">1318 </a>                <span class="python-comment"># As it doesn't appear to start with a BOM</span>
<a name="L1319" class="line-number">1319 </a>                <span class="python-keyword">return</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_decode</span><span class="python-operator">(</span><span class="python-name">infile</span><span class="python-operator">,</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">encoding</span><span class="python-operator">)</span>
<a name="L1320" class="line-number">1320 </a>            <span class="python-comment">#</span>
<a name="L1321" class="line-number">1321 </a>            <span class="python-comment"># Must be UTF8</span>
<a name="L1322" class="line-number">1322 </a>            <span class="python-name">BOM</span> <span class="python-operator">=</span> <span class="python-name">BOM_SET</span><span class="python-operator">[</span><span class="python-name">enc</span><span class="python-operator">]</span>
<a name="L1323" class="line-number">1323 </a>            <span class="python-keyword">if</span> <span class="python-keyword">not</span> <span class="python-name">line</span><span class="python-operator">.</span><span class="python-name">startswith</span><span class="python-operator">(</span><span class="python-name">BOM</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1324" class="line-number">1324 </a>                <span class="python-keyword">return</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_decode</span><span class="python-operator">(</span><span class="python-name">infile</span><span class="python-operator">,</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">encoding</span><span class="python-operator">)</span>
<a name="L1325" class="line-number">1325 </a>            <span class="python-comment">#</span>
<a name="L1326" class="line-number">1326 </a>            <span class="python-name">newline</span> <span class="python-operator">=</span> <span class="python-name">line</span><span class="python-operator">[</span><span class="python-name">len</span><span class="python-operator">(</span><span class="python-name">BOM</span><span class="python-operator">)</span><span class="python-operator">:</span><span class="python-operator">]</span>
<a name="L1327" class="line-number">1327 </a>            <span class="python-comment">#</span>
<a name="L1328" class="line-number">1328 </a>            <span class="python-comment"># BOM removed</span>
<a name="L1329" class="line-number">1329 </a>            <span class="python-keyword">if</span> <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">infile</span><span class="python-operator">,</span> <span class="python-operator">(</span><span class="python-name">list</span><span class="python-operator">,</span> <span class="python-name">tuple</span><span class="python-operator">)</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1330" class="line-number">1330 </a>                <span class="python-name">infile</span><span class="python-operator">[</span><span class="python-number">0</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-name">newline</span>
<a name="L1331" class="line-number">1331 </a>            <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L1332" class="line-number">1332 </a>                <span class="python-name">infile</span> <span class="python-operator">=</span> <span class="python-name">newline</span>
<a name="L1333" class="line-number">1333 </a>            <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">BOM</span> <span class="python-operator">=</span> <span class="python-name">True</span>
<a name="L1334" class="line-number">1334 </a>            <span class="python-keyword">return</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_decode</span><span class="python-operator">(</span><span class="python-name">infile</span><span class="python-operator">,</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">encoding</span><span class="python-operator">)</span>
<a name="L1335" class="line-number">1335 </a>        <span class="python-comment">#</span>
<a name="L1336" class="line-number">1336 </a>        <span class="python-comment"># No encoding specified - so we need to check for UTF8/UTF16</span>
<a name="L1337" class="line-number">1337 </a>        <span class="python-keyword">for</span> <span class="python-name">BOM</span><span class="python-operator">,</span> <span class="python-operator">(</span><span class="python-name">encoding</span><span class="python-operator">,</span> <span class="python-name">final_encoding</span><span class="python-operator">)</span> <span class="python-keyword">in</span> <span class="python-name">BOMS</span><span class="python-operator">.</span><span class="python-name">items</span><span class="python-operator">(</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1338" class="line-number">1338 </a>            <span class="python-keyword">if</span> <span class="python-keyword">not</span> <span class="python-name">line</span><span class="python-operator">.</span><span class="python-name">startswith</span><span class="python-operator">(</span><span class="python-name">BOM</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1339" class="line-number">1339 </a>                <span class="python-keyword">continue</span>
<a name="L1340" class="line-number">1340 </a>            <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L1341" class="line-number">1341 </a>                <span class="python-comment"># BOM discovered</span>
<a name="L1342" class="line-number">1342 </a>                <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">encoding</span> <span class="python-operator">=</span> <span class="python-name">final_encoding</span>
<a name="L1343" class="line-number">1343 </a>                <span class="python-keyword">if</span> <span class="python-keyword">not</span> <span class="python-name">final_encoding</span><span class="python-operator">:</span>
<a name="L1344" class="line-number">1344 </a>                    <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">BOM</span> <span class="python-operator">=</span> <span class="python-name">True</span>
<a name="L1345" class="line-number">1345 </a>                    <span class="python-comment"># UTF8</span>
<a name="L1346" class="line-number">1346 </a>                    <span class="python-comment"># remove BOM</span>
<a name="L1347" class="line-number">1347 </a>                    <span class="python-name">newline</span> <span class="python-operator">=</span> <span class="python-name">line</span><span class="python-operator">[</span><span class="python-name">len</span><span class="python-operator">(</span><span class="python-name">BOM</span><span class="python-operator">)</span><span class="python-operator">:</span><span class="python-operator">]</span>
<a name="L1348" class="line-number">1348 </a>                    <span class="python-keyword">if</span> <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">infile</span><span class="python-operator">,</span> <span class="python-operator">(</span><span class="python-name">list</span><span class="python-operator">,</span> <span class="python-name">tuple</span><span class="python-operator">)</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1349" class="line-number">1349 </a>                        <span class="python-name">infile</span><span class="python-operator">[</span><span class="python-number">0</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-name">newline</span>
<a name="L1350" class="line-number">1350 </a>                    <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L1351" class="line-number">1351 </a>                        <span class="python-name">infile</span> <span class="python-operator">=</span> <span class="python-name">newline</span>
<a name="L1352" class="line-number">1352 </a>                    <span class="python-comment"># UTF8 - don't decode</span>
<a name="L1353" class="line-number">1353 </a>                    <span class="python-keyword">if</span> <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">infile</span><span class="python-operator">,</span> <span class="python-name">StringTypes</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1354" class="line-number">1354 </a>                        <span class="python-keyword">return</span> <span class="python-name">infile</span><span class="python-operator">.</span><span class="python-name">splitlines</span><span class="python-operator">(</span><span class="python-name">True</span><span class="python-operator">)</span>
<a name="L1355" class="line-number">1355 </a>                    <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L1356" class="line-number">1356 </a>                        <span class="python-keyword">return</span> <span class="python-name">infile</span>
<a name="L1357" class="line-number">1357 </a>                <span class="python-comment"># UTF16 - have to decode</span>
<a name="L1358" class="line-number">1358 </a>                <span class="python-keyword">return</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_decode</span><span class="python-operator">(</span><span class="python-name">infile</span><span class="python-operator">,</span> <span class="python-name">encoding</span><span class="python-operator">)</span>
<a name="L1359" class="line-number">1359 </a>        <span class="python-comment">#</span>
<a name="L1360" class="line-number">1360 </a>        <span class="python-comment"># No BOM discovered and no encoding specified, just return</span>
<a name="L1361" class="line-number">1361 </a>        <span class="python-keyword">if</span> <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">infile</span><span class="python-operator">,</span> <span class="python-name">StringTypes</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1362" class="line-number">1362 </a>            <span class="python-comment"># infile read from a file will be a single string</span>
<a name="L1363" class="line-number">1363 </a>            <span class="python-keyword">return</span> <span class="python-name">infile</span><span class="python-operator">.</span><span class="python-name">splitlines</span><span class="python-operator">(</span><span class="python-name">True</span><span class="python-operator">)</span>
<a name="L1364" class="line-number">1364 </a>        <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L1365" class="line-number">1365 </a>            <span class="python-keyword">return</span> <span class="python-name">infile</span>
<a name="L1366" class="line-number">1366 </a>
<a name="L1367" class="line-number">1367 </a>    <span class="python-keyword">def</span> <span class="python-name">_a_to_u</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">aString</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1368" class="line-number">1368 </a>        <span class="python-string">"""Decode ASCII strings to unicode if a self.encoding is specified."""</span>
<a name="L1369" class="line-number">1369 </a>        <span class="python-keyword">if</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">encoding</span><span class="python-operator">:</span>
<a name="L1370" class="line-number">1370 </a>            <span class="python-keyword">return</span> <span class="python-name">aString</span><span class="python-operator">.</span><span class="python-name">decode</span><span class="python-operator">(</span><span class="python-string">'ascii'</span><span class="python-operator">)</span>
<a name="L1371" class="line-number">1371 </a>        <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L1372" class="line-number">1372 </a>            <span class="python-keyword">return</span> <span class="python-name">aString</span>
<a name="L1373" class="line-number">1373 </a>
<a name="L1374" class="line-number">1374 </a>    <span class="python-keyword">def</span> <span class="python-name">_decode</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">infile</span><span class="python-operator">,</span> <span class="python-name">encoding</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1375" class="line-number">1375 </a>        <span class="python-string">"""
<a name="L1376" class="line-number">1376 </a>        Decode infile to unicode. Using the specified encoding.
<a name="L1377" class="line-number">1377 </a>        
<a name="L1378" class="line-number">1378 </a>        if is a string, it also needs converting to a list.
<a name="L1379" class="line-number">1379 </a>        """</span>
<a name="L1380" class="line-number">1380 </a>        <span class="python-keyword">if</span> <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">infile</span><span class="python-operator">,</span> <span class="python-name">StringTypes</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1381" class="line-number">1381 </a>            <span class="python-comment"># can't be unicode</span>
<a name="L1382" class="line-number">1382 </a>            <span class="python-comment"># NOTE: Could raise a ``UnicodeDecodeError``</span>
<a name="L1383" class="line-number">1383 </a>            <span class="python-keyword">return</span> <span class="python-name">infile</span><span class="python-operator">.</span><span class="python-name">decode</span><span class="python-operator">(</span><span class="python-name">encoding</span><span class="python-operator">)</span><span class="python-operator">.</span><span class="python-name">splitlines</span><span class="python-operator">(</span><span class="python-name">True</span><span class="python-operator">)</span>
<a name="L1384" class="line-number">1384 </a>        <span class="python-keyword">for</span> <span class="python-name">i</span><span class="python-operator">,</span> <span class="python-name">line</span> <span class="python-keyword">in</span> <span class="python-name">enumerate</span><span class="python-operator">(</span><span class="python-name">infile</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1385" class="line-number">1385 </a>            <span class="python-keyword">if</span> <span class="python-keyword">not</span> <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">line</span><span class="python-operator">,</span> <span class="python-name">unicode</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1386" class="line-number">1386 </a>                <span class="python-comment"># NOTE: The isinstance test here handles mixed lists of unicode/string</span>
<a name="L1387" class="line-number">1387 </a>                <span class="python-comment"># NOTE: But the decode will break on any non-string values</span>
<a name="L1388" class="line-number">1388 </a>                <span class="python-comment"># NOTE: Or could raise a ``UnicodeDecodeError``</span>
<a name="L1389" class="line-number">1389 </a>                <span class="python-name">infile</span><span class="python-operator">[</span><span class="python-name">i</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-name">line</span><span class="python-operator">.</span><span class="python-name">decode</span><span class="python-operator">(</span><span class="python-name">encoding</span><span class="python-operator">)</span>
<a name="L1390" class="line-number">1390 </a>        <span class="python-keyword">return</span> <span class="python-name">infile</span>
<a name="L1391" class="line-number">1391 </a>
<a name="L1392" class="line-number">1392 </a>    <span class="python-keyword">def</span> <span class="python-name">_decode_element</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">line</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1393" class="line-number">1393 </a>        <span class="python-string">"""Decode element to unicode if necessary."""</span>
<a name="L1394" class="line-number">1394 </a>        <span class="python-keyword">if</span> <span class="python-keyword">not</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">encoding</span><span class="python-operator">:</span>
<a name="L1395" class="line-number">1395 </a>            <span class="python-keyword">return</span> <span class="python-name">line</span>
<a name="L1396" class="line-number">1396 </a>        <span class="python-keyword">if</span> <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">line</span><span class="python-operator">,</span> <span class="python-name">str</span><span class="python-operator">)</span> <span class="python-keyword">and</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">default_encoding</span><span class="python-operator">:</span>
<a name="L1397" class="line-number">1397 </a>            <span class="python-keyword">return</span> <span class="python-name">line</span><span class="python-operator">.</span><span class="python-name">decode</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">default_encoding</span><span class="python-operator">)</span>
<a name="L1398" class="line-number">1398 </a>        <span class="python-keyword">return</span> <span class="python-name">line</span>
<a name="L1399" class="line-number">1399 </a>
<a name="L1400" class="line-number">1400 </a>    <span class="python-keyword">def</span> <span class="python-name">_str</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">value</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1401" class="line-number">1401 </a>        <span class="python-string">"""
<a name="L1402" class="line-number">1402 </a>        Used by ``stringify`` within validate, to turn non-string values
<a name="L1403" class="line-number">1403 </a>        into strings.
<a name="L1404" class="line-number">1404 </a>        """</span>
<a name="L1405" class="line-number">1405 </a>        <span class="python-keyword">if</span> <span class="python-keyword">not</span> <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">value</span><span class="python-operator">,</span> <span class="python-name">StringTypes</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1406" class="line-number">1406 </a>            <span class="python-keyword">return</span> <span class="python-name">str</span><span class="python-operator">(</span><span class="python-name">value</span><span class="python-operator">)</span>
<a name="L1407" class="line-number">1407 </a>        <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L1408" class="line-number">1408 </a>            <span class="python-keyword">return</span> <span class="python-name">value</span>
<a name="L1409" class="line-number">1409 </a>
<a name="L1410" class="line-number">1410 </a>    <span class="python-keyword">def</span> <span class="python-name">_parse</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">infile</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1411" class="line-number">1411 </a>        <span class="python-string">"""Actually parse the config file."""</span>
<a name="L1412" class="line-number">1412 </a>        <span class="python-name">temp_list_values</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">list_values</span>
<a name="L1413" class="line-number">1413 </a>        <span class="python-keyword">if</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">unrepr</span><span class="python-operator">:</span>
<a name="L1414" class="line-number">1414 </a>            <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">list_values</span> <span class="python-operator">=</span> <span class="python-name">False</span>
<a name="L1415" class="line-number">1415 </a>        <span class="python-name">comment_list</span> <span class="python-operator">=</span> <span class="python-operator">[</span><span class="python-operator">]</span>
<a name="L1416" class="line-number">1416 </a>        <span class="python-name">done_start</span> <span class="python-operator">=</span> <span class="python-name">False</span>
<a name="L1417" class="line-number">1417 </a>        <span class="python-name">this_section</span> <span class="python-operator">=</span> <span class="python-name">self</span>
<a name="L1418" class="line-number">1418 </a>        <span class="python-name">maxline</span> <span class="python-operator">=</span> <span class="python-name">len</span><span class="python-operator">(</span><span class="python-name">infile</span><span class="python-operator">)</span> <span class="python-operator">-</span> <span class="python-number">1</span>
<a name="L1419" class="line-number">1419 </a>        <span class="python-name">cur_index</span> <span class="python-operator">=</span> <span class="python-operator">-</span><span class="python-number">1</span>
<a name="L1420" class="line-number">1420 </a>        <span class="python-name">reset_comment</span> <span class="python-operator">=</span> <span class="python-name">False</span>
<a name="L1421" class="line-number">1421 </a>        <span class="python-keyword">while</span> <span class="python-name">cur_index</span> <span class="python-operator">&lt;</span> <span class="python-name">maxline</span><span class="python-operator">:</span>
<a name="L1422" class="line-number">1422 </a>            <span class="python-keyword">if</span> <span class="python-name">reset_comment</span><span class="python-operator">:</span>
<a name="L1423" class="line-number">1423 </a>                <span class="python-name">comment_list</span> <span class="python-operator">=</span> <span class="python-operator">[</span><span class="python-operator">]</span>
<a name="L1424" class="line-number">1424 </a>            <span class="python-name">cur_index</span> <span class="python-operator">+=</span> <span class="python-number">1</span>
<a name="L1425" class="line-number">1425 </a>            <span class="python-name">line</span> <span class="python-operator">=</span> <span class="python-name">infile</span><span class="python-operator">[</span><span class="python-name">cur_index</span><span class="python-operator">]</span>
<a name="L1426" class="line-number">1426 </a>            <span class="python-name">sline</span> <span class="python-operator">=</span> <span class="python-name">line</span><span class="python-operator">.</span><span class="python-name">strip</span><span class="python-operator">(</span><span class="python-operator">)</span>
<a name="L1427" class="line-number">1427 </a>            <span class="python-comment"># do we have anything on the line ?</span>
<a name="L1428" class="line-number">1428 </a>            <span class="python-keyword">if</span> <span class="python-keyword">not</span> <span class="python-name">sline</span> <span class="python-keyword">or</span> <span class="python-name">sline</span><span class="python-operator">.</span><span class="python-name">startswith</span><span class="python-operator">(</span><span class="python-string">'#'</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1429" class="line-number">1429 </a>                <span class="python-name">reset_comment</span> <span class="python-operator">=</span> <span class="python-name">False</span>
<a name="L1430" class="line-number">1430 </a>                <span class="python-name">comment_list</span><span class="python-operator">.</span><span class="python-name">append</span><span class="python-operator">(</span><span class="python-name">line</span><span class="python-operator">)</span>
<a name="L1431" class="line-number">1431 </a>                <span class="python-keyword">continue</span>
<a name="L1432" class="line-number">1432 </a>            <span class="python-keyword">if</span> <span class="python-keyword">not</span> <span class="python-name">done_start</span><span class="python-operator">:</span>
<a name="L1433" class="line-number">1433 </a>                <span class="python-comment"># preserve initial comment</span>
<a name="L1434" class="line-number">1434 </a>                <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">initial_comment</span> <span class="python-operator">=</span> <span class="python-name">comment_list</span>
<a name="L1435" class="line-number">1435 </a>                <span class="python-name">comment_list</span> <span class="python-operator">=</span> <span class="python-operator">[</span><span class="python-operator">]</span>
<a name="L1436" class="line-number">1436 </a>                <span class="python-name">done_start</span> <span class="python-operator">=</span> <span class="python-name">True</span>
<a name="L1437" class="line-number">1437 </a>            <span class="python-name">reset_comment</span> <span class="python-operator">=</span> <span class="python-name">True</span>
<a name="L1438" class="line-number">1438 </a>            <span class="python-comment"># first we check if it's a section marker</span>
<a name="L1439" class="line-number">1439 </a>            <span class="python-name">mat</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_sectionmarker</span><span class="python-operator">.</span><span class="python-name">match</span><span class="python-operator">(</span><span class="python-name">line</span><span class="python-operator">)</span>
<a name="L1440" class="line-number">1440 </a>            <span class="python-keyword">if</span> <span class="python-name">mat</span> <span class="python-keyword">is</span> <span class="python-keyword">not</span> <span class="python-name">None</span><span class="python-operator">:</span>
<a name="L1441" class="line-number">1441 </a>                <span class="python-comment"># is a section line</span>
<a name="L1442" class="line-number">1442 </a>                <span class="python-operator">(</span><span class="python-name">indent</span><span class="python-operator">,</span> <span class="python-name">sect_open</span><span class="python-operator">,</span> <span class="python-name">sect_name</span><span class="python-operator">,</span> <span class="python-name">sect_close</span><span class="python-operator">,</span> <span class="python-name">comment</span><span class="python-operator">)</span> <span class="python-operator">=</span> <span class="python-operator">(</span>
<a name="L1443" class="line-number">1443 </a>                    <span class="python-name">mat</span><span class="python-operator">.</span><span class="python-name">groups</span><span class="python-operator">(</span><span class="python-operator">)</span><span class="python-operator">)</span>
<a name="L1444" class="line-number">1444 </a>                <span class="python-keyword">if</span> <span class="python-name">indent</span> <span class="python-keyword">and</span> <span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">indent_type</span> <span class="python-keyword">is</span> <span class="python-name">None</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1445" class="line-number">1445 </a>                    <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">indent_type</span> <span class="python-operator">=</span> <span class="python-name">indent</span>
<a name="L1446" class="line-number">1446 </a>                <span class="python-name">cur_depth</span> <span class="python-operator">=</span> <span class="python-name">sect_open</span><span class="python-operator">.</span><span class="python-name">count</span><span class="python-operator">(</span><span class="python-string">'['</span><span class="python-operator">)</span>
<a name="L1447" class="line-number">1447 </a>                <span class="python-keyword">if</span> <span class="python-name">cur_depth</span> <span class="python-operator">!=</span> <span class="python-name">sect_close</span><span class="python-operator">.</span><span class="python-name">count</span><span class="python-operator">(</span><span class="python-string">']'</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1448" class="line-number">1448 </a>                    <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_handle_error</span><span class="python-operator">(</span>
<a name="L1449" class="line-number">1449 </a>                        <span class="python-string">"Cannot compute the section depth at line %s."</span><span class="python-operator">,</span>
<a name="L1450" class="line-number">1450 </a>                        <span class="python-name">NestingError</span><span class="python-operator">,</span> <span class="python-name">infile</span><span class="python-operator">,</span> <span class="python-name">cur_index</span><span class="python-operator">)</span>
<a name="L1451" class="line-number">1451 </a>                    <span class="python-keyword">continue</span>
<a name="L1452" class="line-number">1452 </a>                <span class="python-comment">#</span>
<a name="L1453" class="line-number">1453 </a>                <span class="python-keyword">if</span> <span class="python-name">cur_depth</span> <span class="python-operator">&lt;</span> <span class="python-name">this_section</span><span class="python-operator">.</span><span class="python-name">depth</span><span class="python-operator">:</span>
<a name="L1454" class="line-number">1454 </a>                    <span class="python-comment"># the new section is dropping back to a previous level</span>
<a name="L1455" class="line-number">1455 </a>                    <span class="python-keyword">try</span><span class="python-operator">:</span>
<a name="L1456" class="line-number">1456 </a>                        <span class="python-name">parent</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_match_depth</span><span class="python-operator">(</span>
<a name="L1457" class="line-number">1457 </a>                            <span class="python-name">this_section</span><span class="python-operator">,</span>
<a name="L1458" class="line-number">1458 </a>                            <span class="python-name">cur_depth</span><span class="python-operator">)</span><span class="python-operator">.</span><span class="python-name">parent</span>
<a name="L1459" class="line-number">1459 </a>                    <span class="python-keyword">except</span> <span class="python-name">SyntaxError</span><span class="python-operator">:</span>
<a name="L1460" class="line-number">1460 </a>                        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_handle_error</span><span class="python-operator">(</span>
<a name="L1461" class="line-number">1461 </a>                            <span class="python-string">"Cannot compute nesting level at line %s."</span><span class="python-operator">,</span>
<a name="L1462" class="line-number">1462 </a>                            <span class="python-name">NestingError</span><span class="python-operator">,</span> <span class="python-name">infile</span><span class="python-operator">,</span> <span class="python-name">cur_index</span><span class="python-operator">)</span>
<a name="L1463" class="line-number">1463 </a>                        <span class="python-keyword">continue</span>
<a name="L1464" class="line-number">1464 </a>                <span class="python-keyword">elif</span> <span class="python-name">cur_depth</span> <span class="python-operator">==</span> <span class="python-name">this_section</span><span class="python-operator">.</span><span class="python-name">depth</span><span class="python-operator">:</span>
<a name="L1465" class="line-number">1465 </a>                    <span class="python-comment"># the new section is a sibling of the current section</span>
<a name="L1466" class="line-number">1466 </a>                    <span class="python-name">parent</span> <span class="python-operator">=</span> <span class="python-name">this_section</span><span class="python-operator">.</span><span class="python-name">parent</span>
<a name="L1467" class="line-number">1467 </a>                <span class="python-keyword">elif</span> <span class="python-name">cur_depth</span> <span class="python-operator">==</span> <span class="python-name">this_section</span><span class="python-operator">.</span><span class="python-name">depth</span> <span class="python-operator">+</span> <span class="python-number">1</span><span class="python-operator">:</span>
<a name="L1468" class="line-number">1468 </a>                    <span class="python-comment"># the new section is a child the current section</span>
<a name="L1469" class="line-number">1469 </a>                    <span class="python-name">parent</span> <span class="python-operator">=</span> <span class="python-name">this_section</span>
<a name="L1470" class="line-number">1470 </a>                <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L1471" class="line-number">1471 </a>                    <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_handle_error</span><span class="python-operator">(</span>
<a name="L1472" class="line-number">1472 </a>                        <span class="python-string">"Section too nested at line %s."</span><span class="python-operator">,</span>
<a name="L1473" class="line-number">1473 </a>                        <span class="python-name">NestingError</span><span class="python-operator">,</span> <span class="python-name">infile</span><span class="python-operator">,</span> <span class="python-name">cur_index</span><span class="python-operator">)</span>
<a name="L1474" class="line-number">1474 </a>                <span class="python-comment">#</span>
<a name="L1475" class="line-number">1475 </a>                <span class="python-name">sect_name</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_unquote</span><span class="python-operator">(</span><span class="python-name">sect_name</span><span class="python-operator">)</span>
<a name="L1476" class="line-number">1476 </a>                <span class="python-keyword">if</span> <span class="python-name">parent</span><span class="python-operator">.</span><span class="python-name">has_key</span><span class="python-operator">(</span><span class="python-name">sect_name</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1477" class="line-number">1477 </a>                    <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_handle_error</span><span class="python-operator">(</span>
<a name="L1478" class="line-number">1478 </a>                        <span class="python-string">'Duplicate section name at line %s.'</span><span class="python-operator">,</span>
<a name="L1479" class="line-number">1479 </a>                        <span class="python-name">DuplicateError</span><span class="python-operator">,</span> <span class="python-name">infile</span><span class="python-operator">,</span> <span class="python-name">cur_index</span><span class="python-operator">)</span>
<a name="L1480" class="line-number">1480 </a>                    <span class="python-keyword">continue</span>
<a name="L1481" class="line-number">1481 </a>                <span class="python-comment"># create the new section</span>
<a name="L1482" class="line-number">1482 </a>                <span class="python-name">this_section</span> <span class="python-operator">=</span> <span class="python-name">Section</span><span class="python-operator">(</span>
<a name="L1483" class="line-number">1483 </a>                    <span class="python-name">parent</span><span class="python-operator">,</span>
<a name="L1484" class="line-number">1484 </a>                    <span class="python-name">cur_depth</span><span class="python-operator">,</span>
<a name="L1485" class="line-number">1485 </a>                    <span class="python-name">self</span><span class="python-operator">,</span>
<a name="L1486" class="line-number">1486 </a>                    <span class="python-name">name</span><span class="python-operator">=</span><span class="python-name">sect_name</span><span class="python-operator">)</span>
<a name="L1487" class="line-number">1487 </a>                <span class="python-name">parent</span><span class="python-operator">[</span><span class="python-name">sect_name</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-name">this_section</span>
<a name="L1488" class="line-number">1488 </a>                <span class="python-name">parent</span><span class="python-operator">.</span><span class="python-name">inline_comments</span><span class="python-operator">[</span><span class="python-name">sect_name</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-name">comment</span>
<a name="L1489" class="line-number">1489 </a>                <span class="python-name">parent</span><span class="python-operator">.</span><span class="python-name">comments</span><span class="python-operator">[</span><span class="python-name">sect_name</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-name">comment_list</span>
<a name="L1490" class="line-number">1490 </a>                <span class="python-keyword">continue</span>
<a name="L1491" class="line-number">1491 </a>            <span class="python-comment">#</span>
<a name="L1492" class="line-number">1492 </a>            <span class="python-comment"># it's not a section marker,</span>
<a name="L1493" class="line-number">1493 </a>            <span class="python-comment"># so it should be a valid ``key = value`` line</span>
<a name="L1494" class="line-number">1494 </a>            <span class="python-name">mat</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_keyword</span><span class="python-operator">.</span><span class="python-name">match</span><span class="python-operator">(</span><span class="python-name">line</span><span class="python-operator">)</span>
<a name="L1495" class="line-number">1495 </a>            <span class="python-keyword">if</span> <span class="python-name">mat</span> <span class="python-keyword">is</span> <span class="python-name">None</span><span class="python-operator">:</span>
<a name="L1496" class="line-number">1496 </a>                <span class="python-comment"># it neither matched as a keyword</span>
<a name="L1497" class="line-number">1497 </a>                <span class="python-comment"># or a section marker</span>
<a name="L1498" class="line-number">1498 </a>                <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_handle_error</span><span class="python-operator">(</span>
<a name="L1499" class="line-number">1499 </a>                    <span class="python-string">'Invalid line at line "%s".'</span><span class="python-operator">,</span>
<a name="L1500" class="line-number">1500 </a>                    <span class="python-name">ParseError</span><span class="python-operator">,</span> <span class="python-name">infile</span><span class="python-operator">,</span> <span class="python-name">cur_index</span><span class="python-operator">)</span>
<a name="L1501" class="line-number">1501 </a>            <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L1502" class="line-number">1502 </a>                <span class="python-comment"># is a keyword value</span>
<a name="L1503" class="line-number">1503 </a>                <span class="python-comment"># value will include any inline comment</span>
<a name="L1504" class="line-number">1504 </a>                <span class="python-operator">(</span><span class="python-name">indent</span><span class="python-operator">,</span> <span class="python-name">key</span><span class="python-operator">,</span> <span class="python-name">value</span><span class="python-operator">)</span> <span class="python-operator">=</span> <span class="python-name">mat</span><span class="python-operator">.</span><span class="python-name">groups</span><span class="python-operator">(</span><span class="python-operator">)</span>
<a name="L1505" class="line-number">1505 </a>                <span class="python-keyword">if</span> <span class="python-name">indent</span> <span class="python-keyword">and</span> <span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">indent_type</span> <span class="python-keyword">is</span> <span class="python-name">None</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1506" class="line-number">1506 </a>                    <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">indent_type</span> <span class="python-operator">=</span> <span class="python-name">indent</span>
<a name="L1507" class="line-number">1507 </a>                <span class="python-comment"># check for a multiline value</span>
<a name="L1508" class="line-number">1508 </a>                <span class="python-keyword">if</span> <span class="python-name">value</span><span class="python-operator">[</span><span class="python-operator">:</span><span class="python-number">3</span><span class="python-operator">]</span> <span class="python-keyword">in</span> <span class="python-operator">[</span><span class="python-string">'"""'</span><span class="python-operator">,</span> <span class="python-string">"'''"</span><span class="python-operator">]</span><span class="python-operator">:</span>
<a name="L1509" class="line-number">1509 </a>                    <span class="python-keyword">try</span><span class="python-operator">:</span>
<a name="L1510" class="line-number">1510 </a>                        <span class="python-operator">(</span><span class="python-name">value</span><span class="python-operator">,</span> <span class="python-name">comment</span><span class="python-operator">,</span> <span class="python-name">cur_index</span><span class="python-operator">)</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_multiline</span><span class="python-operator">(</span>
<a name="L1511" class="line-number">1511 </a>                            <span class="python-name">value</span><span class="python-operator">,</span> <span class="python-name">infile</span><span class="python-operator">,</span> <span class="python-name">cur_index</span><span class="python-operator">,</span> <span class="python-name">maxline</span><span class="python-operator">)</span>
<a name="L1512" class="line-number">1512 </a>                    <span class="python-keyword">except</span> <span class="python-name">SyntaxError</span><span class="python-operator">:</span>
<a name="L1513" class="line-number">1513 </a>                        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_handle_error</span><span class="python-operator">(</span>
<a name="L1514" class="line-number">1514 </a>                            <span class="python-string">'Parse error in value at line %s.'</span><span class="python-operator">,</span>
<a name="L1515" class="line-number">1515 </a>                            <span class="python-name">ParseError</span><span class="python-operator">,</span> <span class="python-name">infile</span><span class="python-operator">,</span> <span class="python-name">cur_index</span><span class="python-operator">)</span>
<a name="L1516" class="line-number">1516 </a>                        <span class="python-keyword">continue</span>
<a name="L1517" class="line-number">1517 </a>                    <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L1518" class="line-number">1518 </a>                        <span class="python-keyword">if</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">unrepr</span><span class="python-operator">:</span>
<a name="L1519" class="line-number">1519 </a>                            <span class="python-name">comment</span> <span class="python-operator">=</span> <span class="python-string">''</span>
<a name="L1520" class="line-number">1520 </a>                            <span class="python-keyword">try</span><span class="python-operator">:</span>
<a name="L1521" class="line-number">1521 </a>                                <span class="python-name">value</span> <span class="python-operator">=</span> <span class="python-name">unrepr</span><span class="python-operator">(</span><span class="python-name">value</span><span class="python-operator">)</span>
<a name="L1522" class="line-number">1522 </a>                            <span class="python-keyword">except</span> <span class="python-name">Exception</span><span class="python-operator">,</span> <span class="python-name">e</span><span class="python-operator">:</span>
<a name="L1523" class="line-number">1523 </a>                                <span class="python-keyword">if</span> <span class="python-name">type</span><span class="python-operator">(</span><span class="python-name">e</span><span class="python-operator">)</span> <span class="python-operator">==</span> <span class="python-name">UnknownType</span><span class="python-operator">:</span>
<a name="L1524" class="line-number">1524 </a>                                    <span class="python-name">msg</span> <span class="python-operator">=</span> <span class="python-string">'Unknown name or type in value at line %s.'</span>
<a name="L1525" class="line-number">1525 </a>                                <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L1526" class="line-number">1526 </a>                                    <span class="python-name">msg</span> <span class="python-operator">=</span> <span class="python-string">'Parse error in value at line %s.'</span>
<a name="L1527" class="line-number">1527 </a>                                <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_handle_error</span><span class="python-operator">(</span><span class="python-name">msg</span><span class="python-operator">,</span> <span class="python-name">UnreprError</span><span class="python-operator">,</span> <span class="python-name">infile</span><span class="python-operator">,</span>
<a name="L1528" class="line-number">1528 </a>                                    <span class="python-name">cur_index</span><span class="python-operator">)</span>
<a name="L1529" class="line-number">1529 </a>                                <span class="python-keyword">continue</span>
<a name="L1530" class="line-number">1530 </a>                <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L1531" class="line-number">1531 </a>                    <span class="python-keyword">if</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">unrepr</span><span class="python-operator">:</span>
<a name="L1532" class="line-number">1532 </a>                        <span class="python-name">comment</span> <span class="python-operator">=</span> <span class="python-string">''</span>
<a name="L1533" class="line-number">1533 </a>                        <span class="python-keyword">try</span><span class="python-operator">:</span>
<a name="L1534" class="line-number">1534 </a>                            <span class="python-name">value</span> <span class="python-operator">=</span> <span class="python-name">unrepr</span><span class="python-operator">(</span><span class="python-name">value</span><span class="python-operator">)</span>
<a name="L1535" class="line-number">1535 </a>                        <span class="python-keyword">except</span> <span class="python-name">Exception</span><span class="python-operator">,</span> <span class="python-name">e</span><span class="python-operator">:</span>
<a name="L1536" class="line-number">1536 </a>                            <span class="python-keyword">if</span> <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">e</span><span class="python-operator">,</span> <span class="python-name">UnknownType</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1537" class="line-number">1537 </a>                                <span class="python-name">msg</span> <span class="python-operator">=</span> <span class="python-string">'Unknown name or type in value at line %s.'</span>
<a name="L1538" class="line-number">1538 </a>                            <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L1539" class="line-number">1539 </a>                                <span class="python-name">msg</span> <span class="python-operator">=</span> <span class="python-string">'Parse error in value at line %s.'</span>
<a name="L1540" class="line-number">1540 </a>                            <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_handle_error</span><span class="python-operator">(</span><span class="python-name">msg</span><span class="python-operator">,</span> <span class="python-name">UnreprError</span><span class="python-operator">,</span> <span class="python-name">infile</span><span class="python-operator">,</span>
<a name="L1541" class="line-number">1541 </a>                                <span class="python-name">cur_index</span><span class="python-operator">)</span>
<a name="L1542" class="line-number">1542 </a>                            <span class="python-keyword">continue</span>
<a name="L1543" class="line-number">1543 </a>                    <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L1544" class="line-number">1544 </a>                        <span class="python-comment"># extract comment and lists</span>
<a name="L1545" class="line-number">1545 </a>                        <span class="python-keyword">try</span><span class="python-operator">:</span>
<a name="L1546" class="line-number">1546 </a>                            <span class="python-operator">(</span><span class="python-name">value</span><span class="python-operator">,</span> <span class="python-name">comment</span><span class="python-operator">)</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_handle_value</span><span class="python-operator">(</span><span class="python-name">value</span><span class="python-operator">)</span>
<a name="L1547" class="line-number">1547 </a>                        <span class="python-keyword">except</span> <span class="python-name">SyntaxError</span><span class="python-operator">:</span>
<a name="L1548" class="line-number">1548 </a>                            <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_handle_error</span><span class="python-operator">(</span>
<a name="L1549" class="line-number">1549 </a>                                <span class="python-string">'Parse error in value at line %s.'</span><span class="python-operator">,</span>
<a name="L1550" class="line-number">1550 </a>                                <span class="python-name">ParseError</span><span class="python-operator">,</span> <span class="python-name">infile</span><span class="python-operator">,</span> <span class="python-name">cur_index</span><span class="python-operator">)</span>
<a name="L1551" class="line-number">1551 </a>                            <span class="python-keyword">continue</span>
<a name="L1552" class="line-number">1552 </a>                <span class="python-comment">#</span>
<a name="L1553" class="line-number">1553 </a>                <span class="python-name">key</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_unquote</span><span class="python-operator">(</span><span class="python-name">key</span><span class="python-operator">)</span>
<a name="L1554" class="line-number">1554 </a>                <span class="python-keyword">if</span> <span class="python-name">this_section</span><span class="python-operator">.</span><span class="python-name">has_key</span><span class="python-operator">(</span><span class="python-name">key</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1555" class="line-number">1555 </a>                    <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_handle_error</span><span class="python-operator">(</span>
<a name="L1556" class="line-number">1556 </a>                        <span class="python-string">'Duplicate keyword name at line %s.'</span><span class="python-operator">,</span>
<a name="L1557" class="line-number">1557 </a>                        <span class="python-name">DuplicateError</span><span class="python-operator">,</span> <span class="python-name">infile</span><span class="python-operator">,</span> <span class="python-name">cur_index</span><span class="python-operator">)</span>
<a name="L1558" class="line-number">1558 </a>                    <span class="python-keyword">continue</span>
<a name="L1559" class="line-number">1559 </a>                <span class="python-comment"># add the key.</span>
<a name="L1560" class="line-number">1560 </a>                <span class="python-comment"># we set unrepr because if we have got this far we will never</span>
<a name="L1561" class="line-number">1561 </a>                <span class="python-comment"># be creating a new section</span>
<a name="L1562" class="line-number">1562 </a>                <span class="python-name">this_section</span><span class="python-operator">.</span><span class="python-name">__setitem__</span><span class="python-operator">(</span><span class="python-name">key</span><span class="python-operator">,</span> <span class="python-name">value</span><span class="python-operator">,</span> <span class="python-name">unrepr</span><span class="python-operator">=</span><span class="python-name">True</span><span class="python-operator">)</span>
<a name="L1563" class="line-number">1563 </a>                <span class="python-name">this_section</span><span class="python-operator">.</span><span class="python-name">inline_comments</span><span class="python-operator">[</span><span class="python-name">key</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-name">comment</span>
<a name="L1564" class="line-number">1564 </a>                <span class="python-name">this_section</span><span class="python-operator">.</span><span class="python-name">comments</span><span class="python-operator">[</span><span class="python-name">key</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-name">comment_list</span>
<a name="L1565" class="line-number">1565 </a>                <span class="python-keyword">continue</span>
<a name="L1566" class="line-number">1566 </a>        <span class="python-comment">#</span>
<a name="L1567" class="line-number">1567 </a>        <span class="python-keyword">if</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">indent_type</span> <span class="python-keyword">is</span> <span class="python-name">None</span><span class="python-operator">:</span>
<a name="L1568" class="line-number">1568 </a>            <span class="python-comment"># no indentation used, set the type accordingly</span>
<a name="L1569" class="line-number">1569 </a>            <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">indent_type</span> <span class="python-operator">=</span> <span class="python-string">''</span>
<a name="L1570" class="line-number">1570 </a>        <span class="python-comment">#</span>
<a name="L1571" class="line-number">1571 </a>        <span class="python-keyword">if</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_terminated</span><span class="python-operator">:</span>
<a name="L1572" class="line-number">1572 </a>            <span class="python-name">comment_list</span><span class="python-operator">.</span><span class="python-name">append</span><span class="python-operator">(</span><span class="python-string">''</span><span class="python-operator">)</span>
<a name="L1573" class="line-number">1573 </a>        <span class="python-comment"># preserve the final comment</span>
<a name="L1574" class="line-number">1574 </a>        <span class="python-keyword">if</span> <span class="python-keyword">not</span> <span class="python-name">self</span> <span class="python-keyword">and</span> <span class="python-keyword">not</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">initial_comment</span><span class="python-operator">:</span>
<a name="L1575" class="line-number">1575 </a>            <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">initial_comment</span> <span class="python-operator">=</span> <span class="python-name">comment_list</span>
<a name="L1576" class="line-number">1576 </a>        <span class="python-keyword">elif</span> <span class="python-keyword">not</span> <span class="python-name">reset_comment</span><span class="python-operator">:</span>
<a name="L1577" class="line-number">1577 </a>            <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">final_comment</span> <span class="python-operator">=</span> <span class="python-name">comment_list</span>
<a name="L1578" class="line-number">1578 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">list_values</span> <span class="python-operator">=</span> <span class="python-name">temp_list_values</span>
<a name="L1579" class="line-number">1579 </a>
<a name="L1580" class="line-number">1580 </a>    <span class="python-keyword">def</span> <span class="python-name">_match_depth</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">sect</span><span class="python-operator">,</span> <span class="python-name">depth</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1581" class="line-number">1581 </a>        <span class="python-string">"""
<a name="L1582" class="line-number">1582 </a>        Given a section and a depth level, walk back through the sections
<a name="L1583" class="line-number">1583 </a>        parents to see if the depth level matches a previous section.
<a name="L1584" class="line-number">1584 </a>        
<a name="L1585" class="line-number">1585 </a>        Return a reference to the right section,
<a name="L1586" class="line-number">1586 </a>        or raise a SyntaxError.
<a name="L1587" class="line-number">1587 </a>        """</span>
<a name="L1588" class="line-number">1588 </a>        <span class="python-keyword">while</span> <span class="python-name">depth</span> <span class="python-operator">&lt;</span> <span class="python-name">sect</span><span class="python-operator">.</span><span class="python-name">depth</span><span class="python-operator">:</span>
<a name="L1589" class="line-number">1589 </a>            <span class="python-keyword">if</span> <span class="python-name">sect</span> <span class="python-keyword">is</span> <span class="python-name">sect</span><span class="python-operator">.</span><span class="python-name">parent</span><span class="python-operator">:</span>
<a name="L1590" class="line-number">1590 </a>                <span class="python-comment"># we've reached the top level already</span>
<a name="L1591" class="line-number">1591 </a>                <span class="python-keyword">raise</span> <span class="python-name">SyntaxError</span>
<a name="L1592" class="line-number">1592 </a>            <span class="python-name">sect</span> <span class="python-operator">=</span> <span class="python-name">sect</span><span class="python-operator">.</span><span class="python-name">parent</span>
<a name="L1593" class="line-number">1593 </a>        <span class="python-keyword">if</span> <span class="python-name">sect</span><span class="python-operator">.</span><span class="python-name">depth</span> <span class="python-operator">==</span> <span class="python-name">depth</span><span class="python-operator">:</span>
<a name="L1594" class="line-number">1594 </a>            <span class="python-keyword">return</span> <span class="python-name">sect</span>
<a name="L1595" class="line-number">1595 </a>        <span class="python-comment"># shouldn't get here</span>
<a name="L1596" class="line-number">1596 </a>        <span class="python-keyword">raise</span> <span class="python-name">SyntaxError</span>
<a name="L1597" class="line-number">1597 </a>
<a name="L1598" class="line-number">1598 </a>    <span class="python-keyword">def</span> <span class="python-name">_handle_error</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">text</span><span class="python-operator">,</span> <span class="python-name">ErrorClass</span><span class="python-operator">,</span> <span class="python-name">infile</span><span class="python-operator">,</span> <span class="python-name">cur_index</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1599" class="line-number">1599 </a>        <span class="python-string">"""
<a name="L1600" class="line-number">1600 </a>        Handle an error according to the error settings.
<a name="L1601" class="line-number">1601 </a>        
<a name="L1602" class="line-number">1602 </a>        Either raise the error or store it.
<a name="L1603" class="line-number">1603 </a>        The error will have occured at ``cur_index``
<a name="L1604" class="line-number">1604 </a>        """</span>
<a name="L1605" class="line-number">1605 </a>        <span class="python-name">line</span> <span class="python-operator">=</span> <span class="python-name">infile</span><span class="python-operator">[</span><span class="python-name">cur_index</span><span class="python-operator">]</span>
<a name="L1606" class="line-number">1606 </a>        <span class="python-name">cur_index</span> <span class="python-operator">+=</span> <span class="python-number">1</span>
<a name="L1607" class="line-number">1607 </a>        <span class="python-name">message</span> <span class="python-operator">=</span> <span class="python-name">text</span> <span class="python-operator">%</span> <span class="python-name">cur_index</span>
<a name="L1608" class="line-number">1608 </a>        <span class="python-name">error</span> <span class="python-operator">=</span> <span class="python-name">ErrorClass</span><span class="python-operator">(</span><span class="python-name">message</span><span class="python-operator">,</span> <span class="python-name">cur_index</span><span class="python-operator">,</span> <span class="python-name">line</span><span class="python-operator">)</span>
<a name="L1609" class="line-number">1609 </a>        <span class="python-keyword">if</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">raise_errors</span><span class="python-operator">:</span>
<a name="L1610" class="line-number">1610 </a>            <span class="python-comment"># raise the error - parsing stops here</span>
<a name="L1611" class="line-number">1611 </a>            <span class="python-keyword">raise</span> <span class="python-name">error</span>
<a name="L1612" class="line-number">1612 </a>        <span class="python-comment"># store the error</span>
<a name="L1613" class="line-number">1613 </a>        <span class="python-comment"># reraise when parsing has finished</span>
<a name="L1614" class="line-number">1614 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_errors</span><span class="python-operator">.</span><span class="python-name">append</span><span class="python-operator">(</span><span class="python-name">error</span><span class="python-operator">)</span>
<a name="L1615" class="line-number">1615 </a>
<a name="L1616" class="line-number">1616 </a>    <span class="python-keyword">def</span> <span class="python-name">_unquote</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">value</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1617" class="line-number">1617 </a>        <span class="python-string">"""Return an unquoted version of a value"""</span>
<a name="L1618" class="line-number">1618 </a>        <span class="python-keyword">if</span> <span class="python-operator">(</span><span class="python-name">value</span><span class="python-operator">[</span><span class="python-number">0</span><span class="python-operator">]</span> <span class="python-operator">==</span> <span class="python-name">value</span><span class="python-operator">[</span><span class="python-operator">-</span><span class="python-number">1</span><span class="python-operator">]</span><span class="python-operator">)</span> <span class="python-keyword">and</span> <span class="python-operator">(</span><span class="python-name">value</span><span class="python-operator">[</span><span class="python-number">0</span><span class="python-operator">]</span> <span class="python-keyword">in</span> <span class="python-operator">(</span><span class="python-string">'"'</span><span class="python-operator">,</span> <span class="python-string">"'"</span><span class="python-operator">)</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1619" class="line-number">1619 </a>            <span class="python-name">value</span> <span class="python-operator">=</span> <span class="python-name">value</span><span class="python-operator">[</span><span class="python-number">1</span><span class="python-operator">:</span><span class="python-operator">-</span><span class="python-number">1</span><span class="python-operator">]</span>
<a name="L1620" class="line-number">1620 </a>        <span class="python-keyword">return</span> <span class="python-name">value</span>
<a name="L1621" class="line-number">1621 </a>
<a name="L1622" class="line-number">1622 </a>    <span class="python-keyword">def</span> <span class="python-name">_quote</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">value</span><span class="python-operator">,</span> <span class="python-name">multiline</span><span class="python-operator">=</span><span class="python-name">True</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1623" class="line-number">1623 </a>        <span class="python-string">"""
<a name="L1624" class="line-number">1624 </a>        Return a safely quoted version of a value.
<a name="L1625" class="line-number">1625 </a>        
<a name="L1626" class="line-number">1626 </a>        Raise a ConfigObjError if the value cannot be safely quoted.
<a name="L1627" class="line-number">1627 </a>        If multiline is ``True`` (default) then use triple quotes
<a name="L1628" class="line-number">1628 </a>        if necessary.
<a name="L1629" class="line-number">1629 </a>        
<a name="L1630" class="line-number">1630 </a>        Don't quote values that don't need it.
<a name="L1631" class="line-number">1631 </a>        Recursively quote members of a list and return a comma joined list.
<a name="L1632" class="line-number">1632 </a>        Multiline is ``False`` for lists.
<a name="L1633" class="line-number">1633 </a>        Obey list syntax for empty and single member lists.
<a name="L1634" class="line-number">1634 </a>        
<a name="L1635" class="line-number">1635 </a>        If ``list_values=False`` then the value is only quoted if it contains
<a name="L1636" class="line-number">1636 </a>        a ``\n`` (is multiline).
<a name="L1637" class="line-number">1637 </a>        
<a name="L1638" class="line-number">1638 </a>        If ``write_empty_values`` is set, and the value is an empty string, it
<a name="L1639" class="line-number">1639 </a>        won't be quoted.
<a name="L1640" class="line-number">1640 </a>        """</span>
<a name="L1641" class="line-number">1641 </a>        <span class="python-keyword">if</span> <span class="python-name">multiline</span> <span class="python-keyword">and</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">write_empty_values</span> <span class="python-keyword">and</span> <span class="python-name">value</span> <span class="python-operator">==</span> <span class="python-string">''</span><span class="python-operator">:</span>
<a name="L1642" class="line-number">1642 </a>            <span class="python-comment"># Only if multiline is set, so that it is used for values not</span>
<a name="L1643" class="line-number">1643 </a>            <span class="python-comment"># keys, and not values that are part of a list</span>
<a name="L1644" class="line-number">1644 </a>            <span class="python-keyword">return</span> <span class="python-string">''</span>
<a name="L1645" class="line-number">1645 </a>        <span class="python-keyword">if</span> <span class="python-name">multiline</span> <span class="python-keyword">and</span> <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">value</span><span class="python-operator">,</span> <span class="python-operator">(</span><span class="python-name">list</span><span class="python-operator">,</span> <span class="python-name">tuple</span><span class="python-operator">)</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1646" class="line-number">1646 </a>            <span class="python-keyword">if</span> <span class="python-keyword">not</span> <span class="python-name">value</span><span class="python-operator">:</span>
<a name="L1647" class="line-number">1647 </a>                <span class="python-keyword">return</span> <span class="python-string">','</span>
<a name="L1648" class="line-number">1648 </a>            <span class="python-keyword">elif</span> <span class="python-name">len</span><span class="python-operator">(</span><span class="python-name">value</span><span class="python-operator">)</span> <span class="python-operator">==</span> <span class="python-number">1</span><span class="python-operator">:</span>
<a name="L1649" class="line-number">1649 </a>                <span class="python-keyword">return</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_quote</span><span class="python-operator">(</span><span class="python-name">value</span><span class="python-operator">[</span><span class="python-number">0</span><span class="python-operator">]</span><span class="python-operator">,</span> <span class="python-name">multiline</span><span class="python-operator">=</span><span class="python-name">False</span><span class="python-operator">)</span> <span class="python-operator">+</span> <span class="python-string">','</span>
<a name="L1650" class="line-number">1650 </a>            <span class="python-keyword">return</span> <span class="python-string">', '</span><span class="python-operator">.</span><span class="python-name">join</span><span class="python-operator">(</span><span class="python-operator">[</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_quote</span><span class="python-operator">(</span><span class="python-name">val</span><span class="python-operator">,</span> <span class="python-name">multiline</span><span class="python-operator">=</span><span class="python-name">False</span><span class="python-operator">)</span>
<a name="L1651" class="line-number">1651 </a>                <span class="python-keyword">for</span> <span class="python-name">val</span> <span class="python-keyword">in</span> <span class="python-name">value</span><span class="python-operator">]</span><span class="python-operator">)</span>
<a name="L1652" class="line-number">1652 </a>        <span class="python-keyword">if</span> <span class="python-keyword">not</span> <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">value</span><span class="python-operator">,</span> <span class="python-name">StringTypes</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1653" class="line-number">1653 </a>            <span class="python-keyword">if</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">stringify</span><span class="python-operator">:</span>
<a name="L1654" class="line-number">1654 </a>                <span class="python-name">value</span> <span class="python-operator">=</span> <span class="python-name">str</span><span class="python-operator">(</span><span class="python-name">value</span><span class="python-operator">)</span>
<a name="L1655" class="line-number">1655 </a>            <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L1656" class="line-number">1656 </a>                <span class="python-keyword">raise</span> <span class="python-name">TypeError</span><span class="python-operator">,</span> <span class="python-string">'Value "%s" is not a string.'</span> <span class="python-operator">%</span> <span class="python-name">value</span>
<a name="L1657" class="line-number">1657 </a>        <span class="python-name">squot</span> <span class="python-operator">=</span> <span class="python-string">"'%s'"</span>
<a name="L1658" class="line-number">1658 </a>        <span class="python-name">dquot</span> <span class="python-operator">=</span> <span class="python-string">'"%s"'</span>
<a name="L1659" class="line-number">1659 </a>        <span class="python-name">noquot</span> <span class="python-operator">=</span> <span class="python-string">"%s"</span>
<a name="L1660" class="line-number">1660 </a>        <span class="python-name">wspace_plus</span> <span class="python-operator">=</span> <span class="python-string">' \r\t\n\v\t\'"'</span>
<a name="L1661" class="line-number">1661 </a>        <span class="python-name">tsquot</span> <span class="python-operator">=</span> <span class="python-string">'"""%s"""'</span>
<a name="L1662" class="line-number">1662 </a>        <span class="python-name">tdquot</span> <span class="python-operator">=</span> <span class="python-string">"'''%s'''"</span>
<a name="L1663" class="line-number">1663 </a>        <span class="python-keyword">if</span> <span class="python-keyword">not</span> <span class="python-name">value</span><span class="python-operator">:</span>
<a name="L1664" class="line-number">1664 </a>            <span class="python-keyword">return</span> <span class="python-string">'""'</span>
<a name="L1665" class="line-number">1665 </a>        <span class="python-keyword">if</span> <span class="python-operator">(</span><span class="python-keyword">not</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">list_values</span> <span class="python-keyword">and</span> <span class="python-string">'\n'</span> <span class="python-keyword">not</span> <span class="python-keyword">in</span> <span class="python-name">value</span><span class="python-operator">)</span> <span class="python-keyword">or</span> <span class="python-keyword">not</span> <span class="python-operator">(</span><span class="python-name">multiline</span> <span class="python-keyword">and</span>
<a name="L1666" class="line-number">1666 </a>                <span class="python-operator">(</span><span class="python-operator">(</span><span class="python-operator">(</span><span class="python-string">"'"</span> <span class="python-keyword">in</span> <span class="python-name">value</span><span class="python-operator">)</span> <span class="python-keyword">and</span> <span class="python-operator">(</span><span class="python-string">'"'</span> <span class="python-keyword">in</span> <span class="python-name">value</span><span class="python-operator">)</span><span class="python-operator">)</span> <span class="python-keyword">or</span> <span class="python-operator">(</span><span class="python-string">'\n'</span> <span class="python-keyword">in</span> <span class="python-name">value</span><span class="python-operator">)</span><span class="python-operator">)</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1667" class="line-number">1667 </a>            <span class="python-keyword">if</span> <span class="python-keyword">not</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">list_values</span><span class="python-operator">:</span>
<a name="L1668" class="line-number">1668 </a>                <span class="python-comment"># we don't quote if ``list_values=False``</span>
<a name="L1669" class="line-number">1669 </a>                <span class="python-name">quot</span> <span class="python-operator">=</span> <span class="python-name">noquot</span>
<a name="L1670" class="line-number">1670 </a>            <span class="python-comment"># for normal values either single or double quotes will do</span>
<a name="L1671" class="line-number">1671 </a>            <span class="python-keyword">elif</span> <span class="python-string">'\n'</span> <span class="python-keyword">in</span> <span class="python-name">value</span><span class="python-operator">:</span>
<a name="L1672" class="line-number">1672 </a>                <span class="python-comment"># will only happen if multiline is off - e.g. '\n' in key</span>
<a name="L1673" class="line-number">1673 </a>                <span class="python-keyword">raise</span> <span class="python-name">ConfigObjError</span><span class="python-operator">,</span> <span class="python-operator">(</span><span class="python-string">'Value "%s" cannot be safely quoted.'</span> <span class="python-operator">%</span>
<a name="L1674" class="line-number">1674 </a>                    <span class="python-name">value</span><span class="python-operator">)</span>
<a name="L1675" class="line-number">1675 </a>            <span class="python-keyword">elif</span> <span class="python-operator">(</span><span class="python-operator">(</span><span class="python-name">value</span><span class="python-operator">[</span><span class="python-number">0</span><span class="python-operator">]</span> <span class="python-keyword">not</span> <span class="python-keyword">in</span> <span class="python-name">wspace_plus</span><span class="python-operator">)</span> <span class="python-keyword">and</span>
<a name="L1676" class="line-number">1676 </a>                    <span class="python-operator">(</span><span class="python-name">value</span><span class="python-operator">[</span><span class="python-operator">-</span><span class="python-number">1</span><span class="python-operator">]</span> <span class="python-keyword">not</span> <span class="python-keyword">in</span> <span class="python-name">wspace_plus</span><span class="python-operator">)</span> <span class="python-keyword">and</span>
<a name="L1677" class="line-number">1677 </a>                    <span class="python-operator">(</span><span class="python-string">','</span> <span class="python-keyword">not</span> <span class="python-keyword">in</span> <span class="python-name">value</span><span class="python-operator">)</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1678" class="line-number">1678 </a>                <span class="python-name">quot</span> <span class="python-operator">=</span> <span class="python-name">noquot</span>
<a name="L1679" class="line-number">1679 </a>            <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L1680" class="line-number">1680 </a>                <span class="python-keyword">if</span> <span class="python-operator">(</span><span class="python-string">"'"</span> <span class="python-keyword">in</span> <span class="python-name">value</span><span class="python-operator">)</span> <span class="python-keyword">and</span> <span class="python-operator">(</span><span class="python-string">'"'</span> <span class="python-keyword">in</span> <span class="python-name">value</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1681" class="line-number">1681 </a>                    <span class="python-keyword">raise</span> <span class="python-name">ConfigObjError</span><span class="python-operator">,</span> <span class="python-operator">(</span>
<a name="L1682" class="line-number">1682 </a>                        <span class="python-string">'Value "%s" cannot be safely quoted.'</span> <span class="python-operator">%</span> <span class="python-name">value</span><span class="python-operator">)</span>
<a name="L1683" class="line-number">1683 </a>                <span class="python-keyword">elif</span> <span class="python-string">'"'</span> <span class="python-keyword">in</span> <span class="python-name">value</span><span class="python-operator">:</span>
<a name="L1684" class="line-number">1684 </a>                    <span class="python-name">quot</span> <span class="python-operator">=</span> <span class="python-name">squot</span>
<a name="L1685" class="line-number">1685 </a>                <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L1686" class="line-number">1686 </a>                    <span class="python-name">quot</span> <span class="python-operator">=</span> <span class="python-name">dquot</span>
<a name="L1687" class="line-number">1687 </a>        <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L1688" class="line-number">1688 </a>            <span class="python-comment"># if value has '\n' or "'" *and* '"', it will need triple quotes</span>
<a name="L1689" class="line-number">1689 </a>            <span class="python-keyword">if</span> <span class="python-operator">(</span><span class="python-name">value</span><span class="python-operator">.</span><span class="python-name">find</span><span class="python-operator">(</span><span class="python-string">'"""'</span><span class="python-operator">)</span> <span class="python-operator">!=</span> <span class="python-operator">-</span><span class="python-number">1</span><span class="python-operator">)</span> <span class="python-keyword">and</span> <span class="python-operator">(</span><span class="python-name">value</span><span class="python-operator">.</span><span class="python-name">find</span><span class="python-operator">(</span><span class="python-string">"'''"</span><span class="python-operator">)</span> <span class="python-operator">!=</span> <span class="python-operator">-</span><span class="python-number">1</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1690" class="line-number">1690 </a>                <span class="python-keyword">raise</span> <span class="python-name">ConfigObjError</span><span class="python-operator">,</span> <span class="python-operator">(</span>
<a name="L1691" class="line-number">1691 </a>                    <span class="python-string">'Value "%s" cannot be safely quoted.'</span> <span class="python-operator">%</span> <span class="python-name">value</span><span class="python-operator">)</span>
<a name="L1692" class="line-number">1692 </a>            <span class="python-keyword">if</span> <span class="python-name">value</span><span class="python-operator">.</span><span class="python-name">find</span><span class="python-operator">(</span><span class="python-string">'"""'</span><span class="python-operator">)</span> <span class="python-operator">==</span> <span class="python-operator">-</span><span class="python-number">1</span><span class="python-operator">:</span>
<a name="L1693" class="line-number">1693 </a>                <span class="python-name">quot</span> <span class="python-operator">=</span> <span class="python-name">tdquot</span>
<a name="L1694" class="line-number">1694 </a>            <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L1695" class="line-number">1695 </a>                <span class="python-name">quot</span> <span class="python-operator">=</span> <span class="python-name">tsquot</span>
<a name="L1696" class="line-number">1696 </a>        <span class="python-keyword">return</span> <span class="python-name">quot</span> <span class="python-operator">%</span> <span class="python-name">value</span>
<a name="L1697" class="line-number">1697 </a>
<a name="L1698" class="line-number">1698 </a>    <span class="python-keyword">def</span> <span class="python-name">_handle_value</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">value</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1699" class="line-number">1699 </a>        <span class="python-string">"""
<a name="L1700" class="line-number">1700 </a>        Given a value string, unquote, remove comment,
<a name="L1701" class="line-number">1701 </a>        handle lists. (including empty and single member lists)
<a name="L1702" class="line-number">1702 </a>        """</span>
<a name="L1703" class="line-number">1703 </a>        <span class="python-comment"># do we look for lists in values ?</span>
<a name="L1704" class="line-number">1704 </a>        <span class="python-keyword">if</span> <span class="python-keyword">not</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">list_values</span><span class="python-operator">:</span>
<a name="L1705" class="line-number">1705 </a>            <span class="python-name">mat</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_nolistvalue</span><span class="python-operator">.</span><span class="python-name">match</span><span class="python-operator">(</span><span class="python-name">value</span><span class="python-operator">)</span>
<a name="L1706" class="line-number">1706 </a>            <span class="python-keyword">if</span> <span class="python-name">mat</span> <span class="python-keyword">is</span> <span class="python-name">None</span><span class="python-operator">:</span>
<a name="L1707" class="line-number">1707 </a>                <span class="python-keyword">raise</span> <span class="python-name">SyntaxError</span>
<a name="L1708" class="line-number">1708 </a>            <span class="python-comment"># NOTE: we don't unquote here</span>
<a name="L1709" class="line-number">1709 </a>            <span class="python-keyword">return</span> <span class="python-name">mat</span><span class="python-operator">.</span><span class="python-name">groups</span><span class="python-operator">(</span><span class="python-operator">)</span>
<a name="L1710" class="line-number">1710 </a>        <span class="python-comment">#</span>
<a name="L1711" class="line-number">1711 </a>        <span class="python-name">mat</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_valueexp</span><span class="python-operator">.</span><span class="python-name">match</span><span class="python-operator">(</span><span class="python-name">value</span><span class="python-operator">)</span>
<a name="L1712" class="line-number">1712 </a>        <span class="python-keyword">if</span> <span class="python-name">mat</span> <span class="python-keyword">is</span> <span class="python-name">None</span><span class="python-operator">:</span>
<a name="L1713" class="line-number">1713 </a>            <span class="python-comment"># the value is badly constructed, probably badly quoted,</span>
<a name="L1714" class="line-number">1714 </a>            <span class="python-comment"># or an invalid list</span>
<a name="L1715" class="line-number">1715 </a>            <span class="python-keyword">raise</span> <span class="python-name">SyntaxError</span>
<a name="L1716" class="line-number">1716 </a>        <span class="python-operator">(</span><span class="python-name">list_values</span><span class="python-operator">,</span> <span class="python-name">single</span><span class="python-operator">,</span> <span class="python-name">empty_list</span><span class="python-operator">,</span> <span class="python-name">comment</span><span class="python-operator">)</span> <span class="python-operator">=</span> <span class="python-name">mat</span><span class="python-operator">.</span><span class="python-name">groups</span><span class="python-operator">(</span><span class="python-operator">)</span>
<a name="L1717" class="line-number">1717 </a>        <span class="python-keyword">if</span> <span class="python-operator">(</span><span class="python-name">list_values</span> <span class="python-operator">==</span> <span class="python-string">''</span><span class="python-operator">)</span> <span class="python-keyword">and</span> <span class="python-operator">(</span><span class="python-name">single</span> <span class="python-keyword">is</span> <span class="python-name">None</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1718" class="line-number">1718 </a>            <span class="python-comment"># change this if you want to accept empty values</span>
<a name="L1719" class="line-number">1719 </a>            <span class="python-keyword">raise</span> <span class="python-name">SyntaxError</span>
<a name="L1720" class="line-number">1720 </a>        <span class="python-comment"># NOTE: note there is no error handling from here if the regex</span>
<a name="L1721" class="line-number">1721 </a>        <span class="python-comment"># is wrong: then incorrect values will slip through</span>
<a name="L1722" class="line-number">1722 </a>        <span class="python-keyword">if</span> <span class="python-name">empty_list</span> <span class="python-keyword">is</span> <span class="python-keyword">not</span> <span class="python-name">None</span><span class="python-operator">:</span>
<a name="L1723" class="line-number">1723 </a>            <span class="python-comment"># the single comma - meaning an empty list</span>
<a name="L1724" class="line-number">1724 </a>            <span class="python-keyword">return</span> <span class="python-operator">(</span><span class="python-operator">[</span><span class="python-operator">]</span><span class="python-operator">,</span> <span class="python-name">comment</span><span class="python-operator">)</span>
<a name="L1725" class="line-number">1725 </a>        <span class="python-keyword">if</span> <span class="python-name">single</span> <span class="python-keyword">is</span> <span class="python-keyword">not</span> <span class="python-name">None</span><span class="python-operator">:</span>
<a name="L1726" class="line-number">1726 </a>            <span class="python-comment"># handle empty values</span>
<a name="L1727" class="line-number">1727 </a>            <span class="python-keyword">if</span> <span class="python-name">list_values</span> <span class="python-keyword">and</span> <span class="python-keyword">not</span> <span class="python-name">single</span><span class="python-operator">:</span>
<a name="L1728" class="line-number">1728 </a>                <span class="python-comment"># FIXME: the '' is a workaround because our regex now matches</span>
<a name="L1729" class="line-number">1729 </a>                <span class="python-comment">#   '' at the end of a list if it has a trailing comma</span>
<a name="L1730" class="line-number">1730 </a>                <span class="python-name">single</span> <span class="python-operator">=</span> <span class="python-name">None</span>
<a name="L1731" class="line-number">1731 </a>            <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L1732" class="line-number">1732 </a>                <span class="python-name">single</span> <span class="python-operator">=</span> <span class="python-name">single</span> <span class="python-keyword">or</span> <span class="python-string">'""'</span>
<a name="L1733" class="line-number">1733 </a>                <span class="python-name">single</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_unquote</span><span class="python-operator">(</span><span class="python-name">single</span><span class="python-operator">)</span>
<a name="L1734" class="line-number">1734 </a>        <span class="python-keyword">if</span> <span class="python-name">list_values</span> <span class="python-operator">==</span> <span class="python-string">''</span><span class="python-operator">:</span>
<a name="L1735" class="line-number">1735 </a>            <span class="python-comment"># not a list value</span>
<a name="L1736" class="line-number">1736 </a>            <span class="python-keyword">return</span> <span class="python-operator">(</span><span class="python-name">single</span><span class="python-operator">,</span> <span class="python-name">comment</span><span class="python-operator">)</span>
<a name="L1737" class="line-number">1737 </a>        <span class="python-name">the_list</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_listvalueexp</span><span class="python-operator">.</span><span class="python-name">findall</span><span class="python-operator">(</span><span class="python-name">list_values</span><span class="python-operator">)</span>
<a name="L1738" class="line-number">1738 </a>        <span class="python-name">the_list</span> <span class="python-operator">=</span> <span class="python-operator">[</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_unquote</span><span class="python-operator">(</span><span class="python-name">val</span><span class="python-operator">)</span> <span class="python-keyword">for</span> <span class="python-name">val</span> <span class="python-keyword">in</span> <span class="python-name">the_list</span><span class="python-operator">]</span>
<a name="L1739" class="line-number">1739 </a>        <span class="python-keyword">if</span> <span class="python-name">single</span> <span class="python-keyword">is</span> <span class="python-keyword">not</span> <span class="python-name">None</span><span class="python-operator">:</span>
<a name="L1740" class="line-number">1740 </a>            <span class="python-name">the_list</span> <span class="python-operator">+=</span> <span class="python-operator">[</span><span class="python-name">single</span><span class="python-operator">]</span>
<a name="L1741" class="line-number">1741 </a>        <span class="python-keyword">return</span> <span class="python-operator">(</span><span class="python-name">the_list</span><span class="python-operator">,</span> <span class="python-name">comment</span><span class="python-operator">)</span>
<a name="L1742" class="line-number">1742 </a>
<a name="L1743" class="line-number">1743 </a>    <span class="python-keyword">def</span> <span class="python-name">_multiline</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">value</span><span class="python-operator">,</span> <span class="python-name">infile</span><span class="python-operator">,</span> <span class="python-name">cur_index</span><span class="python-operator">,</span> <span class="python-name">maxline</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1744" class="line-number">1744 </a>        <span class="python-string">"""Extract the value, where we are in a multiline situation."""</span>
<a name="L1745" class="line-number">1745 </a>        <span class="python-name">quot</span> <span class="python-operator">=</span> <span class="python-name">value</span><span class="python-operator">[</span><span class="python-operator">:</span><span class="python-number">3</span><span class="python-operator">]</span>
<a name="L1746" class="line-number">1746 </a>        <span class="python-name">newvalue</span> <span class="python-operator">=</span> <span class="python-name">value</span><span class="python-operator">[</span><span class="python-number">3</span><span class="python-operator">:</span><span class="python-operator">]</span>
<a name="L1747" class="line-number">1747 </a>        <span class="python-name">single_line</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_triple_quote</span><span class="python-operator">[</span><span class="python-name">quot</span><span class="python-operator">]</span><span class="python-operator">[</span><span class="python-number">0</span><span class="python-operator">]</span>
<a name="L1748" class="line-number">1748 </a>        <span class="python-name">multi_line</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_triple_quote</span><span class="python-operator">[</span><span class="python-name">quot</span><span class="python-operator">]</span><span class="python-operator">[</span><span class="python-number">1</span><span class="python-operator">]</span>
<a name="L1749" class="line-number">1749 </a>        <span class="python-name">mat</span> <span class="python-operator">=</span> <span class="python-name">single_line</span><span class="python-operator">.</span><span class="python-name">match</span><span class="python-operator">(</span><span class="python-name">value</span><span class="python-operator">)</span>
<a name="L1750" class="line-number">1750 </a>        <span class="python-keyword">if</span> <span class="python-name">mat</span> <span class="python-keyword">is</span> <span class="python-keyword">not</span> <span class="python-name">None</span><span class="python-operator">:</span>
<a name="L1751" class="line-number">1751 </a>            <span class="python-name">retval</span> <span class="python-operator">=</span> <span class="python-name">list</span><span class="python-operator">(</span><span class="python-name">mat</span><span class="python-operator">.</span><span class="python-name">groups</span><span class="python-operator">(</span><span class="python-operator">)</span><span class="python-operator">)</span>
<a name="L1752" class="line-number">1752 </a>            <span class="python-name">retval</span><span class="python-operator">.</span><span class="python-name">append</span><span class="python-operator">(</span><span class="python-name">cur_index</span><span class="python-operator">)</span>
<a name="L1753" class="line-number">1753 </a>            <span class="python-keyword">return</span> <span class="python-name">retval</span>
<a name="L1754" class="line-number">1754 </a>        <span class="python-keyword">elif</span> <span class="python-name">newvalue</span><span class="python-operator">.</span><span class="python-name">find</span><span class="python-operator">(</span><span class="python-name">quot</span><span class="python-operator">)</span> <span class="python-operator">!=</span> <span class="python-operator">-</span><span class="python-number">1</span><span class="python-operator">:</span>
<a name="L1755" class="line-number">1755 </a>            <span class="python-comment"># somehow the triple quote is missing</span>
<a name="L1756" class="line-number">1756 </a>            <span class="python-keyword">raise</span> <span class="python-name">SyntaxError</span>
<a name="L1757" class="line-number">1757 </a>        <span class="python-comment">#</span>
<a name="L1758" class="line-number">1758 </a>        <span class="python-keyword">while</span> <span class="python-name">cur_index</span> <span class="python-operator">&lt;</span> <span class="python-name">maxline</span><span class="python-operator">:</span>
<a name="L1759" class="line-number">1759 </a>            <span class="python-name">cur_index</span> <span class="python-operator">+=</span> <span class="python-number">1</span>
<a name="L1760" class="line-number">1760 </a>            <span class="python-name">newvalue</span> <span class="python-operator">+=</span> <span class="python-string">'\n'</span>
<a name="L1761" class="line-number">1761 </a>            <span class="python-name">line</span> <span class="python-operator">=</span> <span class="python-name">infile</span><span class="python-operator">[</span><span class="python-name">cur_index</span><span class="python-operator">]</span>
<a name="L1762" class="line-number">1762 </a>            <span class="python-keyword">if</span> <span class="python-name">line</span><span class="python-operator">.</span><span class="python-name">find</span><span class="python-operator">(</span><span class="python-name">quot</span><span class="python-operator">)</span> <span class="python-operator">==</span> <span class="python-operator">-</span><span class="python-number">1</span><span class="python-operator">:</span>
<a name="L1763" class="line-number">1763 </a>                <span class="python-name">newvalue</span> <span class="python-operator">+=</span> <span class="python-name">line</span>
<a name="L1764" class="line-number">1764 </a>            <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L1765" class="line-number">1765 </a>                <span class="python-comment"># end of multiline, process it</span>
<a name="L1766" class="line-number">1766 </a>                <span class="python-keyword">break</span>
<a name="L1767" class="line-number">1767 </a>        <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L1768" class="line-number">1768 </a>            <span class="python-comment"># we've got to the end of the config, oops...</span>
<a name="L1769" class="line-number">1769 </a>            <span class="python-keyword">raise</span> <span class="python-name">SyntaxError</span>
<a name="L1770" class="line-number">1770 </a>        <span class="python-name">mat</span> <span class="python-operator">=</span> <span class="python-name">multi_line</span><span class="python-operator">.</span><span class="python-name">match</span><span class="python-operator">(</span><span class="python-name">line</span><span class="python-operator">)</span>
<a name="L1771" class="line-number">1771 </a>        <span class="python-keyword">if</span> <span class="python-name">mat</span> <span class="python-keyword">is</span> <span class="python-name">None</span><span class="python-operator">:</span>
<a name="L1772" class="line-number">1772 </a>            <span class="python-comment"># a badly formed line</span>
<a name="L1773" class="line-number">1773 </a>            <span class="python-keyword">raise</span> <span class="python-name">SyntaxError</span>
<a name="L1774" class="line-number">1774 </a>        <span class="python-operator">(</span><span class="python-name">value</span><span class="python-operator">,</span> <span class="python-name">comment</span><span class="python-operator">)</span> <span class="python-operator">=</span> <span class="python-name">mat</span><span class="python-operator">.</span><span class="python-name">groups</span><span class="python-operator">(</span><span class="python-operator">)</span>
<a name="L1775" class="line-number">1775 </a>        <span class="python-keyword">return</span> <span class="python-operator">(</span><span class="python-name">newvalue</span> <span class="python-operator">+</span> <span class="python-name">value</span><span class="python-operator">,</span> <span class="python-name">comment</span><span class="python-operator">,</span> <span class="python-name">cur_index</span><span class="python-operator">)</span>
<a name="L1776" class="line-number">1776 </a>
<a name="L1777" class="line-number">1777 </a>    <span class="python-keyword">def</span> <span class="python-name">_handle_configspec</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">configspec</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1778" class="line-number">1778 </a>        <span class="python-string">"""Parse the configspec."""</span>
<a name="L1779" class="line-number">1779 </a>        <span class="python-comment"># FIXME: Should we check that the configspec was created with the </span>
<a name="L1780" class="line-number">1780 </a>        <span class="python-comment">#   correct settings ? (i.e. ``list_values=False``)</span>
<a name="L1781" class="line-number">1781 </a>        <span class="python-keyword">if</span> <span class="python-keyword">not</span> <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">configspec</span><span class="python-operator">,</span> <span class="python-name">ConfigObj</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1782" class="line-number">1782 </a>            <span class="python-keyword">try</span><span class="python-operator">:</span>
<a name="L1783" class="line-number">1783 </a>                <span class="python-name">configspec</span> <span class="python-operator">=</span> <span class="python-name">ConfigObj</span><span class="python-operator">(</span>
<a name="L1784" class="line-number">1784 </a>                    <span class="python-name">configspec</span><span class="python-operator">,</span>
<a name="L1785" class="line-number">1785 </a>                    <span class="python-name">raise_errors</span><span class="python-operator">=</span><span class="python-name">True</span><span class="python-operator">,</span>
<a name="L1786" class="line-number">1786 </a>                    <span class="python-name">file_error</span><span class="python-operator">=</span><span class="python-name">True</span><span class="python-operator">,</span>
<a name="L1787" class="line-number">1787 </a>                    <span class="python-name">list_values</span><span class="python-operator">=</span><span class="python-name">False</span><span class="python-operator">)</span>
<a name="L1788" class="line-number">1788 </a>            <span class="python-keyword">except</span> <span class="python-name">ConfigObjError</span><span class="python-operator">,</span> <span class="python-name">e</span><span class="python-operator">:</span>
<a name="L1789" class="line-number">1789 </a>                <span class="python-comment"># FIXME: Should these errors have a reference</span>
<a name="L1790" class="line-number">1790 </a>                <span class="python-comment"># to the already parsed ConfigObj ?</span>
<a name="L1791" class="line-number">1791 </a>                <span class="python-keyword">raise</span> <span class="python-name">ConfigspecError</span><span class="python-operator">(</span><span class="python-string">'Parsing configspec failed: %s'</span> <span class="python-operator">%</span> <span class="python-name">e</span><span class="python-operator">)</span>
<a name="L1792" class="line-number">1792 </a>            <span class="python-keyword">except</span> <span class="python-name">IOError</span><span class="python-operator">,</span> <span class="python-name">e</span><span class="python-operator">:</span>
<a name="L1793" class="line-number">1793 </a>                <span class="python-keyword">raise</span> <span class="python-name">IOError</span><span class="python-operator">(</span><span class="python-string">'Reading configspec failed: %s'</span> <span class="python-operator">%</span> <span class="python-name">e</span><span class="python-operator">)</span>
<a name="L1794" class="line-number">1794 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_set_configspec_value</span><span class="python-operator">(</span><span class="python-name">configspec</span><span class="python-operator">,</span> <span class="python-name">self</span><span class="python-operator">)</span>
<a name="L1795" class="line-number">1795 </a>
<a name="L1796" class="line-number">1796 </a>    <span class="python-keyword">def</span> <span class="python-name">_set_configspec_value</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">configspec</span><span class="python-operator">,</span> <span class="python-name">section</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1797" class="line-number">1797 </a>        <span class="python-string">"""Used to recursively set configspec values."""</span>
<a name="L1798" class="line-number">1798 </a>        <span class="python-keyword">if</span> <span class="python-string">'__many__'</span> <span class="python-keyword">in</span> <span class="python-name">configspec</span><span class="python-operator">.</span><span class="python-name">sections</span><span class="python-operator">:</span>
<a name="L1799" class="line-number">1799 </a>            <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">configspec</span><span class="python-operator">[</span><span class="python-string">'__many__'</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-name">configspec</span><span class="python-operator">[</span><span class="python-string">'__many__'</span><span class="python-operator">]</span>
<a name="L1800" class="line-number">1800 </a>            <span class="python-keyword">if</span> <span class="python-name">len</span><span class="python-operator">(</span><span class="python-name">configspec</span><span class="python-operator">.</span><span class="python-name">sections</span><span class="python-operator">)</span> <span class="python-operator">&gt;</span> <span class="python-number">1</span><span class="python-operator">:</span>
<a name="L1801" class="line-number">1801 </a>                <span class="python-comment"># FIXME: can we supply any useful information here ?</span>
<a name="L1802" class="line-number">1802 </a>                <span class="python-keyword">raise</span> <span class="python-name">RepeatSectionError</span>
<a name="L1803" class="line-number">1803 </a>        <span class="python-keyword">if</span> <span class="python-name">hasattr</span><span class="python-operator">(</span><span class="python-name">configspec</span><span class="python-operator">,</span> <span class="python-string">'initial_comment'</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1804" class="line-number">1804 </a>            <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">_configspec_initial_comment</span> <span class="python-operator">=</span> <span class="python-name">configspec</span><span class="python-operator">.</span><span class="python-name">initial_comment</span>
<a name="L1805" class="line-number">1805 </a>            <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">_configspec_final_comment</span> <span class="python-operator">=</span> <span class="python-name">configspec</span><span class="python-operator">.</span><span class="python-name">final_comment</span>
<a name="L1806" class="line-number">1806 </a>            <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">_configspec_encoding</span> <span class="python-operator">=</span> <span class="python-name">configspec</span><span class="python-operator">.</span><span class="python-name">encoding</span>
<a name="L1807" class="line-number">1807 </a>            <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">_configspec_BOM</span> <span class="python-operator">=</span> <span class="python-name">configspec</span><span class="python-operator">.</span><span class="python-name">BOM</span>
<a name="L1808" class="line-number">1808 </a>            <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">_configspec_newlines</span> <span class="python-operator">=</span> <span class="python-name">configspec</span><span class="python-operator">.</span><span class="python-name">newlines</span>
<a name="L1809" class="line-number">1809 </a>            <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">_configspec_indent_type</span> <span class="python-operator">=</span> <span class="python-name">configspec</span><span class="python-operator">.</span><span class="python-name">indent_type</span>
<a name="L1810" class="line-number">1810 </a>        <span class="python-keyword">for</span> <span class="python-name">entry</span> <span class="python-keyword">in</span> <span class="python-name">configspec</span><span class="python-operator">.</span><span class="python-name">scalars</span><span class="python-operator">:</span>
<a name="L1811" class="line-number">1811 </a>            <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">_configspec_comments</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-name">configspec</span><span class="python-operator">.</span><span class="python-name">comments</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span>
<a name="L1812" class="line-number">1812 </a>            <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">_configspec_inline_comments</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-operator">(</span>
<a name="L1813" class="line-number">1813 </a>                <span class="python-name">configspec</span><span class="python-operator">.</span><span class="python-name">inline_comments</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span><span class="python-operator">)</span>
<a name="L1814" class="line-number">1814 </a>            <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">configspec</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-name">configspec</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span>
<a name="L1815" class="line-number">1815 </a>            <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">_order</span><span class="python-operator">.</span><span class="python-name">append</span><span class="python-operator">(</span><span class="python-name">entry</span><span class="python-operator">)</span>
<a name="L1816" class="line-number">1816 </a>        <span class="python-keyword">for</span> <span class="python-name">entry</span> <span class="python-keyword">in</span> <span class="python-name">configspec</span><span class="python-operator">.</span><span class="python-name">sections</span><span class="python-operator">:</span>
<a name="L1817" class="line-number">1817 </a>            <span class="python-keyword">if</span> <span class="python-name">entry</span> <span class="python-operator">==</span> <span class="python-string">'__many__'</span><span class="python-operator">:</span>
<a name="L1818" class="line-number">1818 </a>                <span class="python-keyword">continue</span>
<a name="L1819" class="line-number">1819 </a>            <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">_cs_section_comments</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-name">configspec</span><span class="python-operator">.</span><span class="python-name">comments</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span>
<a name="L1820" class="line-number">1820 </a>            <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">_cs_section_inline_comments</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-operator">(</span>
<a name="L1821" class="line-number">1821 </a>                <span class="python-name">configspec</span><span class="python-operator">.</span><span class="python-name">inline_comments</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span><span class="python-operator">)</span>
<a name="L1822" class="line-number">1822 </a>            <span class="python-keyword">if</span> <span class="python-keyword">not</span> <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">has_key</span><span class="python-operator">(</span><span class="python-name">entry</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1823" class="line-number">1823 </a>                <span class="python-name">section</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-operator">{</span><span class="python-operator">}</span>
<a name="L1824" class="line-number">1824 </a>            <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_set_configspec_value</span><span class="python-operator">(</span><span class="python-name">configspec</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span><span class="python-operator">,</span> <span class="python-name">section</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span><span class="python-operator">)</span>
<a name="L1825" class="line-number">1825 </a>
<a name="L1826" class="line-number">1826 </a>    <span class="python-keyword">def</span> <span class="python-name">_handle_repeat</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">section</span><span class="python-operator">,</span> <span class="python-name">configspec</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1827" class="line-number">1827 </a>        <span class="python-string">"""Dynamically assign configspec for repeated section."""</span>
<a name="L1828" class="line-number">1828 </a>        <span class="python-keyword">try</span><span class="python-operator">:</span>
<a name="L1829" class="line-number">1829 </a>            <span class="python-name">section_keys</span> <span class="python-operator">=</span> <span class="python-name">configspec</span><span class="python-operator">.</span><span class="python-name">sections</span>
<a name="L1830" class="line-number">1830 </a>            <span class="python-name">scalar_keys</span> <span class="python-operator">=</span> <span class="python-name">configspec</span><span class="python-operator">.</span><span class="python-name">scalars</span>
<a name="L1831" class="line-number">1831 </a>        <span class="python-keyword">except</span> <span class="python-name">AttributeError</span><span class="python-operator">:</span>
<a name="L1832" class="line-number">1832 </a>            <span class="python-name">section_keys</span> <span class="python-operator">=</span> <span class="python-operator">[</span><span class="python-name">entry</span> <span class="python-keyword">for</span> <span class="python-name">entry</span> <span class="python-keyword">in</span> <span class="python-name">configspec</span>
<a name="L1833" class="line-number">1833 </a>                                <span class="python-keyword">if</span> <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">configspec</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span><span class="python-operator">,</span> <span class="python-name">dict</span><span class="python-operator">)</span><span class="python-operator">]</span>
<a name="L1834" class="line-number">1834 </a>            <span class="python-name">scalar_keys</span> <span class="python-operator">=</span> <span class="python-operator">[</span><span class="python-name">entry</span> <span class="python-keyword">for</span> <span class="python-name">entry</span> <span class="python-keyword">in</span> <span class="python-name">configspec</span>
<a name="L1835" class="line-number">1835 </a>                                <span class="python-keyword">if</span> <span class="python-keyword">not</span> <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">configspec</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span><span class="python-operator">,</span> <span class="python-name">dict</span><span class="python-operator">)</span><span class="python-operator">]</span>
<a name="L1836" class="line-number">1836 </a>        <span class="python-keyword">if</span> <span class="python-string">'__many__'</span> <span class="python-keyword">in</span> <span class="python-name">section_keys</span> <span class="python-keyword">and</span> <span class="python-name">len</span><span class="python-operator">(</span><span class="python-name">section_keys</span><span class="python-operator">)</span> <span class="python-operator">&gt;</span> <span class="python-number">1</span><span class="python-operator">:</span>
<a name="L1837" class="line-number">1837 </a>            <span class="python-comment"># FIXME: can we supply any useful information here ?</span>
<a name="L1838" class="line-number">1838 </a>            <span class="python-keyword">raise</span> <span class="python-name">RepeatSectionError</span>
<a name="L1839" class="line-number">1839 </a>        <span class="python-name">scalars</span> <span class="python-operator">=</span> <span class="python-operator">{</span><span class="python-operator">}</span>
<a name="L1840" class="line-number">1840 </a>        <span class="python-name">sections</span> <span class="python-operator">=</span> <span class="python-operator">{</span><span class="python-operator">}</span>
<a name="L1841" class="line-number">1841 </a>        <span class="python-keyword">for</span> <span class="python-name">entry</span> <span class="python-keyword">in</span> <span class="python-name">scalar_keys</span><span class="python-operator">:</span>
<a name="L1842" class="line-number">1842 </a>            <span class="python-name">val</span> <span class="python-operator">=</span> <span class="python-name">configspec</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span>
<a name="L1843" class="line-number">1843 </a>            <span class="python-name">scalars</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-name">val</span>
<a name="L1844" class="line-number">1844 </a>        <span class="python-keyword">for</span> <span class="python-name">entry</span> <span class="python-keyword">in</span> <span class="python-name">section_keys</span><span class="python-operator">:</span>
<a name="L1845" class="line-number">1845 </a>            <span class="python-name">val</span> <span class="python-operator">=</span> <span class="python-name">configspec</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span>
<a name="L1846" class="line-number">1846 </a>            <span class="python-keyword">if</span> <span class="python-name">entry</span> <span class="python-operator">==</span> <span class="python-string">'__many__'</span><span class="python-operator">:</span>
<a name="L1847" class="line-number">1847 </a>                <span class="python-name">scalars</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-name">val</span>
<a name="L1848" class="line-number">1848 </a>                <span class="python-keyword">continue</span>
<a name="L1849" class="line-number">1849 </a>            <span class="python-name">sections</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-name">val</span>
<a name="L1850" class="line-number">1850 </a>        <span class="python-comment">#</span>
<a name="L1851" class="line-number">1851 </a>        <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">configspec</span> <span class="python-operator">=</span> <span class="python-name">scalars</span>
<a name="L1852" class="line-number">1852 </a>        <span class="python-keyword">for</span> <span class="python-name">entry</span> <span class="python-keyword">in</span> <span class="python-name">sections</span><span class="python-operator">:</span>
<a name="L1853" class="line-number">1853 </a>            <span class="python-keyword">if</span> <span class="python-keyword">not</span> <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">has_key</span><span class="python-operator">(</span><span class="python-name">entry</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1854" class="line-number">1854 </a>                <span class="python-name">section</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-operator">{</span><span class="python-operator">}</span>
<a name="L1855" class="line-number">1855 </a>            <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_handle_repeat</span><span class="python-operator">(</span><span class="python-name">section</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span><span class="python-operator">,</span> <span class="python-name">sections</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span><span class="python-operator">)</span>
<a name="L1856" class="line-number">1856 </a>
<a name="L1857" class="line-number">1857 </a>    <span class="python-keyword">def</span> <span class="python-name">_write_line</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">indent_string</span><span class="python-operator">,</span> <span class="python-name">entry</span><span class="python-operator">,</span> <span class="python-name">this_entry</span><span class="python-operator">,</span> <span class="python-name">comment</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1858" class="line-number">1858 </a>        <span class="python-string">"""Write an individual line, for the write method"""</span>
<a name="L1859" class="line-number">1859 </a>        <span class="python-comment"># NOTE: the calls to self._quote here handles non-StringType values.</span>
<a name="L1860" class="line-number">1860 </a>        <span class="python-keyword">if</span> <span class="python-keyword">not</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">unrepr</span><span class="python-operator">:</span>
<a name="L1861" class="line-number">1861 </a>            <span class="python-name">val</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_decode_element</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_quote</span><span class="python-operator">(</span><span class="python-name">this_entry</span><span class="python-operator">)</span><span class="python-operator">)</span>
<a name="L1862" class="line-number">1862 </a>        <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L1863" class="line-number">1863 </a>            <span class="python-name">val</span> <span class="python-operator">=</span> <span class="python-name">repr</span><span class="python-operator">(</span><span class="python-name">this_entry</span><span class="python-operator">)</span>
<a name="L1864" class="line-number">1864 </a>        <span class="python-keyword">return</span> <span class="python-string">'%s%s%s%s%s'</span> <span class="python-operator">%</span> <span class="python-operator">(</span>
<a name="L1865" class="line-number">1865 </a>            <span class="python-name">indent_string</span><span class="python-operator">,</span>
<a name="L1866" class="line-number">1866 </a>            <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_decode_element</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_quote</span><span class="python-operator">(</span><span class="python-name">entry</span><span class="python-operator">,</span> <span class="python-name">multiline</span><span class="python-operator">=</span><span class="python-name">False</span><span class="python-operator">)</span><span class="python-operator">)</span><span class="python-operator">,</span>
<a name="L1867" class="line-number">1867 </a>            <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_a_to_u</span><span class="python-operator">(</span><span class="python-string">' = '</span><span class="python-operator">)</span><span class="python-operator">,</span>
<a name="L1868" class="line-number">1868 </a>            <span class="python-name">val</span><span class="python-operator">,</span>
<a name="L1869" class="line-number">1869 </a>            <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_decode_element</span><span class="python-operator">(</span><span class="python-name">comment</span><span class="python-operator">)</span><span class="python-operator">)</span>
<a name="L1870" class="line-number">1870 </a>
<a name="L1871" class="line-number">1871 </a>    <span class="python-keyword">def</span> <span class="python-name">_write_marker</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">indent_string</span><span class="python-operator">,</span> <span class="python-name">depth</span><span class="python-operator">,</span> <span class="python-name">entry</span><span class="python-operator">,</span> <span class="python-name">comment</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1872" class="line-number">1872 </a>        <span class="python-string">"""Write a section marker line"""</span>
<a name="L1873" class="line-number">1873 </a>        <span class="python-keyword">return</span> <span class="python-string">'%s%s%s%s%s'</span> <span class="python-operator">%</span> <span class="python-operator">(</span>
<a name="L1874" class="line-number">1874 </a>            <span class="python-name">indent_string</span><span class="python-operator">,</span>
<a name="L1875" class="line-number">1875 </a>            <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_a_to_u</span><span class="python-operator">(</span><span class="python-string">'['</span> <span class="python-operator">*</span> <span class="python-name">depth</span><span class="python-operator">)</span><span class="python-operator">,</span>
<a name="L1876" class="line-number">1876 </a>            <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_quote</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_decode_element</span><span class="python-operator">(</span><span class="python-name">entry</span><span class="python-operator">)</span><span class="python-operator">,</span> <span class="python-name">multiline</span><span class="python-operator">=</span><span class="python-name">False</span><span class="python-operator">)</span><span class="python-operator">,</span>
<a name="L1877" class="line-number">1877 </a>            <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_a_to_u</span><span class="python-operator">(</span><span class="python-string">']'</span> <span class="python-operator">*</span> <span class="python-name">depth</span><span class="python-operator">)</span><span class="python-operator">,</span>
<a name="L1878" class="line-number">1878 </a>            <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_decode_element</span><span class="python-operator">(</span><span class="python-name">comment</span><span class="python-operator">)</span><span class="python-operator">)</span>
<a name="L1879" class="line-number">1879 </a>
<a name="L1880" class="line-number">1880 </a>    <span class="python-keyword">def</span> <span class="python-name">_handle_comment</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">comment</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1881" class="line-number">1881 </a>        <span class="python-string">"""Deal with a comment."""</span>
<a name="L1882" class="line-number">1882 </a>        <span class="python-keyword">if</span> <span class="python-keyword">not</span> <span class="python-name">comment</span><span class="python-operator">:</span>
<a name="L1883" class="line-number">1883 </a>            <span class="python-keyword">return</span> <span class="python-string">''</span>
<a name="L1884" class="line-number">1884 </a>        <span class="python-name">start</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">indent_type</span>
<a name="L1885" class="line-number">1885 </a>        <span class="python-keyword">if</span> <span class="python-keyword">not</span> <span class="python-name">comment</span><span class="python-operator">.</span><span class="python-name">startswith</span><span class="python-operator">(</span><span class="python-string">'#'</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1886" class="line-number">1886 </a>            <span class="python-name">start</span> <span class="python-operator">+=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_a_to_u</span><span class="python-operator">(</span><span class="python-string">' # '</span><span class="python-operator">)</span>
<a name="L1887" class="line-number">1887 </a>        <span class="python-keyword">return</span> <span class="python-operator">(</span><span class="python-name">start</span> <span class="python-operator">+</span> <span class="python-name">comment</span><span class="python-operator">)</span>
<a name="L1888" class="line-number">1888 </a>
<a name="L1889" class="line-number">1889 </a>    <span class="python-comment"># Public methods</span>
<a name="L1890" class="line-number">1890 </a>
<a name="L1891" class="line-number">1891 </a>    <span class="python-keyword">def</span> <span class="python-name">write</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">outfile</span><span class="python-operator">=</span><span class="python-name">None</span><span class="python-operator">,</span> <span class="python-name">section</span><span class="python-operator">=</span><span class="python-name">None</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1892" class="line-number">1892 </a>        <span class="python-string">"""
<a name="L1893" class="line-number">1893 </a>        Write the current ConfigObj as a file
<a name="L1894" class="line-number">1894 </a>        
<a name="L1895" class="line-number">1895 </a>        tekNico: FIXME: use StringIO instead of real files
<a name="L1896" class="line-number">1896 </a>        
<a name="L1897" class="line-number">1897 </a>        &gt;&gt;&gt; filename = a.filename
<a name="L1898" class="line-number">1898 </a>        &gt;&gt;&gt; a.filename = 'test.ini'
<a name="L1899" class="line-number">1899 </a>        &gt;&gt;&gt; a.write()
<a name="L1900" class="line-number">1900 </a>        &gt;&gt;&gt; a.filename = filename
<a name="L1901" class="line-number">1901 </a>        &gt;&gt;&gt; a == ConfigObj('test.ini', raise_errors=True)
<a name="L1902" class="line-number">1902 </a>        1
<a name="L1903" class="line-number">1903 </a>        """</span>
<a name="L1904" class="line-number">1904 </a>        <span class="python-keyword">if</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">indent_type</span> <span class="python-keyword">is</span> <span class="python-name">None</span><span class="python-operator">:</span>
<a name="L1905" class="line-number">1905 </a>            <span class="python-comment"># this can be true if initialised from a dictionary</span>
<a name="L1906" class="line-number">1906 </a>            <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">indent_type</span> <span class="python-operator">=</span> <span class="python-name">DEFAULT_INDENT_TYPE</span>
<a name="L1907" class="line-number">1907 </a>        <span class="python-comment">#</span>
<a name="L1908" class="line-number">1908 </a>        <span class="python-name">out</span> <span class="python-operator">=</span> <span class="python-operator">[</span><span class="python-operator">]</span>
<a name="L1909" class="line-number">1909 </a>        <span class="python-name">cs</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_a_to_u</span><span class="python-operator">(</span><span class="python-string">'#'</span><span class="python-operator">)</span>
<a name="L1910" class="line-number">1910 </a>        <span class="python-name">csp</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_a_to_u</span><span class="python-operator">(</span><span class="python-string">'# '</span><span class="python-operator">)</span>
<a name="L1911" class="line-number">1911 </a>        <span class="python-keyword">if</span> <span class="python-name">section</span> <span class="python-keyword">is</span> <span class="python-name">None</span><span class="python-operator">:</span>
<a name="L1912" class="line-number">1912 </a>            <span class="python-name">int_val</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">interpolation</span>
<a name="L1913" class="line-number">1913 </a>            <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">interpolation</span> <span class="python-operator">=</span> <span class="python-name">False</span>
<a name="L1914" class="line-number">1914 </a>            <span class="python-name">section</span> <span class="python-operator">=</span> <span class="python-name">self</span>
<a name="L1915" class="line-number">1915 </a>            <span class="python-keyword">for</span> <span class="python-name">line</span> <span class="python-keyword">in</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">initial_comment</span><span class="python-operator">:</span>
<a name="L1916" class="line-number">1916 </a>                <span class="python-name">line</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_decode_element</span><span class="python-operator">(</span><span class="python-name">line</span><span class="python-operator">)</span>
<a name="L1917" class="line-number">1917 </a>                <span class="python-name">stripped_line</span> <span class="python-operator">=</span> <span class="python-name">line</span><span class="python-operator">.</span><span class="python-name">strip</span><span class="python-operator">(</span><span class="python-operator">)</span>
<a name="L1918" class="line-number">1918 </a>                <span class="python-keyword">if</span> <span class="python-name">stripped_line</span> <span class="python-keyword">and</span> <span class="python-keyword">not</span> <span class="python-name">stripped_line</span><span class="python-operator">.</span><span class="python-name">startswith</span><span class="python-operator">(</span><span class="python-name">cs</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1919" class="line-number">1919 </a>                    <span class="python-name">line</span> <span class="python-operator">=</span> <span class="python-name">csp</span> <span class="python-operator">+</span> <span class="python-name">line</span>
<a name="L1920" class="line-number">1920 </a>                <span class="python-name">out</span><span class="python-operator">.</span><span class="python-name">append</span><span class="python-operator">(</span><span class="python-name">line</span><span class="python-operator">)</span>
<a name="L1921" class="line-number">1921 </a>        <span class="python-comment">#</span>
<a name="L1922" class="line-number">1922 </a>        <span class="python-name">indent_string</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">indent_type</span> <span class="python-operator">*</span> <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">depth</span>
<a name="L1923" class="line-number">1923 </a>        <span class="python-keyword">for</span> <span class="python-name">entry</span> <span class="python-keyword">in</span> <span class="python-operator">(</span><span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">scalars</span> <span class="python-operator">+</span> <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">sections</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1924" class="line-number">1924 </a>            <span class="python-keyword">if</span> <span class="python-name">entry</span> <span class="python-keyword">in</span> <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">defaults</span><span class="python-operator">:</span>
<a name="L1925" class="line-number">1925 </a>                <span class="python-comment"># don't write out default values</span>
<a name="L1926" class="line-number">1926 </a>                <span class="python-keyword">continue</span>
<a name="L1927" class="line-number">1927 </a>            <span class="python-keyword">for</span> <span class="python-name">comment_line</span> <span class="python-keyword">in</span> <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">comments</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span><span class="python-operator">:</span>
<a name="L1928" class="line-number">1928 </a>                <span class="python-name">comment_line</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_decode_element</span><span class="python-operator">(</span><span class="python-name">comment_line</span><span class="python-operator">.</span><span class="python-name">lstrip</span><span class="python-operator">(</span><span class="python-operator">)</span><span class="python-operator">)</span>
<a name="L1929" class="line-number">1929 </a>                <span class="python-keyword">if</span> <span class="python-name">comment_line</span> <span class="python-keyword">and</span> <span class="python-keyword">not</span> <span class="python-name">comment_line</span><span class="python-operator">.</span><span class="python-name">startswith</span><span class="python-operator">(</span><span class="python-name">cs</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1930" class="line-number">1930 </a>                    <span class="python-name">comment_line</span> <span class="python-operator">=</span> <span class="python-name">csp</span> <span class="python-operator">+</span> <span class="python-name">comment_line</span>
<a name="L1931" class="line-number">1931 </a>                <span class="python-name">out</span><span class="python-operator">.</span><span class="python-name">append</span><span class="python-operator">(</span><span class="python-name">indent_string</span> <span class="python-operator">+</span> <span class="python-name">comment_line</span><span class="python-operator">)</span>
<a name="L1932" class="line-number">1932 </a>            <span class="python-name">this_entry</span> <span class="python-operator">=</span> <span class="python-name">section</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span>
<a name="L1933" class="line-number">1933 </a>            <span class="python-name">comment</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_handle_comment</span><span class="python-operator">(</span><span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">inline_comments</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span><span class="python-operator">)</span>
<a name="L1934" class="line-number">1934 </a>            <span class="python-comment">#</span>
<a name="L1935" class="line-number">1935 </a>            <span class="python-keyword">if</span> <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">this_entry</span><span class="python-operator">,</span> <span class="python-name">dict</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1936" class="line-number">1936 </a>                <span class="python-comment"># a section</span>
<a name="L1937" class="line-number">1937 </a>                <span class="python-name">out</span><span class="python-operator">.</span><span class="python-name">append</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_write_marker</span><span class="python-operator">(</span>
<a name="L1938" class="line-number">1938 </a>                    <span class="python-name">indent_string</span><span class="python-operator">,</span>
<a name="L1939" class="line-number">1939 </a>                    <span class="python-name">this_entry</span><span class="python-operator">.</span><span class="python-name">depth</span><span class="python-operator">,</span>
<a name="L1940" class="line-number">1940 </a>                    <span class="python-name">entry</span><span class="python-operator">,</span>
<a name="L1941" class="line-number">1941 </a>                    <span class="python-name">comment</span><span class="python-operator">)</span><span class="python-operator">)</span>
<a name="L1942" class="line-number">1942 </a>                <span class="python-name">out</span><span class="python-operator">.</span><span class="python-name">extend</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">write</span><span class="python-operator">(</span><span class="python-name">section</span><span class="python-operator">=</span><span class="python-name">this_entry</span><span class="python-operator">)</span><span class="python-operator">)</span>
<a name="L1943" class="line-number">1943 </a>            <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L1944" class="line-number">1944 </a>                <span class="python-name">out</span><span class="python-operator">.</span><span class="python-name">append</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_write_line</span><span class="python-operator">(</span>
<a name="L1945" class="line-number">1945 </a>                    <span class="python-name">indent_string</span><span class="python-operator">,</span>
<a name="L1946" class="line-number">1946 </a>                    <span class="python-name">entry</span><span class="python-operator">,</span>
<a name="L1947" class="line-number">1947 </a>                    <span class="python-name">this_entry</span><span class="python-operator">,</span>
<a name="L1948" class="line-number">1948 </a>                    <span class="python-name">comment</span><span class="python-operator">)</span><span class="python-operator">)</span>
<a name="L1949" class="line-number">1949 </a>        <span class="python-comment">#</span>
<a name="L1950" class="line-number">1950 </a>        <span class="python-keyword">if</span> <span class="python-name">section</span> <span class="python-keyword">is</span> <span class="python-name">self</span><span class="python-operator">:</span>
<a name="L1951" class="line-number">1951 </a>            <span class="python-keyword">for</span> <span class="python-name">line</span> <span class="python-keyword">in</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">final_comment</span><span class="python-operator">:</span>
<a name="L1952" class="line-number">1952 </a>                <span class="python-name">line</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_decode_element</span><span class="python-operator">(</span><span class="python-name">line</span><span class="python-operator">)</span>
<a name="L1953" class="line-number">1953 </a>                <span class="python-name">stripped_line</span> <span class="python-operator">=</span> <span class="python-name">line</span><span class="python-operator">.</span><span class="python-name">strip</span><span class="python-operator">(</span><span class="python-operator">)</span>
<a name="L1954" class="line-number">1954 </a>                <span class="python-keyword">if</span> <span class="python-name">stripped_line</span> <span class="python-keyword">and</span> <span class="python-keyword">not</span> <span class="python-name">stripped_line</span><span class="python-operator">.</span><span class="python-name">startswith</span><span class="python-operator">(</span><span class="python-name">cs</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1955" class="line-number">1955 </a>                    <span class="python-name">line</span> <span class="python-operator">=</span> <span class="python-name">csp</span> <span class="python-operator">+</span> <span class="python-name">line</span>
<a name="L1956" class="line-number">1956 </a>                <span class="python-name">out</span><span class="python-operator">.</span><span class="python-name">append</span><span class="python-operator">(</span><span class="python-name">line</span><span class="python-operator">)</span>
<a name="L1957" class="line-number">1957 </a>            <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">interpolation</span> <span class="python-operator">=</span> <span class="python-name">int_val</span>
<a name="L1958" class="line-number">1958 </a>        <span class="python-comment">#</span>
<a name="L1959" class="line-number">1959 </a>        <span class="python-keyword">if</span> <span class="python-name">section</span> <span class="python-keyword">is</span> <span class="python-keyword">not</span> <span class="python-name">self</span><span class="python-operator">:</span>
<a name="L1960" class="line-number">1960 </a>            <span class="python-keyword">return</span> <span class="python-name">out</span>
<a name="L1961" class="line-number">1961 </a>        <span class="python-comment">#</span>
<a name="L1962" class="line-number">1962 </a>        <span class="python-keyword">if</span> <span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">filename</span> <span class="python-keyword">is</span> <span class="python-name">None</span><span class="python-operator">)</span> <span class="python-keyword">and</span> <span class="python-operator">(</span><span class="python-name">outfile</span> <span class="python-keyword">is</span> <span class="python-name">None</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1963" class="line-number">1963 </a>            <span class="python-comment"># output a list of lines</span>
<a name="L1964" class="line-number">1964 </a>            <span class="python-comment"># might need to encode</span>
<a name="L1965" class="line-number">1965 </a>            <span class="python-comment"># NOTE: This will *screw* UTF16, each line will start with the BOM</span>
<a name="L1966" class="line-number">1966 </a>            <span class="python-keyword">if</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">encoding</span><span class="python-operator">:</span>
<a name="L1967" class="line-number">1967 </a>                <span class="python-name">out</span> <span class="python-operator">=</span> <span class="python-operator">[</span><span class="python-name">l</span><span class="python-operator">.</span><span class="python-name">encode</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">encoding</span><span class="python-operator">)</span> <span class="python-keyword">for</span> <span class="python-name">l</span> <span class="python-keyword">in</span> <span class="python-name">out</span><span class="python-operator">]</span>
<a name="L1968" class="line-number">1968 </a>            <span class="python-keyword">if</span> <span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">BOM</span> <span class="python-keyword">and</span> <span class="python-operator">(</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">encoding</span> <span class="python-keyword">is</span> <span class="python-name">None</span><span class="python-operator">)</span> <span class="python-keyword">or</span>
<a name="L1969" class="line-number">1969 </a>                <span class="python-operator">(</span><span class="python-name">BOM_LIST</span><span class="python-operator">.</span><span class="python-name">get</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">encoding</span><span class="python-operator">.</span><span class="python-name">lower</span><span class="python-operator">(</span><span class="python-operator">)</span><span class="python-operator">)</span> <span class="python-operator">==</span> <span class="python-string">'utf_8'</span><span class="python-operator">)</span><span class="python-operator">)</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1970" class="line-number">1970 </a>                <span class="python-comment"># Add the UTF8 BOM</span>
<a name="L1971" class="line-number">1971 </a>                <span class="python-keyword">if</span> <span class="python-keyword">not</span> <span class="python-name">out</span><span class="python-operator">:</span>
<a name="L1972" class="line-number">1972 </a>                    <span class="python-name">out</span><span class="python-operator">.</span><span class="python-name">append</span><span class="python-operator">(</span><span class="python-string">''</span><span class="python-operator">)</span>
<a name="L1973" class="line-number">1973 </a>                <span class="python-name">out</span><span class="python-operator">[</span><span class="python-number">0</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-name">BOM_UTF8</span> <span class="python-operator">+</span> <span class="python-name">out</span><span class="python-operator">[</span><span class="python-number">0</span><span class="python-operator">]</span>
<a name="L1974" class="line-number">1974 </a>            <span class="python-keyword">return</span> <span class="python-name">out</span>
<a name="L1975" class="line-number">1975 </a>        <span class="python-comment">#</span>
<a name="L1976" class="line-number">1976 </a>        <span class="python-comment"># Turn the list to a string, joined with correct newlines</span>
<a name="L1977" class="line-number">1977 </a>        <span class="python-name">output</span> <span class="python-operator">=</span> <span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_a_to_u</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">newlines</span> <span class="python-keyword">or</span> <span class="python-name">os</span><span class="python-operator">.</span><span class="python-name">linesep</span><span class="python-operator">)</span>
<a name="L1978" class="line-number">1978 </a>            <span class="python-operator">)</span><span class="python-operator">.</span><span class="python-name">join</span><span class="python-operator">(</span><span class="python-name">out</span><span class="python-operator">)</span>
<a name="L1979" class="line-number">1979 </a>        <span class="python-keyword">if</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">encoding</span><span class="python-operator">:</span>
<a name="L1980" class="line-number">1980 </a>            <span class="python-name">output</span> <span class="python-operator">=</span> <span class="python-name">output</span><span class="python-operator">.</span><span class="python-name">encode</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">encoding</span><span class="python-operator">)</span>
<a name="L1981" class="line-number">1981 </a>        <span class="python-keyword">if</span> <span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">BOM</span> <span class="python-keyword">and</span> <span class="python-operator">(</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">encoding</span> <span class="python-keyword">is</span> <span class="python-name">None</span><span class="python-operator">)</span> <span class="python-keyword">or</span>
<a name="L1982" class="line-number">1982 </a>            <span class="python-operator">(</span><span class="python-name">BOM_LIST</span><span class="python-operator">.</span><span class="python-name">get</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">encoding</span><span class="python-operator">.</span><span class="python-name">lower</span><span class="python-operator">(</span><span class="python-operator">)</span><span class="python-operator">)</span> <span class="python-operator">==</span> <span class="python-string">'utf_8'</span><span class="python-operator">)</span><span class="python-operator">)</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1983" class="line-number">1983 </a>            <span class="python-comment"># Add the UTF8 BOM</span>
<a name="L1984" class="line-number">1984 </a>            <span class="python-name">output</span> <span class="python-operator">=</span> <span class="python-name">BOM_UTF8</span> <span class="python-operator">+</span> <span class="python-name">output</span>
<a name="L1985" class="line-number">1985 </a>        <span class="python-keyword">if</span> <span class="python-name">outfile</span> <span class="python-keyword">is</span> <span class="python-keyword">not</span> <span class="python-name">None</span><span class="python-operator">:</span>
<a name="L1986" class="line-number">1986 </a>            <span class="python-name">outfile</span><span class="python-operator">.</span><span class="python-name">write</span><span class="python-operator">(</span><span class="python-name">output</span><span class="python-operator">)</span>
<a name="L1987" class="line-number">1987 </a>        <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L1988" class="line-number">1988 </a>            <span class="python-name">h</span> <span class="python-operator">=</span> <span class="python-name">open</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">filename</span><span class="python-operator">,</span> <span class="python-string">'wb'</span><span class="python-operator">)</span>
<a name="L1989" class="line-number">1989 </a>            <span class="python-name">h</span><span class="python-operator">.</span><span class="python-name">write</span><span class="python-operator">(</span><span class="python-name">output</span><span class="python-operator">)</span>
<a name="L1990" class="line-number">1990 </a>            <span class="python-name">h</span><span class="python-operator">.</span><span class="python-name">close</span><span class="python-operator">(</span><span class="python-operator">)</span>
<a name="L1991" class="line-number">1991 </a>
<a name="L1992" class="line-number">1992 </a>    <span class="python-keyword">def</span> <span class="python-name">validate</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">validator</span><span class="python-operator">,</span> <span class="python-name">preserve_errors</span><span class="python-operator">=</span><span class="python-name">False</span><span class="python-operator">,</span> <span class="python-name">copy</span><span class="python-operator">=</span><span class="python-name">False</span><span class="python-operator">,</span>
<a name="L1993" class="line-number">1993 </a>        <span class="python-name">section</span><span class="python-operator">=</span><span class="python-name">None</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L1994" class="line-number">1994 </a>        <span class="python-string">"""
<a name="L1995" class="line-number">1995 </a>        Test the ConfigObj against a configspec.
<a name="L1996" class="line-number">1996 </a>        
<a name="L1997" class="line-number">1997 </a>        It uses the ``validator`` object from *validate.py*.
<a name="L1998" class="line-number">1998 </a>        
<a name="L1999" class="line-number">1999 </a>        To run ``validate`` on the current ConfigObj, call: ::
<a name="L2000" class="line-number">2000 </a>        
<a name="L2001" class="line-number">2001 </a>            test = config.validate(validator)
<a name="L2002" class="line-number">2002 </a>        
<a name="L2003" class="line-number">2003 </a>        (Normally having previously passed in the configspec when the ConfigObj
<a name="L2004" class="line-number">2004 </a>        was created - you can dynamically assign a dictionary of checks to the
<a name="L2005" class="line-number">2005 </a>        ``configspec`` attribute of a section though).
<a name="L2006" class="line-number">2006 </a>        
<a name="L2007" class="line-number">2007 </a>        It returns ``True`` if everything passes, or a dictionary of
<a name="L2008" class="line-number">2008 </a>        pass/fails (True/False). If every member of a subsection passes, it
<a name="L2009" class="line-number">2009 </a>        will just have the value ``True``. (It also returns ``False`` if all
<a name="L2010" class="line-number">2010 </a>        members fail).
<a name="L2011" class="line-number">2011 </a>        
<a name="L2012" class="line-number">2012 </a>        In addition, it converts the values from strings to their native
<a name="L2013" class="line-number">2013 </a>        types if their checks pass (and ``stringify`` is set).
<a name="L2014" class="line-number">2014 </a>        
<a name="L2015" class="line-number">2015 </a>        If ``preserve_errors`` is ``True`` (``False`` is default) then instead
<a name="L2016" class="line-number">2016 </a>        of a marking a fail with a ``False``, it will preserve the actual
<a name="L2017" class="line-number">2017 </a>        exception object. This can contain info about the reason for failure.
<a name="L2018" class="line-number">2018 </a>        For example the ``VdtValueTooSmallError`` indeicates that the value
<a name="L2019" class="line-number">2019 </a>        supplied was too small. If a value (or section) is missing it will
<a name="L2020" class="line-number">2020 </a>        still be marked as ``False``.
<a name="L2021" class="line-number">2021 </a>        
<a name="L2022" class="line-number">2022 </a>        You must have the validate module to use ``preserve_errors=True``.
<a name="L2023" class="line-number">2023 </a>        
<a name="L2024" class="line-number">2024 </a>        You can then use the ``flatten_errors`` function to turn your nested
<a name="L2025" class="line-number">2025 </a>        results dictionary into a flattened list of failures - useful for
<a name="L2026" class="line-number">2026 </a>        displaying meaningful error messages.
<a name="L2027" class="line-number">2027 </a>        """</span>
<a name="L2028" class="line-number">2028 </a>        <span class="python-keyword">if</span> <span class="python-name">section</span> <span class="python-keyword">is</span> <span class="python-name">None</span><span class="python-operator">:</span>
<a name="L2029" class="line-number">2029 </a>            <span class="python-keyword">if</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">configspec</span> <span class="python-keyword">is</span> <span class="python-name">None</span><span class="python-operator">:</span>
<a name="L2030" class="line-number">2030 </a>                <span class="python-keyword">raise</span> <span class="python-name">ValueError</span><span class="python-operator">,</span> <span class="python-string">'No configspec supplied.'</span>
<a name="L2031" class="line-number">2031 </a>            <span class="python-keyword">if</span> <span class="python-name">preserve_errors</span><span class="python-operator">:</span>
<a name="L2032" class="line-number">2032 </a>                <span class="python-keyword">if</span> <span class="python-name">VdtMissingValue</span> <span class="python-keyword">is</span> <span class="python-name">None</span><span class="python-operator">:</span>
<a name="L2033" class="line-number">2033 </a>                    <span class="python-keyword">raise</span> <span class="python-name">ImportError</span><span class="python-operator">(</span><span class="python-string">'Missing validate module.'</span><span class="python-operator">)</span>
<a name="L2034" class="line-number">2034 </a>            <span class="python-name">section</span> <span class="python-operator">=</span> <span class="python-name">self</span>
<a name="L2035" class="line-number">2035 </a>        <span class="python-comment">#</span>
<a name="L2036" class="line-number">2036 </a>        <span class="python-name">spec_section</span> <span class="python-operator">=</span> <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">configspec</span>
<a name="L2037" class="line-number">2037 </a>        <span class="python-keyword">if</span> <span class="python-name">copy</span> <span class="python-keyword">and</span> <span class="python-name">hasattr</span><span class="python-operator">(</span><span class="python-name">section</span><span class="python-operator">,</span> <span class="python-string">'_configspec_initial_comment'</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L2038" class="line-number">2038 </a>            <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">initial_comment</span> <span class="python-operator">=</span> <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">_configspec_initial_comment</span>
<a name="L2039" class="line-number">2039 </a>            <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">final_comment</span> <span class="python-operator">=</span> <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">_configspec_final_comment</span>
<a name="L2040" class="line-number">2040 </a>            <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">encoding</span> <span class="python-operator">=</span> <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">_configspec_encoding</span>
<a name="L2041" class="line-number">2041 </a>            <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">BOM</span> <span class="python-operator">=</span> <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">_configspec_BOM</span>
<a name="L2042" class="line-number">2042 </a>            <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">newlines</span> <span class="python-operator">=</span> <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">_configspec_newlines</span>
<a name="L2043" class="line-number">2043 </a>            <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">indent_type</span> <span class="python-operator">=</span> <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">_configspec_indent_type</span>
<a name="L2044" class="line-number">2044 </a>        <span class="python-keyword">if</span> <span class="python-string">'__many__'</span> <span class="python-keyword">in</span> <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">configspec</span><span class="python-operator">:</span>
<a name="L2045" class="line-number">2045 </a>            <span class="python-name">many</span> <span class="python-operator">=</span> <span class="python-name">spec_section</span><span class="python-operator">[</span><span class="python-string">'__many__'</span><span class="python-operator">]</span>
<a name="L2046" class="line-number">2046 </a>            <span class="python-comment"># dynamically assign the configspecs</span>
<a name="L2047" class="line-number">2047 </a>            <span class="python-comment"># for the sections below</span>
<a name="L2048" class="line-number">2048 </a>            <span class="python-keyword">for</span> <span class="python-name">entry</span> <span class="python-keyword">in</span> <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">sections</span><span class="python-operator">:</span>
<a name="L2049" class="line-number">2049 </a>                <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_handle_repeat</span><span class="python-operator">(</span><span class="python-name">section</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span><span class="python-operator">,</span> <span class="python-name">many</span><span class="python-operator">)</span>
<a name="L2050" class="line-number">2050 </a>        <span class="python-comment">#</span>
<a name="L2051" class="line-number">2051 </a>        <span class="python-name">out</span> <span class="python-operator">=</span> <span class="python-operator">{</span><span class="python-operator">}</span>
<a name="L2052" class="line-number">2052 </a>        <span class="python-name">ret_true</span> <span class="python-operator">=</span> <span class="python-name">True</span>
<a name="L2053" class="line-number">2053 </a>        <span class="python-name">ret_false</span> <span class="python-operator">=</span> <span class="python-name">True</span>
<a name="L2054" class="line-number">2054 </a>        <span class="python-name">order</span> <span class="python-operator">=</span> <span class="python-operator">[</span><span class="python-name">k</span> <span class="python-keyword">for</span> <span class="python-name">k</span> <span class="python-keyword">in</span> <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">_order</span> <span class="python-keyword">if</span> <span class="python-name">k</span> <span class="python-keyword">in</span> <span class="python-name">spec_section</span><span class="python-operator">]</span>
<a name="L2055" class="line-number">2055 </a>        <span class="python-name">order</span> <span class="python-operator">+=</span> <span class="python-operator">[</span><span class="python-name">k</span> <span class="python-keyword">for</span> <span class="python-name">k</span> <span class="python-keyword">in</span> <span class="python-name">spec_section</span> <span class="python-keyword">if</span> <span class="python-name">k</span> <span class="python-keyword">not</span> <span class="python-keyword">in</span> <span class="python-name">order</span><span class="python-operator">]</span>
<a name="L2056" class="line-number">2056 </a>        <span class="python-keyword">for</span> <span class="python-name">entry</span> <span class="python-keyword">in</span> <span class="python-name">order</span><span class="python-operator">:</span>
<a name="L2057" class="line-number">2057 </a>            <span class="python-keyword">if</span> <span class="python-name">entry</span> <span class="python-operator">==</span> <span class="python-string">'__many__'</span><span class="python-operator">:</span>
<a name="L2058" class="line-number">2058 </a>                <span class="python-keyword">continue</span>
<a name="L2059" class="line-number">2059 </a>            <span class="python-keyword">if</span> <span class="python-operator">(</span><span class="python-keyword">not</span> <span class="python-name">entry</span> <span class="python-keyword">in</span> <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">scalars</span><span class="python-operator">)</span> <span class="python-keyword">or</span> <span class="python-operator">(</span><span class="python-name">entry</span> <span class="python-keyword">in</span> <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">defaults</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L2060" class="line-number">2060 </a>                <span class="python-comment"># missing entries</span>
<a name="L2061" class="line-number">2061 </a>                <span class="python-comment"># or entries from defaults</span>
<a name="L2062" class="line-number">2062 </a>                <span class="python-name">missing</span> <span class="python-operator">=</span> <span class="python-name">True</span>
<a name="L2063" class="line-number">2063 </a>                <span class="python-name">val</span> <span class="python-operator">=</span> <span class="python-name">None</span>
<a name="L2064" class="line-number">2064 </a>                <span class="python-keyword">if</span> <span class="python-name">copy</span> <span class="python-keyword">and</span> <span class="python-keyword">not</span> <span class="python-name">entry</span> <span class="python-keyword">in</span> <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">scalars</span><span class="python-operator">:</span>
<a name="L2065" class="line-number">2065 </a>                    <span class="python-comment"># copy comments</span>
<a name="L2066" class="line-number">2066 </a>                    <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">comments</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-operator">(</span>
<a name="L2067" class="line-number">2067 </a>                        <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">_configspec_comments</span><span class="python-operator">.</span><span class="python-name">get</span><span class="python-operator">(</span><span class="python-name">entry</span><span class="python-operator">,</span> <span class="python-operator">[</span><span class="python-operator">]</span><span class="python-operator">)</span><span class="python-operator">)</span>
<a name="L2068" class="line-number">2068 </a>                    <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">inline_comments</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-operator">(</span>
<a name="L2069" class="line-number">2069 </a>                        <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">_configspec_inline_comments</span><span class="python-operator">.</span><span class="python-name">get</span><span class="python-operator">(</span><span class="python-name">entry</span><span class="python-operator">,</span> <span class="python-string">''</span><span class="python-operator">)</span><span class="python-operator">)</span>
<a name="L2070" class="line-number">2070 </a>                <span class="python-comment">#</span>
<a name="L2071" class="line-number">2071 </a>            <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L2072" class="line-number">2072 </a>                <span class="python-name">missing</span> <span class="python-operator">=</span> <span class="python-name">False</span>
<a name="L2073" class="line-number">2073 </a>                <span class="python-name">val</span> <span class="python-operator">=</span> <span class="python-name">section</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span>
<a name="L2074" class="line-number">2074 </a>            <span class="python-keyword">try</span><span class="python-operator">:</span>
<a name="L2075" class="line-number">2075 </a>                <span class="python-name">check</span> <span class="python-operator">=</span> <span class="python-name">validator</span><span class="python-operator">.</span><span class="python-name">check</span><span class="python-operator">(</span><span class="python-name">spec_section</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span><span class="python-operator">,</span>
<a name="L2076" class="line-number">2076 </a>                                        <span class="python-name">val</span><span class="python-operator">,</span>
<a name="L2077" class="line-number">2077 </a>                                        <span class="python-name">missing</span><span class="python-operator">=</span><span class="python-name">missing</span>
<a name="L2078" class="line-number">2078 </a>                                        <span class="python-operator">)</span>
<a name="L2079" class="line-number">2079 </a>            <span class="python-keyword">except</span> <span class="python-name">validator</span><span class="python-operator">.</span><span class="python-name">baseErrorClass</span><span class="python-operator">,</span> <span class="python-name">e</span><span class="python-operator">:</span>
<a name="L2080" class="line-number">2080 </a>                <span class="python-keyword">if</span> <span class="python-keyword">not</span> <span class="python-name">preserve_errors</span> <span class="python-keyword">or</span> <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">e</span><span class="python-operator">,</span> <span class="python-name">VdtMissingValue</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L2081" class="line-number">2081 </a>                    <span class="python-name">out</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-name">False</span>
<a name="L2082" class="line-number">2082 </a>                <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L2083" class="line-number">2083 </a>                    <span class="python-comment"># preserve the error</span>
<a name="L2084" class="line-number">2084 </a>                    <span class="python-name">out</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-name">e</span>
<a name="L2085" class="line-number">2085 </a>                    <span class="python-name">ret_false</span> <span class="python-operator">=</span> <span class="python-name">False</span>
<a name="L2086" class="line-number">2086 </a>                <span class="python-name">ret_true</span> <span class="python-operator">=</span> <span class="python-name">False</span>
<a name="L2087" class="line-number">2087 </a>            <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L2088" class="line-number">2088 </a>                <span class="python-name">ret_false</span> <span class="python-operator">=</span> <span class="python-name">False</span>
<a name="L2089" class="line-number">2089 </a>                <span class="python-name">out</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-name">True</span>
<a name="L2090" class="line-number">2090 </a>                <span class="python-keyword">if</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">stringify</span> <span class="python-keyword">or</span> <span class="python-name">missing</span><span class="python-operator">:</span>
<a name="L2091" class="line-number">2091 </a>                    <span class="python-comment"># if we are doing type conversion</span>
<a name="L2092" class="line-number">2092 </a>                    <span class="python-comment"># or the value is a supplied default</span>
<a name="L2093" class="line-number">2093 </a>                    <span class="python-keyword">if</span> <span class="python-keyword">not</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">stringify</span><span class="python-operator">:</span>
<a name="L2094" class="line-number">2094 </a>                        <span class="python-keyword">if</span> <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">check</span><span class="python-operator">,</span> <span class="python-operator">(</span><span class="python-name">list</span><span class="python-operator">,</span> <span class="python-name">tuple</span><span class="python-operator">)</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L2095" class="line-number">2095 </a>                            <span class="python-comment"># preserve lists</span>
<a name="L2096" class="line-number">2096 </a>                            <span class="python-name">check</span> <span class="python-operator">=</span> <span class="python-operator">[</span><span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_str</span><span class="python-operator">(</span><span class="python-name">item</span><span class="python-operator">)</span> <span class="python-keyword">for</span> <span class="python-name">item</span> <span class="python-keyword">in</span> <span class="python-name">check</span><span class="python-operator">]</span>
<a name="L2097" class="line-number">2097 </a>                        <span class="python-keyword">elif</span> <span class="python-name">missing</span> <span class="python-keyword">and</span> <span class="python-name">check</span> <span class="python-keyword">is</span> <span class="python-name">None</span><span class="python-operator">:</span>
<a name="L2098" class="line-number">2098 </a>                            <span class="python-comment"># convert the None from a default to a ''</span>
<a name="L2099" class="line-number">2099 </a>                            <span class="python-name">check</span> <span class="python-operator">=</span> <span class="python-string">''</span>
<a name="L2100" class="line-number">2100 </a>                        <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L2101" class="line-number">2101 </a>                            <span class="python-name">check</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">_str</span><span class="python-operator">(</span><span class="python-name">check</span><span class="python-operator">)</span>
<a name="L2102" class="line-number">2102 </a>                    <span class="python-keyword">if</span> <span class="python-operator">(</span><span class="python-name">check</span> <span class="python-operator">!=</span> <span class="python-name">val</span><span class="python-operator">)</span> <span class="python-keyword">or</span> <span class="python-name">missing</span><span class="python-operator">:</span>
<a name="L2103" class="line-number">2103 </a>                        <span class="python-name">section</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-name">check</span>
<a name="L2104" class="line-number">2104 </a>                <span class="python-keyword">if</span> <span class="python-keyword">not</span> <span class="python-name">copy</span> <span class="python-keyword">and</span> <span class="python-name">missing</span> <span class="python-keyword">and</span> <span class="python-name">entry</span> <span class="python-keyword">not</span> <span class="python-keyword">in</span> <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">defaults</span><span class="python-operator">:</span>
<a name="L2105" class="line-number">2105 </a>                    <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">defaults</span><span class="python-operator">.</span><span class="python-name">append</span><span class="python-operator">(</span><span class="python-name">entry</span><span class="python-operator">)</span>
<a name="L2106" class="line-number">2106 </a>        <span class="python-comment">#</span>
<a name="L2107" class="line-number">2107 </a>        <span class="python-comment"># Missing sections will have been created as empty ones when the</span>
<a name="L2108" class="line-number">2108 </a>        <span class="python-comment"># configspec was read.</span>
<a name="L2109" class="line-number">2109 </a>        <span class="python-keyword">for</span> <span class="python-name">entry</span> <span class="python-keyword">in</span> <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">sections</span><span class="python-operator">:</span>
<a name="L2110" class="line-number">2110 </a>            <span class="python-comment"># FIXME: this means DEFAULT is not copied in copy mode</span>
<a name="L2111" class="line-number">2111 </a>            <span class="python-keyword">if</span> <span class="python-name">section</span> <span class="python-keyword">is</span> <span class="python-name">self</span> <span class="python-keyword">and</span> <span class="python-name">entry</span> <span class="python-operator">==</span> <span class="python-string">'DEFAULT'</span><span class="python-operator">:</span>
<a name="L2112" class="line-number">2112 </a>                <span class="python-keyword">continue</span>
<a name="L2113" class="line-number">2113 </a>            <span class="python-keyword">if</span> <span class="python-name">copy</span><span class="python-operator">:</span>
<a name="L2114" class="line-number">2114 </a>                <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">comments</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">_cs_section_comments</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span>
<a name="L2115" class="line-number">2115 </a>                <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">inline_comments</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-operator">(</span>
<a name="L2116" class="line-number">2116 </a>                    <span class="python-name">section</span><span class="python-operator">.</span><span class="python-name">_cs_section_inline_comments</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span><span class="python-operator">)</span>
<a name="L2117" class="line-number">2117 </a>            <span class="python-name">check</span> <span class="python-operator">=</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">validate</span><span class="python-operator">(</span><span class="python-name">validator</span><span class="python-operator">,</span> <span class="python-name">preserve_errors</span><span class="python-operator">=</span><span class="python-name">preserve_errors</span><span class="python-operator">,</span>
<a name="L2118" class="line-number">2118 </a>                <span class="python-name">copy</span><span class="python-operator">=</span><span class="python-name">copy</span><span class="python-operator">,</span> <span class="python-name">section</span><span class="python-operator">=</span><span class="python-name">section</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span><span class="python-operator">)</span>
<a name="L2119" class="line-number">2119 </a>            <span class="python-name">out</span><span class="python-operator">[</span><span class="python-name">entry</span><span class="python-operator">]</span> <span class="python-operator">=</span> <span class="python-name">check</span>
<a name="L2120" class="line-number">2120 </a>            <span class="python-keyword">if</span> <span class="python-name">check</span> <span class="python-operator">==</span> <span class="python-name">False</span><span class="python-operator">:</span>
<a name="L2121" class="line-number">2121 </a>                <span class="python-name">ret_true</span> <span class="python-operator">=</span> <span class="python-name">False</span>
<a name="L2122" class="line-number">2122 </a>            <span class="python-keyword">elif</span> <span class="python-name">check</span> <span class="python-operator">==</span> <span class="python-name">True</span><span class="python-operator">:</span>
<a name="L2123" class="line-number">2123 </a>                <span class="python-name">ret_false</span> <span class="python-operator">=</span> <span class="python-name">False</span>
<a name="L2124" class="line-number">2124 </a>            <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L2125" class="line-number">2125 </a>                <span class="python-name">ret_true</span> <span class="python-operator">=</span> <span class="python-name">False</span>
<a name="L2126" class="line-number">2126 </a>                <span class="python-name">ret_false</span> <span class="python-operator">=</span> <span class="python-name">False</span>
<a name="L2127" class="line-number">2127 </a>        <span class="python-comment">#</span>
<a name="L2128" class="line-number">2128 </a>        <span class="python-keyword">if</span> <span class="python-name">ret_true</span><span class="python-operator">:</span>
<a name="L2129" class="line-number">2129 </a>            <span class="python-keyword">return</span> <span class="python-name">True</span>
<a name="L2130" class="line-number">2130 </a>        <span class="python-keyword">elif</span> <span class="python-name">ret_false</span><span class="python-operator">:</span>
<a name="L2131" class="line-number">2131 </a>            <span class="python-keyword">return</span> <span class="python-name">False</span>
<a name="L2132" class="line-number">2132 </a>        <span class="python-keyword">else</span><span class="python-operator">:</span>
<a name="L2133" class="line-number">2133 </a>            <span class="python-keyword">return</span> <span class="python-name">out</span>
<a name="L2134" class="line-number">2134 </a>
<a name="L2135" class="line-number">2135 </a><span class="python-keyword">class</span> <span class="python-name">SimpleVal</span><span class="python-operator">(</span><span class="python-name">object</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L2136" class="line-number">2136 </a>    <span class="python-string">"""
<a name="L2137" class="line-number">2137 </a>    A simple validator.
<a name="L2138" class="line-number">2138 </a>    Can be used to check that all members expected are present.
<a name="L2139" class="line-number">2139 </a>    
<a name="L2140" class="line-number">2140 </a>    To use it, provide a configspec with all your members in (the value given
<a name="L2141" class="line-number">2141 </a>    will be ignored). Pass an instance of ``SimpleVal`` to the ``validate``
<a name="L2142" class="line-number">2142 </a>    method of your ``ConfigObj``. ``validate`` will return ``True`` if all
<a name="L2143" class="line-number">2143 </a>    members are present, or a dictionary with True/False meaning
<a name="L2144" class="line-number">2144 </a>    present/missing. (Whole missing sections will be replaced with ``False``)
<a name="L2145" class="line-number">2145 </a>    """</span>
<a name="L2146" class="line-number">2146 </a>
<a name="L2147" class="line-number">2147 </a>    <span class="python-keyword">def</span> <span class="python-name">__init__</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L2148" class="line-number">2148 </a>        <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">baseErrorClass</span> <span class="python-operator">=</span> <span class="python-name">ConfigObjError</span>
<a name="L2149" class="line-number">2149 </a>
<a name="L2150" class="line-number">2150 </a>    <span class="python-keyword">def</span> <span class="python-name">check</span><span class="python-operator">(</span><span class="python-name">self</span><span class="python-operator">,</span> <span class="python-name">check</span><span class="python-operator">,</span> <span class="python-name">member</span><span class="python-operator">,</span> <span class="python-name">missing</span><span class="python-operator">=</span><span class="python-name">False</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L2151" class="line-number">2151 </a>        <span class="python-string">"""A dummy check method, always returns the value unchanged."""</span>
<a name="L2152" class="line-number">2152 </a>        <span class="python-keyword">if</span> <span class="python-name">missing</span><span class="python-operator">:</span>
<a name="L2153" class="line-number">2153 </a>            <span class="python-keyword">raise</span> <span class="python-name">self</span><span class="python-operator">.</span><span class="python-name">baseErrorClass</span>
<a name="L2154" class="line-number">2154 </a>        <span class="python-keyword">return</span> <span class="python-name">member</span>
<a name="L2155" class="line-number">2155 </a>
<a name="L2156" class="line-number">2156 </a><span class="python-comment"># Check / processing functions for options</span>
<a name="L2157" class="line-number">2157 </a><span class="python-keyword">def</span> <span class="python-name">flatten_errors</span><span class="python-operator">(</span><span class="python-name">cfg</span><span class="python-operator">,</span> <span class="python-name">res</span><span class="python-operator">,</span> <span class="python-name">levels</span><span class="python-operator">=</span><span class="python-name">None</span><span class="python-operator">,</span> <span class="python-name">results</span><span class="python-operator">=</span><span class="python-name">None</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L2158" class="line-number">2158 </a>    <span class="python-string">"""
<a name="L2159" class="line-number">2159 </a>    An example function that will turn a nested dictionary of results
<a name="L2160" class="line-number">2160 </a>    (as returned by ``ConfigObj.validate``) into a flat list.
<a name="L2161" class="line-number">2161 </a>    
<a name="L2162" class="line-number">2162 </a>    ``cfg`` is the ConfigObj instance being checked, ``res`` is the results
<a name="L2163" class="line-number">2163 </a>    dictionary returned by ``validate``.
<a name="L2164" class="line-number">2164 </a>    
<a name="L2165" class="line-number">2165 </a>    (This is a recursive function, so you shouldn't use the ``levels`` or
<a name="L2166" class="line-number">2166 </a>    ``results`` arguments - they are used by the function.
<a name="L2167" class="line-number">2167 </a>    
<a name="L2168" class="line-number">2168 </a>    Returns a list of keys that failed. Each member of the list is a tuple :
<a name="L2169" class="line-number">2169 </a>    ::
<a name="L2170" class="line-number">2170 </a>    
<a name="L2171" class="line-number">2171 </a>        ([list of sections...], key, result)
<a name="L2172" class="line-number">2172 </a>    
<a name="L2173" class="line-number">2173 </a>    If ``validate`` was called with ``preserve_errors=False`` (the default)
<a name="L2174" class="line-number">2174 </a>    then ``result`` will always be ``False``.
<a name="L2175" class="line-number">2175 </a>
<a name="L2176" class="line-number">2176 </a>    *list of sections* is a flattened list of sections that the key was found
<a name="L2177" class="line-number">2177 </a>    in.
<a name="L2178" class="line-number">2178 </a>    
<a name="L2179" class="line-number">2179 </a>    If the section was missing then key will be ``None``.
<a name="L2180" class="line-number">2180 </a>    
<a name="L2181" class="line-number">2181 </a>    If the value (or section) was missing then ``result`` will be ``False``.
<a name="L2182" class="line-number">2182 </a>    
<a name="L2183" class="line-number">2183 </a>    If ``validate`` was called with ``preserve_errors=True`` and a value
<a name="L2184" class="line-number">2184 </a>    was present, but failed the check, then ``result`` will be the exception
<a name="L2185" class="line-number">2185 </a>    object returned. You can use this as a string that describes the failure.
<a name="L2186" class="line-number">2186 </a>    
<a name="L2187" class="line-number">2187 </a>    For example *The value "3" is of the wrong type*.
<a name="L2188" class="line-number">2188 </a>    
<a name="L2189" class="line-number">2189 </a>    &gt;&gt;&gt; import validate
<a name="L2190" class="line-number">2190 </a>    &gt;&gt;&gt; vtor = validate.Validator()
<a name="L2191" class="line-number">2191 </a>    &gt;&gt;&gt; my_ini = '''
<a name="L2192" class="line-number">2192 </a>    ...     option1 = True
<a name="L2193" class="line-number">2193 </a>    ...     [section1]
<a name="L2194" class="line-number">2194 </a>    ...     option1 = True
<a name="L2195" class="line-number">2195 </a>    ...     [section2]
<a name="L2196" class="line-number">2196 </a>    ...     another_option = Probably
<a name="L2197" class="line-number">2197 </a>    ...     [section3]
<a name="L2198" class="line-number">2198 </a>    ...     another_option = True
<a name="L2199" class="line-number">2199 </a>    ...     [[section3b]]
<a name="L2200" class="line-number">2200 </a>    ...     value = 3
<a name="L2201" class="line-number">2201 </a>    ...     value2 = a
<a name="L2202" class="line-number">2202 </a>    ...     value3 = 11
<a name="L2203" class="line-number">2203 </a>    ...     '''
<a name="L2204" class="line-number">2204 </a>    &gt;&gt;&gt; my_cfg = '''
<a name="L2205" class="line-number">2205 </a>    ...     option1 = boolean()
<a name="L2206" class="line-number">2206 </a>    ...     option2 = boolean()
<a name="L2207" class="line-number">2207 </a>    ...     option3 = boolean(default=Bad_value)
<a name="L2208" class="line-number">2208 </a>    ...     [section1]
<a name="L2209" class="line-number">2209 </a>    ...     option1 = boolean()
<a name="L2210" class="line-number">2210 </a>    ...     option2 = boolean()
<a name="L2211" class="line-number">2211 </a>    ...     option3 = boolean(default=Bad_value)
<a name="L2212" class="line-number">2212 </a>    ...     [section2]
<a name="L2213" class="line-number">2213 </a>    ...     another_option = boolean()
<a name="L2214" class="line-number">2214 </a>    ...     [section3]
<a name="L2215" class="line-number">2215 </a>    ...     another_option = boolean()
<a name="L2216" class="line-number">2216 </a>    ...     [[section3b]]
<a name="L2217" class="line-number">2217 </a>    ...     value = integer
<a name="L2218" class="line-number">2218 </a>    ...     value2 = integer
<a name="L2219" class="line-number">2219 </a>    ...     value3 = integer(0, 10)
<a name="L2220" class="line-number">2220 </a>    ...         [[[section3b-sub]]]
<a name="L2221" class="line-number">2221 </a>    ...         value = string
<a name="L2222" class="line-number">2222 </a>    ...     [section4]
<a name="L2223" class="line-number">2223 </a>    ...     another_option = boolean()
<a name="L2224" class="line-number">2224 </a>    ...     '''
<a name="L2225" class="line-number">2225 </a>    &gt;&gt;&gt; cs = my_cfg.split('\\n')
<a name="L2226" class="line-number">2226 </a>    &gt;&gt;&gt; ini = my_ini.split('\\n')
<a name="L2227" class="line-number">2227 </a>    &gt;&gt;&gt; cfg = ConfigObj(ini, configspec=cs)
<a name="L2228" class="line-number">2228 </a>    &gt;&gt;&gt; res = cfg.validate(vtor, preserve_errors=True)
<a name="L2229" class="line-number">2229 </a>    &gt;&gt;&gt; errors = []
<a name="L2230" class="line-number">2230 </a>    &gt;&gt;&gt; for entry in flatten_errors(cfg, res):
<a name="L2231" class="line-number">2231 </a>    ...     section_list, key, error = entry
<a name="L2232" class="line-number">2232 </a>    ...     section_list.insert(0, '[root]')
<a name="L2233" class="line-number">2233 </a>    ...     if key is not None:
<a name="L2234" class="line-number">2234 </a>    ...        section_list.append(key)
<a name="L2235" class="line-number">2235 </a>    ...     else:
<a name="L2236" class="line-number">2236 </a>    ...         section_list.append('[missing]')
<a name="L2237" class="line-number">2237 </a>    ...     section_string = ', '.join(section_list)
<a name="L2238" class="line-number">2238 </a>    ...     errors.append((section_string, ' = ', error))
<a name="L2239" class="line-number">2239 </a>    &gt;&gt;&gt; errors.sort()
<a name="L2240" class="line-number">2240 </a>    &gt;&gt;&gt; for entry in errors:
<a name="L2241" class="line-number">2241 </a>    ...     print entry[0], entry[1], (entry[2] or 0)
<a name="L2242" class="line-number">2242 </a>    [root], option2  =  0
<a name="L2243" class="line-number">2243 </a>    [root], option3  =  the value "Bad_value" is of the wrong type.
<a name="L2244" class="line-number">2244 </a>    [root], section1, option2  =  0
<a name="L2245" class="line-number">2245 </a>    [root], section1, option3  =  the value "Bad_value" is of the wrong type.
<a name="L2246" class="line-number">2246 </a>    [root], section2, another_option  =  the value "Probably" is of the wrong type.
<a name="L2247" class="line-number">2247 </a>    [root], section3, section3b, section3b-sub, [missing]  =  0
<a name="L2248" class="line-number">2248 </a>    [root], section3, section3b, value2  =  the value "a" is of the wrong type.
<a name="L2249" class="line-number">2249 </a>    [root], section3, section3b, value3  =  the value "11" is too big.
<a name="L2250" class="line-number">2250 </a>    [root], section4, [missing]  =  0
<a name="L2251" class="line-number">2251 </a>    """</span>
<a name="L2252" class="line-number">2252 </a>    <span class="python-keyword">if</span> <span class="python-name">levels</span> <span class="python-keyword">is</span> <span class="python-name">None</span><span class="python-operator">:</span>
<a name="L2253" class="line-number">2253 </a>        <span class="python-comment"># first time called</span>
<a name="L2254" class="line-number">2254 </a>        <span class="python-name">levels</span> <span class="python-operator">=</span> <span class="python-operator">[</span><span class="python-operator">]</span>
<a name="L2255" class="line-number">2255 </a>        <span class="python-name">results</span> <span class="python-operator">=</span> <span class="python-operator">[</span><span class="python-operator">]</span>
<a name="L2256" class="line-number">2256 </a>    <span class="python-keyword">if</span> <span class="python-name">res</span> <span class="python-keyword">is</span> <span class="python-name">True</span><span class="python-operator">:</span>
<a name="L2257" class="line-number">2257 </a>        <span class="python-keyword">return</span> <span class="python-name">results</span>
<a name="L2258" class="line-number">2258 </a>    <span class="python-keyword">if</span> <span class="python-name">res</span> <span class="python-keyword">is</span> <span class="python-name">False</span><span class="python-operator">:</span>
<a name="L2259" class="line-number">2259 </a>        <span class="python-name">results</span><span class="python-operator">.</span><span class="python-name">append</span><span class="python-operator">(</span><span class="python-operator">(</span><span class="python-name">levels</span><span class="python-operator">[</span><span class="python-operator">:</span><span class="python-operator">]</span><span class="python-operator">,</span> <span class="python-name">None</span><span class="python-operator">,</span> <span class="python-name">False</span><span class="python-operator">)</span><span class="python-operator">)</span>
<a name="L2260" class="line-number">2260 </a>        <span class="python-keyword">if</span> <span class="python-name">levels</span><span class="python-operator">:</span>
<a name="L2261" class="line-number">2261 </a>            <span class="python-name">levels</span><span class="python-operator">.</span><span class="python-name">pop</span><span class="python-operator">(</span><span class="python-operator">)</span>
<a name="L2262" class="line-number">2262 </a>        <span class="python-keyword">return</span> <span class="python-name">results</span>
<a name="L2263" class="line-number">2263 </a>    <span class="python-keyword">for</span> <span class="python-operator">(</span><span class="python-name">key</span><span class="python-operator">,</span> <span class="python-name">val</span><span class="python-operator">)</span> <span class="python-keyword">in</span> <span class="python-name">res</span><span class="python-operator">.</span><span class="python-name">items</span><span class="python-operator">(</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L2264" class="line-number">2264 </a>        <span class="python-keyword">if</span> <span class="python-name">val</span> <span class="python-operator">==</span> <span class="python-name">True</span><span class="python-operator">:</span>
<a name="L2265" class="line-number">2265 </a>            <span class="python-keyword">continue</span>
<a name="L2266" class="line-number">2266 </a>        <span class="python-keyword">if</span> <span class="python-name">isinstance</span><span class="python-operator">(</span><span class="python-name">cfg</span><span class="python-operator">.</span><span class="python-name">get</span><span class="python-operator">(</span><span class="python-name">key</span><span class="python-operator">)</span><span class="python-operator">,</span> <span class="python-name">dict</span><span class="python-operator">)</span><span class="python-operator">:</span>
<a name="L2267" class="line-number">2267 </a>            <span class="python-comment"># Go down one level</span>
<a name="L2268" class="line-number">2268 </a>            <span class="python-name">levels</span><span class="python-operator">.</span><span class="python-name">append</span><span class="python-operator">(</span><span class="python-name">key</span><span class="python-operator">)</span>
<a name="L2269" class="line-number">2269 </a>            <span class="python-name">flatten_errors</span><span class="python-operator">(</span><span class="python-name">cfg</span><span class="python-operator">[</span><span class="python-name">key</span><span class="python-operator">]</span><span class="python-operator">,</span> <span class="python-name">val</span><span class="python-operator">,</span> <span class="python-name">levels</span><span class="python-operator">,</span> <span class="python-name">results</span><span class="python-operator">)</span>
<a name="L2270" class="line-number">2270 </a>            <span class="python-keyword">continue</span>
<a name="L2271" class="line-number">2271 </a>        <span class="python-name">results</span><span class="python-operator">.</span><span class="python-name">append</span><span class="python-operator">(</span><span class="python-operator">(</span><span class="python-name">levels</span><span class="python-operator">[</span><span class="python-operator">:</span><span class="python-operator">]</span><span class="python-operator">,</span> <span class="python-name">key</span><span class="python-operator">,</span> <span class="python-name">val</span><span class="python-operator">)</span><span class="python-operator">)</span>
<a name="L2272" class="line-number">2272 </a>    <span class="python-comment">#</span>
<a name="L2273" class="line-number">2273 </a>    <span class="python-comment"># Go up one level</span>
<a name="L2274" class="line-number">2274 </a>    <span class="python-keyword">if</span> <span class="python-name">levels</span><span class="python-operator">:</span>
<a name="L2275" class="line-number">2275 </a>        <span class="python-name">levels</span><span class="python-operator">.</span><span class="python-name">pop</span><span class="python-operator">(</span><span class="python-operator">)</span>
<a name="L2276" class="line-number">2276 </a>    <span class="python-comment">#</span>
<a name="L2277" class="line-number">2277 </a>    <span class="python-keyword">return</span> <span class="python-name">results</span>
<a name="L2278" class="line-number">2278 </a>
<a name="L2279" class="line-number">2279 </a><span class="python-string">"""*A programming language is a medium of expression.* - Paul Graham"""</span><span class="python-text"></span>
</pre>
</body>
</html>
