#!/bin/sh

# Add a ChangeLog entry.
# Usage: add-changelog [PATH...]
# Requires environment variables $NAME and $EMAIL.

cd $(dirname "$0")/.. || exit
DATE=$(date --utc +%Y-%m-%d) || exit
svn status -q "$@" | grep "\w" || exit
PATHS=$(svn status -q "$@" | sed "s|^.* ||" | grep -v "test_" | sort)

mv ChangeLog ChangeLog.old
printf "$DATE  $NAME  <$EMAIL>\n\n" > ChangeLog
for ITEM in $PATHS; do
    echo "Adding $ITEM..."
    printf "\t* $ITEM:\n" >> ChangeLog
done
echo >> ChangeLog
cat ChangeLog.old >> ChangeLog
rm ChangeLog.old
